<<<<<<< HEAD
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WalletConnectClient",[],t):"object"==typeof exports?exports.WalletConnectClient=t():e.WalletConnectClient=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=86)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"n",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"j",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"m",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"k",(function(){return r})),n.d(t,"l",(function(){return i})),n.d(t,"d",(function(){return E})),n.d(t,"c",(function(){return y})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return v}));const r=0,i=512,o=256,s=256,a="AES-CBC",c="SHA-"+o,u="HMAC",d="SHA-256",l="SHA-512",f=32,h=16,p=32,g="Bad MAC",E="encrypt",y="decrypt",_="sign",v="verify"},function(e,t,n){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeHexLeadingZeros=t.sanitizeHex=t.addHexPrefix=t.removeHexPrefix=t.padRight=t.padLeft=t.sanitizeBytes=t.swapHex=t.swapBytes=t.splitBytes=t.calcByteLength=t.trimRight=t.trimLeft=t.concatArrays=t.concatBuffers=t.getEncoding=t.getType=t.isArrayBuffer=t.isTypedArray=t.isBuffer=t.isHexString=t.isBinaryString=t.binaryToNumber=t.binaryToUtf8=t.binaryToHex=t.binaryToArray=t.binaryToBuffer=t.numberToBinary=t.numberToUtf8=t.numberToHex=t.numberToArray=t.numberToBuffer=t.utf8ToBinary=t.utf8ToNumber=t.utf8ToHex=t.utf8ToArray=t.utf8ToBuffer=t.hexToBinary=t.hexToNumber=t.hexToUtf8=t.hexToArray=t.hexToBuffer=t.arrayToBinary=t.arrayToNumber=t.arrayToUtf8=t.arrayToHex=t.arrayToBuffer=t.bufferToBinary=t.bufferToNumber=t.bufferToUtf8=t.bufferToHex=t.bufferToArray=void 0;const i=r(n(68)),o=r(n(99));function s(e){return new Uint8Array(e)}function a(e,t=!1){const n=e.toString("hex");return t?x(n):n}function c(e){return e.toString("utf8")}function u(e){return e.readUIntBE(0,e.length)}function d(e){return o.default(e)}function l(e,t=!1){return a(d(e),t)}function f(e){return c(d(e))}function h(e){return u(d(e))}function p(e){return Array.from(e).map(R).join("")}function g(t){return e.from(D(t),"hex")}function E(e){return s(g(e))}function y(e){return p(E(e))}function _(t){return e.from(t,"utf8")}function v(e){return s(_(e))}function R(e){return U((e>>>0).toString(2))}function m(e){return d(S(e))}function S(e){return new Uint8Array(P(e).map(e=>parseInt(e,2)))}function T(e,t){return l(S(e),t)}function O(e){return!("string"!=typeof e||!new RegExp(/^[01]+$/).test(e))&&e.length%8==0}function N(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function b(t){return e.isBuffer(t)}function I(e){return i.default.strict(e)&&!b(e)}function w(e){return!I(e)&&!b(e)&&void 0!==e.byteLength}function A(e,t=8){const n=e%t;return n?(e-n)/t*t+t:e}function P(e,t=8){const n=U(e).match(new RegExp(`.{${t}}`,"gi"));return Array.from(n||[])}function C(e){return P(e).map(M).join("")}function U(e,t=8,n="0"){return L(e,A(e.length,t),n)}function L(e,t,n="0"){return q(e,t,!0,n)}function D(e){return e.replace(/^0x/,"")}function x(e){return e.startsWith("0x")?e:"0x"+e}function M(e){return e.split("").reverse().join("")}function q(e,t,n,r="0"){const i=t-e.length;let o=e;if(i>0){const t=r.repeat(i);o=n?t+e:e+t}return o}t.bufferToArray=s,t.bufferToHex=a,t.bufferToUtf8=c,t.bufferToNumber=u,t.bufferToBinary=function(e){return p(s(e))},t.arrayToBuffer=d,t.arrayToHex=l,t.arrayToUtf8=f,t.arrayToNumber=h,t.arrayToBinary=p,t.hexToBuffer=g,t.hexToArray=E,t.hexToUtf8=function(e){return c(g(e))},t.hexToNumber=function(e){return h(E(e))},t.hexToBinary=y,t.utf8ToBuffer=_,t.utf8ToArray=v,t.utf8ToHex=function(e,t=!1){return a(_(e),t)},t.utf8ToNumber=function(e){const t=parseInt(e,10);return function(e,t){if(!e)throw new Error(t)}(!function(e){return void 0===e}(t),"Number can only safely store up to 53 bits"),t},t.utf8ToBinary=function(e){return p(v(e))},t.numberToBuffer=function(e){return m(R(e))},t.numberToArray=function(e){return S(R(e))},t.numberToHex=function(e,t){return T(R(e),t)},t.numberToUtf8=function(e){return""+e},t.numberToBinary=R,t.binaryToBuffer=m,t.binaryToArray=S,t.binaryToHex=T,t.binaryToUtf8=function(e){return f(S(e))},t.binaryToNumber=function(e){return h(S(e))},t.isBinaryString=O,t.isHexString=N,t.isBuffer=b,t.isTypedArray=I,t.isArrayBuffer=w,t.getType=function(e){return b(e)?"buffer":I(e)?"typed-array":w(e)?"array-buffer":Array.isArray(e)?"array":typeof e},t.getEncoding=function(e){return O(e)?"binary":N(e)?"hex":"utf8"},t.concatBuffers=function(...t){return e.concat(t)},t.concatArrays=function(...e){let t=[];return e.forEach(e=>t=t.concat(Array.from(e))),new Uint8Array([...t])},t.trimLeft=function(e,t){const n=e.length-t;return n>0&&(e=e.slice(n)),e},t.trimRight=function(e,t){return e.slice(0,t)},t.calcByteLength=A,t.splitBytes=P,t.swapBytes=C,t.swapHex=function(e){return T(C(y(e)))},t.sanitizeBytes=U,t.padLeft=L,t.padRight=function(e,t,n="0"){return q(e,t,!1,n)},t.removeHexPrefix=D,t.addHexPrefix=x,t.sanitizeHex=function(e){return(e=U(e=D(e),2))&&(e=x(e)),e},t.removeHexLeadingZeros=function(e){const t=e.startsWith("0x");return e=(e=D(e)).startsWith("0")?e.substring(1):e,t?x(e):e}}).call(this,n(67).Buffer)},function(e,t,n){"use strict";n.r(t);var r=n(39);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(26);n.d(t,"IEvents",(function(){return o.a}));var s=n(40);n.d(t,"IJsonRpcConnection",(function(){return s.b})),n.d(t,"IBaseJsonRpcProvider",(function(){return s.a})),n.d(t,"IJsonRpcProvider",(function(){return s.c}));var a=n(41);for(var i in a)["default","IEvents","IJsonRpcConnection","IBaseJsonRpcProvider","IJsonRpcProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i)},function(e,t,n){"use strict";var r=n(57);n.d(t,"randomBytes",(function(){return r.a}));var i=n(59);n.d(t,"aesCbcDecrypt",(function(){return i.a})),n.d(t,"aesCbcEncrypt",(function(){return i.b}));var o=n(60);n.d(t,"hmacSha256Sign",(function(){return o.a})),n.d(t,"hmacSha256Verify",(function(){return o.b}));var s=n(65);n.d(t,"sha256",(function(){return s.a})),n.d(t,"sha512",(function(){return s.b}));var a=n(27);n.o(a,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return a.ERROR_BAD_MAC})),n.o(a,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return a.IV_LENGTH})),n.o(a,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return a.KEY_LENGTH})),n.o(a,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return a.LENGTH_0})),n.o(a,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return a.MAC_LENGTH})),n.o(a,"assert")&&n.d(t,"assert",(function(){return a.assert})),n.o(a,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return a.decryptWithSharedKey})),n.o(a,"derive")&&n.d(t,"derive",(function(){return a.derive})),n.o(a,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return a.encryptWithSharedKey})),n.o(a,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return a.generateKeyPair}));var c=n(0);n.d(t,"ERROR_BAD_MAC",(function(){return c.e})),n.d(t,"IV_LENGTH",(function(){return c.i})),n.d(t,"KEY_LENGTH",(function(){return c.j})),n.d(t,"LENGTH_0",(function(){return c.k})),n.d(t,"MAC_LENGTH",(function(){return c.m}))},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return l}));const r="PARSE_ERROR",i="INVALID_REQUEST",o="METHOD_NOT_FOUND",s="INVALID_PARAMS",a="INTERNAL_ERROR",c="SERVER_ERROR",u=[-32700,-32600,-32601,-32602,-32603],d=[-32e3,-32099],l={[r]:{code:-32700,message:"Parse error"},[i]:{code:-32600,message:"Invalid Request"},[o]:{code:-32601,message:"Method not found"},[s]:{code:-32602,message:"Invalid params"},[a]:{code:-32603,message:"Internal error"},[c]:{code:-32e3,message:"Server error"}}},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return i})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return d})),n.d(t,"__generator",(function(){return l})),n.d(t,"__createBinding",(function(){return f})),n.d(t,"__exportStar",(function(){return h})),n.d(t,"__values",(function(){return p})),n.d(t,"__read",(function(){return g})),n.d(t,"__spread",(function(){return E})),n.d(t,"__spreadArrays",(function(){return y})),n.d(t,"__await",(function(){return _})),n.d(t,"__asyncGenerator",(function(){return v})),n.d(t,"__asyncDelegator",(function(){return R})),n.d(t,"__asyncValues",(function(){return m})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return T})),n.d(t,"__importDefault",(function(){return O})),n.d(t,"__classPrivateFieldGet",(function(){return N})),n.d(t,"__classPrivateFieldSet",(function(){return b}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}function h(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function y(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof _?Promise.resolve(n.value.v).then(c,u):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function R(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:_(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function m(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=p(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function O(e){return e&&e.__esModule?e:{default:e}}function N(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function b(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(94),t),i(n(95),t)},function(e,t,n){"use strict";function r(e,t,n="string"){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function i(e,t,n){return!!(!n.length?function(e,t){return Array.isArray(e)?e.length===t:Object.keys(e).length===t}(e,t.length):function(e,t){return Array.isArray(e)?e.length>=t:Object.keys(e).length>=t}(e,t.length))&&function(e,t){let n=!0;return t.forEach(t=>{t in e||(n=!1)}),n}(e,t)}function o(e,t,n="_"){const r=e.split(n);return r[r.length-1].trim().toLowerCase()===t.trim().toLowerCase()}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}))},function(e,t,n){"use strict";n.r(t);var r=n(4);n.d(t,"PARSE_ERROR",(function(){return r.e})),n.d(t,"INVALID_REQUEST",(function(){return r.c})),n.d(t,"METHOD_NOT_FOUND",(function(){return r.d})),n.d(t,"INVALID_PARAMS",(function(){return r.b})),n.d(t,"INTERNAL_ERROR",(function(){return r.a})),n.d(t,"SERVER_ERROR",(function(){return r.g})),n.d(t,"RESERVED_ERROR_CODES",(function(){return r.f})),n.d(t,"SERVER_ERROR_CODE_RANGE",(function(){return r.h})),n.d(t,"STANDARD_ERROR_MAP",(function(){return r.i}));var i=n(20);n.d(t,"isServerErrorCode",(function(){return i.d})),n.d(t,"isReservedErrorCode",(function(){return i.c})),n.d(t,"isValidErrorCode",(function(){return i.e})),n.d(t,"getError",(function(){return i.a})),n.d(t,"getErrorByCode",(function(){return i.b})),n.d(t,"validateJsonRpcError",(function(){return i.g})),n.d(t,"parseConnectionError",(function(){return i.f}));var o=n(72);for(var s in o)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var a=n(73);n.d(t,"payloadId",(function(){return a.e})),n.d(t,"formatJsonRpcRequest",(function(){return a.c})),n.d(t,"formatJsonRpcResult",(function(){return a.d})),n.d(t,"formatJsonRpcError",(function(){return a.b})),n.d(t,"formatErrorMessage",(function(){return a.a}));var c=n(74);n.d(t,"isValidRoute",(function(){return c.c})),n.d(t,"isValidDefaultRoute",(function(){return c.a})),n.d(t,"isValidWildcardRoute",(function(){return c.e})),n.d(t,"isValidLeadingWildcardRoute",(function(){return c.b})),n.d(t,"isValidTrailingWildcardRoute",(function(){return c.d}));var u=n(75);for(var s in u)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError","payloadId","formatJsonRpcRequest","formatJsonRpcResult","formatJsonRpcError","formatErrorMessage","isValidRoute","isValidDefaultRoute","isValidWildcardRoute","isValidLeadingWildcardRoute","isValidTrailingWildcardRoute"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(s);var d=n(76);n.d(t,"isHttpUrl",(function(){return d.a})),n.d(t,"isWsUrl",(function(){return d.c})),n.d(t,"isLocalhostUrl",(function(){return d.b}));var l=n(77);n.d(t,"isJsonRpcPayload",(function(){return l.b})),n.d(t,"isJsonRpcRequest",(function(){return l.c})),n.d(t,"isJsonRpcResponse",(function(){return l.d})),n.d(t,"isJsonRpcResult",(function(){return l.e})),n.d(t,"isJsonRpcError",(function(){return l.a})),n.d(t,"isJsonRpcValidationInvalid",(function(){return l.f}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);r.__exportStar(n(114),t),r.__exportStar(n(115),t),r.__exportStar(n(116),t),r.__exportStar(n(117),t),r.__exportStar(n(118),t),r.__exportStar(n(119),t),r.__exportStar(n(120),t),r.__exportStar(n(121),t),r.__exportStar(n(122),t),r.__exportStar(n(123),t),r.__exportStar(n(124),t),r.__exportStar(n(125),t),r.__exportStar(n(126),t),r.__exportStar(n(18),t)},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,s,a;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=d(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):E(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function E(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=E(c,u);for(n=0;n<u;++n)o(d[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(78),t),i(n(111),t)},function(e,t,n){"use strict";n.r(t),n.d(t,"generateKeyPair",(function(){return o})),n.d(t,"generateRandomBytes32",(function(){return s})),n.d(t,"deriveSharedKey",(function(){return a})),n.d(t,"sha256",(function(){return c})),n.d(t,"encrypt",(function(){return u})),n.d(t,"decrypt",(function(){return d})),n.d(t,"ERROR_TYPE",(function(){return f})),n.d(t,"ERROR",(function(){return _})),n.d(t,"REACT_NATIVE_PRODUCT",(function(){return l.f})),n.d(t,"ENV_MAP",(function(){return l.d})),n.d(t,"EMPTY_SPACE",(function(){return l.c})),n.d(t,"COLON",(function(){return l.a})),n.d(t,"SLASH",(function(){return l.g})),n.d(t,"DEFAULT_DEPTH",(function(){return l.b})),n.d(t,"ONE_THOUSAND",(function(){return l.e})),n.d(t,"isNode",(function(){return l.x})),n.d(t,"isReactNative",(function(){return l.y})),n.d(t,"isBrowser",(function(){return l.w})),n.d(t,"getEnvironment",(function(){return l.s})),n.d(t,"appendToQueryString",(function(){return l.h})),n.d(t,"getAppMetadata",(function(){return l.r})),n.d(t,"getRelayClientMetadata",(function(){return l.u})),n.d(t,"formatRelayRpcUrl",(function(){return l.o})),n.d(t,"assertType",(function(){return l.i})),n.d(t,"parseContextNames",(function(){return l.D})),n.d(t,"formatMessageContext",(function(){return l.n})),n.d(t,"formatStorageKeyName",(function(){return l.p})),n.d(t,"hasOverlap",(function(){return l.v})),n.d(t,"getLastItems",(function(){return l.t})),n.d(t,"mergeArrays",(function(){return l.B})),n.d(t,"mapToObj",(function(){return l.A})),n.d(t,"objToMap",(function(){return l.C})),n.d(t,"mapEntries",(function(){return l.z})),n.d(t,"enumify",(function(){return l.m})),n.d(t,"capitalizeWord",(function(){return l.l})),n.d(t,"capitalize",(function(){return l.k})),n.d(t,"toMiliseconds",(function(){return l.E})),n.d(t,"fromMiliseconds",(function(){return l.q})),n.d(t,"calcExpiry",(function(){return l.j})),n.d(t,"RELAYER_DEFAULT_PROTOCOL",(function(){return R})),n.d(t,"getRelayProtocolName",(function(){return m})),n.d(t,"getRelayProtocolApi",(function(){return S})),n.d(t,"formatUri",(function(){return N})),n.d(t,"parseUri",(function(){return b})),n.d(t,"isSignalTypePairing",(function(){return I})),n.d(t,"isSignalTypeUri",(function(){return w})),n.d(t,"isSequenceRespondedStatus",(function(){return A})),n.d(t,"isSequenceResponded",(function(){return P})),n.d(t,"isSequenceRejected",(function(){return C})),n.d(t,"isSequenceFailed",(function(){return U})),n.d(t,"isPairingRespondedStatus",(function(){return L})),n.d(t,"isPairingResponded",(function(){return D})),n.d(t,"isPairingRejected",(function(){return x})),n.d(t,"isPairingFailed",(function(){return M})),n.d(t,"isSessionRespondedStatus",(function(){return q})),n.d(t,"isSessionResponded",(function(){return j})),n.d(t,"isSessionRejected",(function(){return H})),n.d(t,"isSessionFailed",(function(){return V})),n.d(t,"isStoreUpdatedEvent",(function(){return K})),n.d(t,"validateSessionProposeParamsPermissions",(function(){return B})),n.d(t,"validateSessionProposeParamsMetadata",(function(){return G})),n.d(t,"validateSessionProposeParams",(function(){return k})),n.d(t,"validateSessionRespondParams",(function(){return Y})),n.d(t,"validateBlockchainPermissions",(function(){return J})),n.d(t,"validateJsonRpcPermissions",(function(){return F})),n.d(t,"validateNotificationPermissions",(function(){return z})),n.d(t,"validateBlockchainState",(function(){return X})),n.d(t,"isValidArray",(function(){return W})),n.d(t,"isValidString",(function(){return Q})),n.d(t,"isValidChainId",(function(){return $})),n.d(t,"isValidAccountId",(function(){return Z})),n.d(t,"isValidUrl",(function(){return ee})),n.d(t,"isValidationInvalid",(function(){return te})),n.d(t,"formatValidResult",(function(){return ne})),n.d(t,"formatInvalidResult",(function(){return re}));var r=n(21),i=n(1);function o(){const e=r.generateKeyPair();return{privateKey:i.arrayToHex(e.privateKey),publicKey:i.arrayToHex(e.publicKey)}}function s(){return i.arrayToHex(r.randomBytes(32))}function a(e,t){const n=r.derive(i.hexToArray(e),i.hexToArray(t));return i.arrayToHex(n)}async function c(e){const t=await r.sha256(i.hexToArray(e));return i.arrayToHex(t)}async function u(e){const t=i.utf8ToArray(e.message),n=i.hexToArray(e.sharedKey),o=i.hexToArray(e.publicKey),s=void 0!==e.iv?i.hexToArray(e.iv):void 0,a=await r.encryptWithSharedKey(t,n,o,s);return i.arrayToHex(a)}async function d(e){const t=i.hexToArray(e.encrypted),n=i.hexToArray(e.sharedKey),o=await r.decryptWithSharedKey(t,n);return i.arrayToUtf8(o)}var l=n(13);const f=Object(l.m)({GENERIC:"GENERIC",MISSING_OR_INVALID:"MISSING_OR_INVALID",MISSING_RESPONSE:"MISSING_RESPONSE",MISSING_DECRYPT_PARAMS:"MISSING_DECRYPT_PARAMS",INVALID_UPDATE_REQUEST:"INVALID_UPDATE_REQUEST",INVALID_UPGRADE_REQUEST:"INVALID_UPGRADE_REQUEST",INVALID_EXTEND_REQUEST:"INVALID_EXTEND_REQUEST",INVALID_STORAGE_KEY_NAME:"INVALID_STORAGE_KEY_NAME",RECORD_ALREADY_EXISTS:"RECORD_ALREADY_EXISTS",RESTORE_WILL_OVERRIDE:"RESTORE_WILL_OVERRIDE",NO_MATCHING_ID:"NO_MATCHING_ID",NO_MATCHING_TOPIC:"NO_MATCHING_TOPIC",NO_MATCHING_RESPONSE:"NO_MATCHING_RESPONSE",NO_MATCHING_KEY:"NO_MATCHING_KEY",UNKNOWN_JSONRPC_METHOD:"UNKNOWN_JSONRPC_METHOD",MISMATCHED_TOPIC:"MISMATCHED_TOPIC",MISMATCHED_ACCOUNTS:"MISMATCHED_ACCOUNTS",SETTLED:"SETTLED",NOT_APPROVED:"NOT_APPROVED",PROPOSAL_RESPONDED:"PROPOSAL_RESPONDED",RESPONSE_ACKNOWLEDGED:"RESPONSE_ACKNOWLEDGED",EXPIRED:"EXPIRED",DELETED:"DELETED",RESUBSCRIBED:"RESUBSCRIBED",SETTLE_TIMEOUT:"SETTLE_TIMEOUT",JSONRPC_REQUEST_TIMEOUT:"JSONRPC_REQUEST_TIMEOUT",UNAUTHORIZED_TARGET_CHAIN:"UNAUTHORIZED_TARGET_CHAIN",UNAUTHORIZED_JSON_RPC_METHOD:"UNAUTHORIZED_JSON_RPC_METHOD",UNAUTHORIZED_NOTIFICATION_TYPE:"UNAUTHORIZED_NOTIFICATION_TYPE",UNAUTHORIZED_UPDATE_REQUEST:"UNAUTHORIZED_UPDATE_REQUEST",UNAUTHORIZED_UPGRADE_REQUEST:"UNAUTHORIZED_UPGRADE_REQUEST",UNAUTHORIZED_EXTEND_REQUEST:"UNAUTHORIZED_EXTEND_REQUEST",UNAUTHORIZED_MATCHING_CONTROLLER:"UNAUTHORIZED_MATCHING_CONTROLLER",JSONRPC_REQUEST_METHOD_REJECTED:"JSONRPC_REQUEST_METHOD_REJECTED",JSONRPC_REQUEST_METHOD_UNAUTHORIZED:"JSONRPC_REQUEST_METHOD_UNAUTHORIZED",JSONRPC_REQUEST_METHOD_UNSUPPORTED:"JSONRPC_REQUEST_METHOD_UNSUPPORTED",DISCONNECTED_ALL_CHAINS:"DISCONNECTED_ALL_CHAINS",DISCONNECTED_TARGET_CHAIN:"DISCONNECTED_TARGET_CHAIN",DISAPPROVED_CHAINS:"DISAPPROVED_CHAINS",DISAPPROVED_JSONRPC:"DISAPPROVED_JSONRPC",DISAPPROVED_NOTIFICATION:"DISAPPROVED_NOTIFICATION",UNSUPPORTED_CHAINS:"UNSUPPORTED_CHAINS",UNSUPPORTED_JSONRPC:"UNSUPPORTED_JSONRPC",UNSUPPORTED_NOTIFICATION:"UNSUPPORTED_NOTIFICATION",UNSUPPORTED_SIGNAL:"UNSUPPORTED_SIGNAL",USER_DISCONNECTED:"USER_DISCONNECTED",UNKNOWN:"UNKNOWN"}),h="undefined",p="Something went wrong",g="parameter",E="session",y="Ethereum",_={[f.GENERIC]:{type:f.GENERIC,code:0,stringify:e=>(null==e?void 0:e.message)||p,format:e=>({code:_[f.GENERIC].code,message:_[f.GENERIC].stringify(e)})},[f.MISSING_OR_INVALID]:{type:f.MISSING_OR_INVALID,code:1e3,stringify:e=>"Missing or invalid "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.MISSING_OR_INVALID].code,message:_[f.MISSING_OR_INVALID].stringify(e)})},[f.MISSING_RESPONSE]:{type:f.MISSING_RESPONSE,code:1001,stringify:e=>`Response is required for approved ${(null==e?void 0:e.context)||E} proposals`,format:e=>({code:_[f.MISSING_RESPONSE].code,message:_[f.MISSING_RESPONSE].stringify(e)})},[f.MISSING_DECRYPT_PARAMS]:{type:f.MISSING_DECRYPT_PARAMS,code:1002,stringify:e=>"Decrypt params required for "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.MISSING_DECRYPT_PARAMS].code,message:_[f.MISSING_DECRYPT_PARAMS].stringify(e)})},[f.INVALID_UPDATE_REQUEST]:{type:f.INVALID_UPDATE_REQUEST,code:1003,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.INVALID_UPDATE_REQUEST].code,message:_[f.INVALID_UPDATE_REQUEST].stringify(e)})},[f.INVALID_UPGRADE_REQUEST]:{type:f.INVALID_UPGRADE_REQUEST,code:1004,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.INVALID_UPGRADE_REQUEST].code,message:_[f.INVALID_UPGRADE_REQUEST].stringify(e)})},[f.INVALID_EXTEND_REQUEST]:{type:f.INVALID_EXTEND_REQUEST,code:1005,stringify:e=>`Invalid ${(null==e?void 0:e.context)||E} extend request`,format:e=>({code:_[f.INVALID_EXTEND_REQUEST].code,message:_[f.INVALID_EXTEND_REQUEST].stringify(e)})},[f.INVALID_STORAGE_KEY_NAME]:{type:f.INVALID_STORAGE_KEY_NAME,code:1020,stringify:e=>"Invalid storage key name: "+((null==e?void 0:e.name)||g),format:e=>({code:_[f.INVALID_STORAGE_KEY_NAME].code,message:_[f.INVALID_STORAGE_KEY_NAME].stringify(e)})},[f.RECORD_ALREADY_EXISTS]:{type:f.RECORD_ALREADY_EXISTS,code:1100,stringify:e=>`Record already exists for ${(null==e?void 0:e.context)||E} matching id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.RECORD_ALREADY_EXISTS].code,message:_[f.RECORD_ALREADY_EXISTS].stringify(e)})},[f.RESTORE_WILL_OVERRIDE]:{type:f.RESTORE_WILL_OVERRIDE,code:1200,stringify:e=>"Restore will override already set "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.RESTORE_WILL_OVERRIDE].code,message:_[f.RESTORE_WILL_OVERRIDE].stringify(e)})},[f.NO_MATCHING_ID]:{type:f.NO_MATCHING_ID,code:1300,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.NO_MATCHING_ID].code,message:_[f.NO_MATCHING_ID].stringify(e)})},[f.NO_MATCHING_TOPIC]:{type:f.NO_MATCHING_TOPIC,code:1301,stringify:e=>`No matching ${(null==e?void 0:e.context)||E} with topic: ${null==e?void 0:e.topic}`,format:e=>({code:_[f.NO_MATCHING_TOPIC].code,message:_[f.NO_MATCHING_TOPIC].stringify(e)})},[f.NO_MATCHING_RESPONSE]:{type:f.NO_MATCHING_RESPONSE,code:1302,stringify:e=>`No response found in pending ${(null==e?void 0:e.context)||E} proposal`,format:e=>({code:_[f.NO_MATCHING_RESPONSE].code,message:_[f.NO_MATCHING_RESPONSE].stringify(e)})},[f.NO_MATCHING_KEY]:{type:f.NO_MATCHING_KEY,code:1303,stringify:e=>"No matching key with tag: "+(null==e?void 0:e.tag),format:e=>({code:_[f.NO_MATCHING_KEY].code,message:_[f.NO_MATCHING_KEY].stringify(e)})},[f.UNKNOWN_JSONRPC_METHOD]:{type:f.UNKNOWN_JSONRPC_METHOD,code:1400,stringify:e=>"Unknown JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNKNOWN_JSONRPC_METHOD].code,message:_[f.UNKNOWN_JSONRPC_METHOD].stringify(e)})},[f.MISMATCHED_TOPIC]:{type:f.MISMATCHED_TOPIC,code:1500,stringify:e=>`Mismatched topic for ${(null==e?void 0:e.context)||E} with id: ${null==e?void 0:e.id}`,format:e=>({code:_[f.MISMATCHED_TOPIC].code,message:_[f.MISMATCHED_TOPIC].stringify(e)})},[f.MISMATCHED_ACCOUNTS]:{type:f.MISMATCHED_ACCOUNTS,code:1501,stringify:e=>"Invalid accounts with mismatched chains: "+(null==e?void 0:e.mismatched.toString()),format:e=>({code:_[f.MISMATCHED_ACCOUNTS].code,message:_[f.MISMATCHED_ACCOUNTS].stringify(e)})},[f.SETTLED]:{type:f.SETTLED,code:1600,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" settled",format:e=>({code:_[f.SETTLED].code,message:_[f.SETTLED].stringify(e)})},[f.NOT_APPROVED]:{type:f.NOT_APPROVED,code:1601,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" not approved",format:e=>({code:_[f.NOT_APPROVED].code,message:_[f.NOT_APPROVED].stringify(e)})},[f.PROPOSAL_RESPONDED]:{type:f.PROPOSAL_RESPONDED,code:1602,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" proposal responded",format:e=>({code:_[f.PROPOSAL_RESPONDED].code,message:_[f.PROPOSAL_RESPONDED].stringify(e)})},[f.RESPONSE_ACKNOWLEDGED]:{type:f.RESPONSE_ACKNOWLEDGED,code:1603,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" response acknowledge",format:e=>({code:_[f.RESPONSE_ACKNOWLEDGED].code,message:_[f.RESPONSE_ACKNOWLEDGED].stringify(e)})},[f.EXPIRED]:{type:f.EXPIRED,code:1604,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" expired",format:e=>({code:_[f.EXPIRED].code,message:_[f.EXPIRED].stringify(e)})},[f.DELETED]:{type:f.DELETED,code:1605,stringify:e=>Object(l.k)((null==e?void 0:e.context)||E)+" deleted",format:e=>({code:_[f.DELETED].code,message:_[f.DELETED].stringify(e)})},[f.RESUBSCRIBED]:{type:f.RESUBSCRIBED,code:1606,stringify:e=>"Subscription resubscribed with topic: "+(e.topic||h),format:e=>({code:_[f.RESUBSCRIBED].code,message:_[f.RESUBSCRIBED].stringify(e)})},[f.SETTLE_TIMEOUT]:{type:f.SETTLE_TIMEOUT,code:2e3,stringify:e=>`${Object(l.k)((null==e?void 0:e.context)||E)} failed to settle after ${Object(l.q)(null==e?void 0:e.timeout)} seconds`,format:e=>({code:_[f.SETTLE_TIMEOUT].code,message:_[f.SETTLE_TIMEOUT].stringify(e)})},[f.JSONRPC_REQUEST_TIMEOUT]:{type:f.JSONRPC_REQUEST_TIMEOUT,code:2001,stringify:e=>`JSON-RPC Request timeout after ${Object(l.q)(null==e?void 0:e.timeout)} seconds: ${null==e?void 0:e.method}`,format:e=>({code:_[f.JSONRPC_REQUEST_TIMEOUT].code,message:_[f.JSONRPC_REQUEST_TIMEOUT].stringify(e)})},[f.UNAUTHORIZED_TARGET_CHAIN]:{type:f.UNAUTHORIZED_TARGET_CHAIN,code:3e3,stringify:e=>"Unauthorized Target ChainId Requested: "+(null==e?void 0:e.chainId),format:e=>({code:_[f.UNAUTHORIZED_TARGET_CHAIN].code,message:_[f.UNAUTHORIZED_TARGET_CHAIN].stringify(e)})},[f.UNAUTHORIZED_JSON_RPC_METHOD]:{type:f.UNAUTHORIZED_JSON_RPC_METHOD,code:3001,stringify:e=>"Unauthorized JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:_[f.UNAUTHORIZED_JSON_RPC_METHOD].code,message:_[f.UNAUTHORIZED_JSON_RPC_METHOD].stringify(e)})},[f.UNAUTHORIZED_NOTIFICATION_TYPE]:{type:f.UNAUTHORIZED_NOTIFICATION_TYPE,code:3002,stringify:e=>"Unauthorized Notification Type Requested: "+(null==e?void 0:e.type),format:e=>({code:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].code,message:_[f.UNAUTHORIZED_NOTIFICATION_TYPE].stringify(e)})},[f.UNAUTHORIZED_UPDATE_REQUEST]:{type:f.UNAUTHORIZED_UPDATE_REQUEST,code:3003,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} update request`,format:e=>({code:_[f.UNAUTHORIZED_UPDATE_REQUEST].code,message:_[f.UNAUTHORIZED_UPDATE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_UPGRADE_REQUEST]:{type:f.UNAUTHORIZED_UPGRADE_REQUEST,code:3004,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} upgrade request`,format:e=>({code:_[f.UNAUTHORIZED_UPGRADE_REQUEST].code,message:_[f.UNAUTHORIZED_UPGRADE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_EXTEND_REQUEST]:{type:f.UNAUTHORIZED_EXTEND_REQUEST,code:3005,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||E} extend request`,format:e=>({code:_[f.UNAUTHORIZED_EXTEND_REQUEST].code,message:_[f.UNAUTHORIZED_EXTEND_REQUEST].stringify(e)})},[f.UNAUTHORIZED_MATCHING_CONTROLLER]:{type:f.UNAUTHORIZED_MATCHING_CONTROLLER,code:3100,stringify:e=>`Unauthorized: peer is also ${(null==e?void 0:e.controller)?"":"not "}controller`,format:e=>({code:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].code,message:_[f.UNAUTHORIZED_MATCHING_CONTROLLER].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_REJECTED]:{type:f.JSONRPC_REQUEST_METHOD_REJECTED,code:4001,stringify:e=>"User rejected the request.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_REJECTED].code,message:_[f.JSONRPC_REQUEST_METHOD_REJECTED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED]:{type:f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED,code:4100,stringify:e=>"The requested account and/or method has not been authorized by the user.",format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED]:{type:f.JSONRPC_REQUEST_METHOD_UNSUPPORTED,code:4200,stringify:e=>`The requested method is not supported by this ${(null==e?void 0:e.blockhain)||y} provider.`,format:e=>({code:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].code,message:_[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].stringify(e)})},[f.DISCONNECTED_ALL_CHAINS]:{type:f.DISCONNECTED_ALL_CHAINS,code:4900,stringify:e=>"The provider is disconnected from all chains.",format:e=>({code:_[f.DISCONNECTED_ALL_CHAINS].code,message:_[f.DISCONNECTED_ALL_CHAINS].stringify(e)})},[f.DISCONNECTED_TARGET_CHAIN]:{type:f.DISCONNECTED_TARGET_CHAIN,code:4901,stringify:e=>"The provider is disconnected from the specified chain.",format:e=>({code:_[f.DISCONNECTED_TARGET_CHAIN].code,message:_[f.DISCONNECTED_TARGET_CHAIN].stringify(e)})},[f.DISAPPROVED_CHAINS]:{type:f.DISAPPROVED_CHAINS,code:5e3,stringify:e=>"User disapproved requested chains",format:e=>({code:_[f.DISAPPROVED_CHAINS].code,message:_[f.DISAPPROVED_CHAINS].stringify(e)})},[f.DISAPPROVED_JSONRPC]:{type:f.DISAPPROVED_JSONRPC,code:5001,stringify:e=>"User disapproved requested json-rpc methods",format:e=>({code:_[f.DISAPPROVED_JSONRPC].code,message:_[f.DISAPPROVED_JSONRPC].stringify(e)})},[f.DISAPPROVED_NOTIFICATION]:{type:f.DISAPPROVED_NOTIFICATION,code:5002,stringify:e=>"User disapproved requested notification types",format:e=>({code:_[f.DISAPPROVED_NOTIFICATION].code,message:_[f.DISAPPROVED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_CHAINS]:{type:f.UNSUPPORTED_CHAINS,code:5100,stringify:e=>"Requested chains are not supported: "+(null==e?void 0:e.chains.toString()),format:e=>({code:_[f.UNSUPPORTED_CHAINS].code,message:_[f.UNSUPPORTED_CHAINS].stringify(e)})},[f.UNSUPPORTED_JSONRPC]:{type:f.UNSUPPORTED_JSONRPC,code:5101,stringify:e=>"Requested json-rpc methods are not supported: "+(null==e?void 0:e.methods.toString()),format:e=>({code:_[f.UNSUPPORTED_JSONRPC].code,message:_[f.UNSUPPORTED_JSONRPC].stringify(e)})},[f.UNSUPPORTED_NOTIFICATION]:{type:f.UNSUPPORTED_NOTIFICATION,code:5102,stringify:e=>"Requested notification types are not supported: "+(null==e?void 0:e.types.toString()),format:e=>({code:_[f.UNSUPPORTED_NOTIFICATION].code,message:_[f.UNSUPPORTED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_SIGNAL]:{type:f.UNSUPPORTED_SIGNAL,code:5103,stringify:e=>`Proposed ${(null==e?void 0:e.context)||E} signal is unsupported`,format:e=>({code:_[f.UNSUPPORTED_SIGNAL].code,message:_[f.UNSUPPORTED_SIGNAL].stringify(e)})},[f.USER_DISCONNECTED]:{type:f.USER_DISCONNECTED,code:5900,stringify:e=>"User disconnected "+((null==e?void 0:e.context)||E),format:e=>({code:_[f.USER_DISCONNECTED].code,message:_[f.USER_DISCONNECTED].stringify(e)})},[f.UNKNOWN]:{type:f.UNKNOWN,code:9e3,stringify:e=>"Unknown error"+(e?": "+(null==e?void 0:e.toString()):""),format:e=>({code:_[f.UNKNOWN].code,message:_[f.UNKNOWN].stringify(e)})}};var v=n(85);const R="waku";function m(e){return(null==e?void 0:e.relay)||{protocol:R}}function S(e){const t=v.RELAY_JSONRPC[e];if(void 0===t)throw new Error("Relay Protocol not supported: "+e);return t}var T=n(23),O=n(19);function N(e){return`${e.protocol}:${e.topic}@${e.version}?`+T.stringify({publicKey:e.publicKey,controller:e.controller,relay:Object(O.safeJsonStringify)(e.relay)})}function b(e){const t=e.indexOf(":"),n=-1!==e.indexOf("?")?e.indexOf("?"):void 0,r=e.substring(0,t),i=e.substring(t+1,n).split("@"),o=void 0!==n?e.substr(n):"",s=T.parse(o);return{protocol:r,topic:i[0],version:parseInt(i[1],10),publicKey:s.publicKey,controller:"true"===s.controller,relay:Object(O.safeJsonParse)(s.relay)}}function I(e){return"pairing"===e.method}function w(e){return"uri"===e.method}function A(e){return"responded"===e}function P(e){return A(e.status)&&"outcome"in e}function C(e){return"reason"in e}function U(e){return"reason"in e}function L(e){return"responded"===e}function D(e){return L(e.status)&&"outcome"in e}function x(e){return"reason"in e}function M(e){return"reason"in e}function q(e){return"responded"===e}function j(e){return L(e.status)&&"outcome"in e}function H(e){return"reason"in e}function V(e){return"reason"in e}function K(e){return"update"in e}function B(e){const t=J(e.blockchain);if(te(t))return t;const n=F(e.jsonrpc);if(te(n))return n;const r=z(e.notifications);return te(r)?r:{valid:!0}}function G(e){return Q(e.name)?Q(e.description)?void 0!==e.url&&ee(e.url)?void 0!==e.icons&&W(e.icons,ee)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"metadata icons"})):re(_.MISSING_OR_INVALID.format({name:"metadata url"})):re(_.MISSING_OR_INVALID.format({name:"metadata description"})):re(_.MISSING_OR_INVALID.format({name:"metadata name"}))}function k(e){const t=B(e.permissions);if(te(t))return t;const n=G(e.metadata);return te(n)?n:{valid:!0}}function Y(e){if(e.approved){if(void 0===e.response)return re(_.MISSING_RESPONSE.format({context:"session"}));const t=X(e.response.state,e.proposal.permissions.blockchain);if(te(t))return t;const n=G(e.response.metadata);if(te(n))return n}return{valid:!0}}function J(e){return void 0!==e&&void 0!==e.chains&&W(e.chains,$)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}))}function F(e){return void 0!==e&&void 0!==e.methods&&W(e.methods,Q)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"jsonrpc permissions"}))}function z(e){return void 0!==e&&void 0!==e.types&&W(e.types,Q)?{valid:!0}:re(_.MISSING_OR_INVALID.format({name:"notification permissions"}))}function X(e,t){if(void 0===t||void 0===t.chains||!W(t.chains,$))return re(_.MISSING_OR_INVALID.format({name:"blockchain permissions"}));if(void 0===e||void 0===e.accounts||!W(e.accounts,Z))return re(_.MISSING_OR_INVALID.format({name:"state accounts"}));const n=e.accounts.filter(e=>{const[n,r]=e.split(":"),i=`${n}:${r}`;return!t.chains.includes(i)});return n.length?re(_.MISMATCHED_ACCOUNTS.format({mismatched:n})):{valid:!0}}function W(e,t){if(Array.isArray(e)){if(void 0!==t&&e.length){return e.filter(t).length===e.length}return!0}return!1}function Q(e){return"string"==typeof e&&!!e.trim()}function $(e){if(Q(e)&&e.includes(":")){return 2===e.split(":").length}return!1}function Z(e){if(Q(e)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&$(e)}}return!1}function ee(e){if(Q(e))try{return void 0!==new URL(e)}catch(e){return!1}return!1}function te(e){return"valid"in e&&!1===e.valid&&"error"in e&&"number"==typeof e.error.code&&"string"==typeof e.error.message}function ne(){return{valid:!0}}function re(e){return{valid:!1,error:e}}},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return h})),n.d(t,"e",(function(){return p})),n.d(t,"x",(function(){return g})),n.d(t,"y",(function(){return E})),n.d(t,"w",(function(){return y})),n.d(t,"s",(function(){return _})),n.d(t,"h",(function(){return v})),n.d(t,"r",(function(){return R})),n.d(t,"u",(function(){return m})),n.d(t,"o",(function(){return S})),n.d(t,"i",(function(){return T})),n.d(t,"D",(function(){return O})),n.d(t,"n",(function(){return N})),n.d(t,"p",(function(){return b})),n.d(t,"v",(function(){return I})),n.d(t,"t",(function(){return w})),n.d(t,"B",(function(){return A})),n.d(t,"A",(function(){return P})),n.d(t,"C",(function(){return C})),n.d(t,"z",(function(){return U})),n.d(t,"m",(function(){return L})),n.d(t,"l",(function(){return D})),n.d(t,"k",(function(){return x})),n.d(t,"E",(function(){return M})),n.d(t,"q",(function(){return q})),n.d(t,"j",(function(){return j}));var r=n(83),i=n.n(r),o=n(23),s=n(84),a=n(24);const c="ReactNative",u={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},d=" ",l=":",f="/",h=2,p=1e3;function g(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}function E(){return!Object(a.getDocument)()&&!!Object(a.getNavigator)()&&navigator.product===c}function y(){return!g()&&!!Object(a.getNavigator)()}function _(){return E()?u.reactNative:g()?u.node:y()?u.browser:u.unknown}function v(e,t){let n=o.parse(e);return n=Object.assign(Object.assign({},n),t),e=o.stringify(n)}function R(){return Object(s.getWindowMetadata)()||void 0}function m(e,t){var n;const r=_(),i={protocol:e,version:t,env:r};return"browser"===r&&(i.host=(null===(n=Object(a.getLocation)())||void 0===n?void 0:n.host)||""),i}function S(e,t,n,r){const i=n.split("?"),o=m(e,t),s=r?Object.assign(Object.assign({},o),{projectId:r}):o,a=v(i[1]||"",s);return i[0]+"?"+a}function T(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function O(e,t=h){return w(e.split(f),t)}function N(e){return O(e).join(d)}function b(e){return O(e).join(l)}function I(e,t){return e.filter(e=>t.includes(e)).length===e.length}function w(e,t=h){return e.slice(Math.max(e.length-t,0))}function A(e,t){return i()(e,t)}function P(e){return Object.fromEntries(e.entries())}function C(e){return new Map(Object.entries(e))}function U(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const L=e=>e;function D(e){return e.trim().replace(/^\w/,e=>e.toUpperCase())}function x(e){return e.split(d).map(e=>D(e)).join(d)}function M(e){return e*p}function q(e){return Math.floor(e/p)}function j(e,t){return q((t||Date.now())+M(e))}}).call(this,n(58))},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l}));var r=n(6),i=n(0);async function o(e,t=i.a){return r.getSubtleCrypto().importKey("raw",e,function(e){return e===i.a?{length:i.b,name:i.a}:{hash:{name:i.g},name:i.f}}(t),!0,function(e){return e===i.a?[i.d,i.c]:[i.p,i.q]}(t))}async function s(e,t,n){const s=r.getSubtleCrypto(),a=await o(t,i.a),c=await s.encrypt({iv:e,name:i.a},a,n);return new Uint8Array(c)}async function a(e,t,n){const s=r.getSubtleCrypto(),a=await o(t,i.a),c=await s.decrypt({iv:e,name:i.a},a,n);return new Uint8Array(c)}async function c(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),a=await n.sign({length:i.h,name:i.f},s,t);return new Uint8Array(a)}async function u(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),a=await n.sign({length:i.l,name:i.f},s,t);return new Uint8Array(a)}async function d(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.n},e);return new Uint8Array(n)}async function l(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.o},e);return new Uint8Array(n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"h",(function(){return f})),n.d(t,"b",(function(){return h}));var r=n(35),i=n(1),o=n(3);function s(e,t){return r.sharedKey(e,t)}function a(e){const t=void 0!==e?function(e){return{isAvailable:!0,randomBytes:()=>e}}(e):void 0,n=r.generateKeyPair(t);return{publicKey:n.publicKey,privateKey:n.secretKey}}function c(e){const t=(null==e?void 0:e.sender)||a();return{privateKey:t.privateKey,publicKey:t.publicKey}}function u(e,t){return s(e,t)}function d(e){return new Uint8Array(e.slice(o.LENGTH_0,o.KEY_LENGTH))}function l(e){return new Uint8Array(e.slice(o.KEY_LENGTH))}function f(e){return Object(i.concatArrays)(e.iv,e.publicKey,e.mac,e.ciphertext)}function h(e){const t=o.LENGTH_0,n=t+o.IV_LENGTH,r=n+o.KEY_LENGTH,i=r+o.MAC_LENGTH,s=e.length;return{iv:e.slice(t,n),publicKey:e.slice(n,r),mac:e.slice(r,i),ciphertext:e.slice(i,s)}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l}));var r=n(7);function i(e){return Object(r.c)(e,"subscribe")}function o(e){return Object(r.b)(e,["topic"],[])}function s(e){return Object(r.c)(e,"publish")}function a(e){return Object(r.b)(e,["message","topic","ttl"],["prompt"])}function c(e){return Object(r.c)(e,"unsubscribe")}function u(e){return Object(r.b)(e,["id","topic"],[])}function d(e){return Object(r.c)(e,"subscription")}function l(e){return Object(r.b)(e,["id","data"],[])}},function(e,t,n){"use strict";n.r(t);var r=n(38);n.d(t,"IClient",(function(){return r.a}));var i=n(42);n.d(t,"IKeyChain",(function(){return i.b})),n.d(t,"ICrypto",(function(){return i.a}));var o=n(43);n.d(t,"IEncoder",(function(){return o.a}));var s=n(44);n.d(t,"IEngine",(function(){return s.a}));var a=n(45);n.d(t,"IExpirer",(function(){return a.a}));var c=n(46);n.d(t,"IHeartBeat",(function(){return c.a}));var u=n(47);n.d(t,"IJsonRpcHistory",(function(){return u.a}));var d=n(48);for(var l in d)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){n.d(t,e,(function(){return d[e]}))}(l);var f=n(49);for(var l in f)["default","IClient","IKeyChain","ICrypto","IEncoder","IEngine","IExpirer","IHeartBeat","IJsonRpcHistory"].indexOf(l)<0&&function(e){n.d(t,e,(function(){return f[e]}))}(l);var h=n(50);n.d(t,"IPairing",(function(){return h.a}));var p=n(51);n.d(t,"IPublisher",(function(){return p.a}));var g=n(52);n.d(t,"IRelayerEncoder",(function(){return g.b})),n.d(t,"IRelayer",(function(){return g.a}));var E=n(22);n.d(t,"ISequence",(function(){return E.a}));var y=n(53);n.d(t,"ISession",(function(){return y.a}));var _=n(54);n.d(t,"IStore",(function(){return _.a}));var v=n(55);n.d(t,"IBaseStorage",(function(){return v.a})),n.d(t,"IRelayerStorage",(function(){return v.b})),n.d(t,"IStorage",(function(){return v.c}));var R=n(56);n.d(t,"ISubscriberTopicMap",(function(){return R.b})),n.d(t,"ISubscriber",(function(){return R.a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_SECOND=t.FIVE_SECONDS=t.TEN_SECONDS=t.THIRTY_SECONDS=t.FIVE_MINUTES=t.SIX_HOURS=t.ONE_DAY=t.SEVEN_DAYS=t.THREE_WEEKS=t.THIRTY_DAYS=void 0,t.THIRTY_DAYS=2592e3,t.THREE_WEEKS=1814400,t.SEVEN_DAYS=604800,t.ONE_DAY=86400,t.SIX_HOURS=21600,t.FIVE_MINUTES=300,t.THIRTY_SECONDS=30,t.TEN_SECONDS=10,t.FIVE_SECONDS=5,t.ONE_SECOND=1},function(e,t,n){"use strict";function r(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}}function i(e){return"string"==typeof e?e:JSON.stringify(e)}n.r(t),n.d(t,"safeJsonParse",(function(){return r})),n.d(t,"safeJsonStringify",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return d}));var r=n(4);function i(e){return e<=r.h[0]&&e>=r.h[1]}function o(e){return r.f.includes(e)}function s(e){return"number"==typeof e}function a(e){return Object.keys(r.i).includes(e)?r.i[e]:r.i[r.a]}function c(e){const t=Object.values(r.i).find(t=>t.code===e);return t||r.i[r.a]}function u(e){if(void 0===e.error.code)return{valid:!1,error:"Missing code for JSON-RPC error"};if(void 0===e.error.message)return{valid:!1,error:"Missing message for JSON-RPC error"};if(!s(e.error.code))return{valid:!1,error:"Invalid error code type for JSON-RPC: "+e.error.code};if(o(e.error.code)){const t=c(e.error.code);if(t.message!==r.i[r.a].message&&e.error.message===t.message)return{valid:!1,error:"Invalid error code message for JSON-RPC: "+e.error.code}}return{valid:!0}}function d(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}},function(e,t,n){"use strict";var r=n(3);n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"randomBytes")&&n.d(t,"randomBytes",(function(){return r.randomBytes})),n.o(r,"sha256")&&n.d(t,"sha256",(function(){return r.sha256}));var i=n(66);n.d(t,"decryptWithSharedKey",(function(){return i.a})),n.d(t,"encryptWithSharedKey",(function(){return i.b}));var o=n(15);n.d(t,"derive",(function(){return o.a})),n.d(t,"generateKeyPair",(function(){return o.c}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";const r=n(107),i=n(108),o=n(109),s=n(110);function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function l(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const i="string"==typeof n&&n.includes(e.arrayFormatSeparator),o="string"==typeof n&&!i&&u(n,e).includes(e.arrayFormatSeparator);n=o?u(n,e):n;const s=i||o?n.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===n?n:u(n,e);r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const i of e.split("&")){if(""===i)continue;let[e,s]=o(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(t.arrayFormat)?s:u(s,t),n(u(e,t),s,r)}for(const e of Object.keys(r)){const n=r[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=f(n[e],t);else r[e]=f(n,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce((e,t)=>{const n=r[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=l,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],r=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const i=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[",i,"]"].join("")]:[...n,[c(t,e),"[",c(i,e),"]=",c(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[]"].join("")]:[...n,[c(t,e),"[]=",c(r,e)].join("")];case"comma":case"separator":return t=>(n,r)=>null==r||0===r.length?n:0===n.length?[[c(t,e),"=",c(r,e)].join("")]:[[n,c(r,e)].join(e.arrayFormatSeparator)];default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,c(t,e)]:[...n,[c(t,e),"=",c(r,e)].join("")]}}(t),i={};for(const t of Object.keys(e))n(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map(n=>{const i=e[n];return void 0===i?"":null===i?c(n,t):Array.isArray(i)?i.reduce(r(n),[]).join("&"):c(n,t)+"="+c(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=o(e,"#");return Object.assign({url:n.split("?")[0]||"",query:h(l(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:u(r,t)}:{})},t.stringifyUrl=(e,n)=>{n=Object.assign({encode:!0,strict:!0},n);const r=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),s=Object.assign(o,e.query);let a=t.stringify(s,n);a&&(a="?"+a);let u=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(u="#"+c(e.fragmentIdentifier,n)),`${r}${a}${u}`},t.pick=(e,n,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:i,query:o,fragmentIdentifier:a}=t.parseUrl(e,r);return t.stringifyUrl({url:i,query:s(o,n),fragmentIdentifier:a},r)},t.exclude=(e,n,r)=>{const i=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,i,r)}},function(e,t,n){"use strict";function r(e){let t=void 0;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function i(e){const t=r(e);if(!t)throw new Error(e+" is not defined in Window");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalStorage=t.getLocalStorageOrThrow=t.getCrypto=t.getCryptoOrThrow=t.getLocation=t.getLocationOrThrow=t.getNavigator=t.getNavigatorOrThrow=t.getDocument=t.getDocumentOrThrow=t.getFromWindowOrThrow=t.getFromWindow=void 0,t.getFromWindow=r,t.getFromWindowOrThrow=i,t.getDocumentOrThrow=function(){return i("document")},t.getDocument=function(){return r("document")},t.getNavigatorOrThrow=function(){return i("navigator")},t.getNavigator=function(){return r("navigator")},t.getLocationOrThrow=function(){return i("location")},t.getLocation=function(){return r("location")},t.getCryptoOrThrow=function(){return i("crypto")},t.getCrypto=function(){return r("crypto")},t.getLocalStorageOrThrow=function(){return i("localStorage")},t.getLocalStorage=function(){return r("localStorage")}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{}},function(e,t,n){"use strict";var r=n(61);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}));n(62);var i=n(63);n.o(i,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return i.ERROR_BAD_MAC})),n.o(i,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return i.IV_LENGTH})),n.o(i,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return i.KEY_LENGTH})),n.o(i,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return i.LENGTH_0})),n.o(i,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return i.MAC_LENGTH})),n.o(i,"assert")&&n.d(t,"assert",(function(){return i.assert})),n.o(i,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return i.decryptWithSharedKey})),n.o(i,"derive")&&n.d(t,"derive",(function(){return i.derive})),n.o(i,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return i.encryptWithSharedKey})),n.o(i,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return i.generateKeyPair})),n.o(i,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return i.isConstantTime}));var o=n(64);n.d(t,"assert",(function(){return o.a})),n.d(t,"isConstantTime",(function(){return o.b}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcHistory=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),a=n(8),c=n(11),u=n(9);class d extends o.IJsonRpcHistory{constructor(e,t){super(e,t),this.logger=e,this.storage=t,this.records=new Map,this.events=new i.EventEmitter,this.name=u.HISTORY_CONTEXT,this.cached=[],this.logger=c.generateChildLogger(e,this.name),this.storage=t,this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return c.getLoggerContext(this.logger)}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(void 0!==t.response)return;const n={topic:t.topic,request:a.formatJsonRpcRequest(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),this.records.has(t.id))return;const r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n};this.records.set(r.id,r),this.events.emit(u.HISTORY_EVENTS.created,r)}))}resolve(e){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=yield this.getRecord(e.id);void 0===t.response&&(t.response=a.isJsonRpcError(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.events.emit(u.HISTORY_EVENTS.updated,t))}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t});const n=yield this.getRecord(t);if(n.topic!==e){const e=s.ERROR.MISMATCHED_TOPIC.format({context:s.formatMessageContext(this.context),id:t});throw new Error(e.message)}return n}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(n=>{if(n.topic===e){if(void 0!==t&&n.id!==t)return;this.records.delete(n.id),this.events.emit(u.HISTORY_EVENTS.deleted,n)}})}))}exists(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.records.has(t))return!1;return(yield this.getRecord(t)).topic===e}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getRecord(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.records.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.storage.setJsonRpcRecords(this.context,this.values),this.events.emit(u.HISTORY_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.storage.getJsonRpcRecords(this.context);if(void 0===e)return;if(!e.length)return;if(this.records.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored records for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.records.set(e.id,e))}onInit(){this.cached=[],this.events.emit(u.HISTORY_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(u.HISTORY_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(u.HISTORY_EVENTS.created,e=>{const t=u.HISTORY_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.updated,e=>{const t=u.HISTORY_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.deleted,e=>{const t=u.HISTORY_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}}t.JsonRpcHistory=d},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(10),i=n(19),o=n(8);const s=void 0!==e.WebSocket?e.WebSocket:n(130);class a{constructor(e){if(this.url=e,this.events=new r.EventEmitter,this.registering=!1,!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);this.url=e}get connected(){return void 0!==this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(void 0===this.socket)throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){void 0===this.socket&&(this.socket=await this.register());try{this.socket.send(Object(i.safeJsonStringify)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);return this.registering?new Promise((e,t)=>{this.events.once("register_error",e=>{t(e)}),this.events.once("open",()=>{if(void 0===this.socket)return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)})}):(this.url=e,this.registering=!0,new Promise((t,n)=>{const r=Object(o.isReactNative)()?void 0:{rejectUnauthorized:!Object(o.isLocalhostUrl)(e)},i=new s(e,[],r);i.onopen=()=>{this.onOpen(i),t(i)},i.onerror=e=>{const t=this.parseError(e.error);this.events.emit("register_error",t),this.onClose(),n(t)}}))}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=()=>this.onClose(),e.onerror=e=>{const t=this.parseError(e.error);this.events.emit("error",t)},this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(void 0===e.data)return;const t="string"==typeof e.data?Object(i.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),r=n.message||n.toString(),i=Object(o.formatJsonRpcError)(e,r);this.events.emit("payload",i)}parseError(e,t=this.url){return Object(o.parseConnectionError)(e,t,"WS")}}t.b=a}).call(this,n(25))},function(e,t,n){"use strict";const r=n(88);e.exports=s;const i=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},o={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)void 0===t[n]&&(t[n]=e[n]);return t}};function s(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const n=e.browser.write||i;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},o=function(e,t){if(Array.isArray(e)){return e.filter((function(e){return"!stdSerializers.err"!==e}))}return!0===e&&Object.keys(t)}(e.browser.serialize,r);let c=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);"function"==typeof n&&(n.error=n.fatal=n.warn=n.info=n.debug=n.trace=n),!1===e.enabled&&(e.level="silent");const l=e.level||"info",p=Object.create(n);p.log||(p.log=E),Object.defineProperty(p,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,a(g,p,"error","log"),a(g,p,"fatal","error"),a(g,p,"warn","error"),a(g,p,"info","log"),a(g,p,"debug","log"),a(g,p,"trace","log")}});const g={transmit:t,serialize:o,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:h(e)};return p.levels=s.levels,p.level=l,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=E,p.serializers=r,p._serialize=o,p._stdErrSerialize=c,p.child=function(n,i){if(!n)throw new Error("missing bindings for child Pino");i=i||{},o&&n.serializers&&(i.serializers=n.serializers);const s=i.serializers;if(o&&s){var a=Object.assign({},r,s),c=!0===e.browser.serialize?Object.keys(a):o;delete n.serializers,u([n],c,a,this._stdErrSerialize)}function l(e){this._childLevel=1+(0|e._childLevel),this.error=d(e,n,"error"),this.fatal=d(e,n,"fatal"),this.warn=d(e,n,"warn"),this.info=d(e,n,"info"),this.debug=d(e,n,"debug"),this.trace=d(e,n,"trace"),a&&(this.serializers=a,this._serialize=c),t&&(this._logEvent=f([].concat(e._logEvent.bindings,n)))}return l.prototype=this,new l(this)},t&&(p._logEvent=f()),p}function a(e,t,n,r){const o=Object.getPrototypeOf(t);t[n]=t.levelVal>t.levels.values[n]?E:o[n]?o[n]:i[n]||i[r]||E,function(e,t,n){if(!e.transmit&&t[n]===E)return;t[n]=(r=t[n],function(){const o=e.timestamp(),a=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var f=0;f<a.length;f++)a[f]=arguments[f];if(e.serialize&&!e.asObject&&u(a,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?r.call(d,c(this,n,a,o)):r.apply(d,a),e.transmit){const r=e.transmit.level||t.level,i=s.levels.values[r],c=s.levels.values[n];if(c<i)return;l(this,{ts:o,methodLevel:n,methodValue:c,transmitLevel:r,transmitValue:s.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},a)}});var r}(e,t,n)}function c(e,t,n,i){e._serialize&&u(n,e._serialize,e.serializers,e._stdErrSerialize);const o=n.slice();let a=o[0];const c={};i&&(c.time=i),c.level=s.levels.values[t];let d=1+(0|e._childLevel);if(d<1&&(d=1),null!==a&&"object"==typeof a){for(;d--&&"object"==typeof o[0];)Object.assign(c,o.shift());a=o.length?r(o.shift(),o):void 0}else"string"==typeof a&&(a=r(o.shift(),o));return void 0!==a&&(c.msg=a),c}function u(e,t,n,r){for(const i in e)if(r&&e[i]instanceof Error)e[i]=s.stdSerializers.err(e[i]);else if("object"==typeof e[i]&&!Array.isArray(e[i]))for(const r in e[i])t&&t.indexOf(r)>-1&&r in n&&(e[i][r]=n[r](e[i][r]))}function d(e,t,n){return function(){const r=new Array(1+arguments.length);r[0]=t;for(var i=1;i<r.length;i++)r[i]=arguments[i-1];return e[n].apply(this,r)}}function l(e,t,n){const r=t.send,i=t.ts,o=t.methodLevel,s=t.methodValue,a=t.val,c=e._logEvent.bindings;u(n,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=n.filter((function(e){return-1===c.indexOf(e)})),e._logEvent.level.label=o,e._logEvent.level.value=s,r(o,e._logEvent,a),e._logEvent=f(c)}function f(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function h(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?y:_}function p(){return{}}function g(e){return e}function E(){}function y(){return!1}function _(){return Date.now()}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=o,s.stdTimeFunctions=Object.assign({},{nullTime:y,epochTime:_,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const r=n(5),i=n(17),o=n(12),s=n(8),a=n(9);class c extends i.IEngine{constructor(e){super(e),this.sequence=e,this.registerEventListeners()}find(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.sequence.values.filter(t=>{var n,r,i,s,a,c;let u=!1;return(null===(n=t.permissions)||void 0===n?void 0:n.jsonrpc)&&(null===(r=e.jsonrpc)||void 0===r?void 0:r.methods)&&o.hasOverlap(e.jsonrpc.methods,t.permissions.jsonrpc.methods)&&(u=!0),(null===(i=t.permissions)||void 0===i?void 0:i.blockchain)&&(null===(s=e.blockchain)||void 0===s?void 0:s.chains)&&o.hasOverlap(e.blockchain.chains,t.permissions.blockchain.chains)&&(u=!0),(null===(a=t.permissions)||void 0===a?void 0:a.notifications)&&(null===(c=e.notifications)||void 0===c?void 0:c.types)&&o.hasOverlap(e.notifications.types,t.permissions.notifications.types)&&(u=!0),u})}))}ping(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n={method:this.sequence.config.jsonrpc.ping,params:{}};return this.request({topic:e,request:n,timeout:t||o.toMiliseconds(a.THIRTY_SECONDS)})}))}send(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=t,i=yield this.sequence.settled.get(e);let o=!1;if(s.isJsonRpcRequest(t)&&!Object.values(this.sequence.config.jsonrpc).includes(t.method)){yield this.isJsonRpcAuthorized(e,i.self,t),yield this.sequence.validateRequest({topic:e,request:t,chainId:n});const r={chainId:n,request:{method:t.method,params:t.params}};r.chainId||delete r.chainId,o=!0,t=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.payload,r,t.id)}yield this.sequence.client.relayer.publish(i.topic,t,{relay:i.relay,prompt:o}),(s.isJsonRpcResponse(r)||s.isJsonRpcRequest(r)&&!Object.values(this.sequence.config.jsonrpc).includes(r.method))&&(yield this.recordPayloadEvent({topic:e,payload:r,chainId:n}))}))}get length(){return this.sequence.settled.length}get topics(){return this.sequence.settled.topics}get values(){return this.sequence.settled.values}create(e){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Create "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"create",params:e});const i=(null==e?void 0:e.timeout)||o.toMiliseconds(a.FIVE_MINUTES),s=setTimeout(()=>{const e=o.ERROR.SETTLE_TIMEOUT.format({context:this.sequence.name,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);let c;try{c=yield this.propose(e)}catch(e){return clearTimeout(s),n(e)}this.sequence.pending.on(a.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){if(c.topic===e.sequence.topic&&o.isSequenceResponded(e.sequence)){const r=e.sequence.outcome;if(clearTimeout(s),o.isSequenceFailed(r)){try{yield this.sequence.pending.delete(c.topic,r.reason)}catch(e){return n(e)}n(new Error(r.reason.message))}else try{const e=yield this.sequence.settled.get(r.topic),n=o.ERROR.SETTLED.format({context:this.sequence.name});yield this.sequence.pending.delete(c.topic,n),t(e)}catch(e){return n(e)}}})))})))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Respond "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"respond",params:e}),yield this.sequence.validateRespond(e);const{approved:t,proposal:n,response:r}=e,{relay:i,ttl:s}=n,a={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==r?void 0:r.metadata};if(a.metadata||delete a.metadata,!t){const t=o.ERROR.NOT_APPROVED.format({context:this.sequence.name}),r={reason:(null==e?void 0:e.reason)||t},s={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:r};return yield this.sequence.pending.set(s.topic,s),s}try{const e={publicKey:a.publicKey,metadata:null==r?void 0:r.metadata};e.metadata||delete e.metadata;const t=o.calcExpiry(n.ttl),c=(null==r?void 0:r.state)||{},u={publicKey:n.proposer.publicKey,metadata:n.proposer.metadata};u.metadata||delete u.metadata;const d=n.proposer.controller?{publicKey:u.publicKey}:{publicKey:a.publicKey},l=Object.assign(Object.assign({},n.permissions),{controller:d}),f={topic:(yield this.settle({relay:i,self:a,peer:u,permissions:l,state:c,ttl:s,expiry:t})).topic,relay:i,state:c,responder:e,expiry:t},h={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:f};return yield this.sequence.pending.set(h.topic,h),h}catch(e){const t={reason:o.ERROR.GENERIC.format({message:e.message})},r={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:t};return yield this.sequence.pending.set(r.topic,r),r}}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Update "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"update",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpdate(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.update,r);return yield this.send(t.topic,i),t}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Upgrade "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"upgrade",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpgrade(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.upgrade,r);return yield this.send(t.topic,i),t}))}extend(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Extend "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"extend",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey};if(e.ttl>(yield this.sequence.getDefaultTTL())){const e=o.ERROR.INVALID_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}let r={expiry:o.calcExpiry(e.ttl)};r=yield this.handleExtension(e.topic,r,n);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.extend,r);return yield this.send(t.topic,i),t}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){try{yield this.sequence.validateRequest(e)}catch(e){return n(e)}const r=s.formatJsonRpcRequest(e.request.method,e.request.params),i=(null==e?void 0:e.timeout)||o.toMiliseconds(a.FIVE_MINUTES),c=setTimeout(()=>{const e=o.ERROR.JSONRPC_REQUEST_TIMEOUT.format({method:r.method,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);this.sequence.events.on(this.sequence.config.events.response,i=>{if(e.topic!==i.topic)return;const o=i.response;if(o.id===r.id){if(clearTimeout(c),s.isJsonRpcError(o)){const e=o.error.message;return this.sequence.logger.error(e),n(new Error(e))}return t(o.result)}});try{yield this.send(e.topic,r,null==e?void 0:e.chainId)}catch(e){return clearTimeout(c),n(e)}})))}))}delete(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Delete "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"delete",params:e}),yield this.sequence.settled.delete(e.topic,e.reason)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,notification:n}=e,r=yield this.sequence.settled.get(e.topic);yield this.isNotificationAuthorized(e.topic,r.self,n.type);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.notification,n);yield this.send(e.topic,i)}))}propose(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Propose "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"propose",params:e}),yield this.sequence.validatePropose(e);const t=(null==e?void 0:e.relay)||{protocol:a.RELAYER_DEFAULT_PROTOCOL},n=o.generateRandomBytes32(),r={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==e?void 0:e.metadata};r.metadata||delete r.metadata;const i={publicKey:r.publicKey,controller:this.sequence.client.controller,metadata:r.metadata};i.metadata||delete i.metadata;const s={relay:t,topic:n,proposer:i,signal:(null==e?void 0:e.signal)||(yield this.sequence.getDefaultSignal({topic:n,relay:t,proposer:i})),permissions:(null==e?void 0:e.permissions)||(yield this.sequence.getDefaultPermissions()),ttl:(null==e?void 0:e.ttl)||(yield this.sequence.getDefaultTTL())},c={status:this.sequence.config.status.proposed,topic:s.topic,relay:s.relay,self:r,proposal:s};return yield this.sequence.pending.set(c.topic,c),c}))}settle(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Settle "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"settle",params:e});const t={topic:yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer),relay:e.relay,self:e.self,peer:e.peer,permissions:e.permissions,expiry:e.expiry,state:e.state,acknowledged:!1};return yield this.sequence.settled.set(t.topic,t),t}))}onResponse(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} response`),this.sequence.logger.trace({type:"method",method:"onResponse",topic:t,payload:n});const r=n,i=r.params,a=yield this.sequence.pending.get(t);let c,u;if(o.isSequenceRejected(i))this.sequence.logger.error(i.reason),yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{reason:i.reason}});else{try{const e=a.proposal.proposer.controller?{publicKey:a.proposal.proposer.publicKey}:{publicKey:i.responder.publicKey},n={publicKey:i.responder.publicKey,metadata:i.responder.metadata};n.metadata||delete n.metadata;const r=i.state||{},o=Object.assign(Object.assign({},a.proposal.permissions),{controller:e}),s=yield this.settle({relay:a.relay,self:a.self,peer:n,permissions:o,ttl:a.proposal.ttl,expiry:i.expiry,state:r}),c={topic:s.topic,relay:s.relay,responder:i.responder,expiry:s.expiry,state:s.state};yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:c})}catch(e){this.sequence.logger.error(e),c=o.ERROR.GENERIC.format({message:e.message}),u={reason:c},yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:u})}yield this.sequence.client.relayer.publish(a.topic,void 0===c?s.formatJsonRpcResult(r.id,!0):s.formatJsonRpcError(r.id,c),{relay:a.relay}),void 0===u||o.isSequenceFailed(u)||(yield this.sequence.settled.update(u.topic,{acknowledged:!0}))}}))}onAcknowledge(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} acknowledge`),this.sequence.logger.trace({type:"method",method:"onAcknowledge",topic:t,payload:n});const r=n,i=yield this.sequence.pending.get(t);if(!o.isSequenceResponded(i))return;const{outcome:a}=i;s.isJsonRpcError(r)&&!o.isSequenceFailed(a)&&(yield this.sequence.settled.delete(a.topic,r.error)),void 0===a||o.isSequenceFailed(a)||(yield this.sequence.settled.update(a.topic,{acknowledged:!0}));const c=o.ERROR.RESPONSE_ACKNOWLEDGED.format({context:this.sequence.name});yield this.sequence.pending.delete(t,c)}))}onMessage(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(this.sequence.logger.debug(`Receiving ${this.sequence.context} message`),this.sequence.logger.trace({type:"method",method:"onMessage",topic:t,payload:n}),s.isJsonRpcRequest(n)){const t=n,r=yield this.sequence.settled.get(e.topic);let i;switch(t.method){case this.sequence.config.jsonrpc.payload:yield this.onPayload(e);break;case this.sequence.config.jsonrpc.update:yield this.onUpdate(e);break;case this.sequence.config.jsonrpc.upgrade:yield this.onUpgrade(e);break;case this.sequence.config.jsonrpc.extend:yield this.onExtension(e);break;case this.sequence.config.jsonrpc.notification:yield this.onNotification(e);break;case this.sequence.config.jsonrpc.delete:yield this.sequence.settled.delete(r.topic,t.params.reason);break;case this.sequence.config.jsonrpc.ping:yield this.send(r.topic,s.formatJsonRpcResult(t.id,!0));break;default:i=o.ERROR.UNKNOWN_JSONRPC_METHOD.format({method:t.method}),this.sequence.logger.error(i.message),yield this.send(r.topic,s.formatJsonRpcError(t.id,i))}}else this.onPayloadEvent(e)}))}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(s.isJsonRpcRequest(n)){const{id:e,params:r}=n,{chainId:i}=r,o=s.formatJsonRpcRequest(r.request.method,r.request.params,e),a=yield this.sequence.settled.get(t);yield this.isJsonRpcAuthorized(t,a.peer,o),yield this.sequence.validateRequest({topic:t,request:o,chainId:i});const c={topic:t,payload:o,chainId:i};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},c)),this.onPayloadEvent(c)}else{const e={topic:t,payload:n};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},e)),this.onPayloadEvent(e)}}))}onUpdate(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} update`),this.sequence.logger.trace({type:"method",method:"onUpdate",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpdate(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onUpgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} upgrade`),this.sequence.logger.trace({type:"method",method:"onUpgrade",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpgrade(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onExtension(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} extension`),this.sequence.logger.trace({type:"method",method:"onExtension",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleExtension(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onNotification(e){return r.__awaiter(this,void 0,void 0,(function*(){const{params:t}=e.payload,n=e.payload,r=yield this.sequence.settled.get(e.topic);try{yield this.isNotificationAuthorized(e.topic,r.peer,t.type);const i={topic:e.topic,notification:t},o=this.sequence.config.events.notification;this.sequence.logger.info("Emitting "+o),this.sequence.logger.debug({type:"event",event:o,notificationEvent:i}),this.sequence.events.emit(o,i);const a=s.formatJsonRpcResult(n.id,!0);yield this.send(r.topic,a)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(n.id,e.message);yield this.send(r.topic,t)}}))}handleUpdate(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.state){const e=o.ERROR.INVALID_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPDATE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpdate(e,t);return yield this.sequence.settled.update(r.topic,{state:i}),t}))}handleUpgrade(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.permissions){const e=o.ERROR.INVALID_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPGRADE_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const i=yield this.sequence.mergeUpgrade(e,t);return yield this.sequence.settled.update(r.topic,{permissions:i}),t}))}handleExtension(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.expiry){const e=o.ERROR.INVALID_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_EXTEND_REQUEST.format({context:this.sequence.name});throw this.sequence.logger.error(e.message),new Error(e.message)}return t=yield this.sequence.mergeExtension(e,t),yield this.sequence.settled.update(r.topic,t),t}))}isJsonRpcAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&!r.permissions.jsonrpc.methods.includes(n.method)){const e=o.ERROR.UNAUTHORIZED_JSON_RPC_METHOD.format({method:n.method});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}isNotificationAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&r.self.publicKey!==r.permissions.controller.publicKey&&!r.permissions.notifications.types.includes(n)){const e=o.ERROR.UNAUTHORIZED_NOTIFICATION_TYPE.format({type:n});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}recordPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,chainId:r}=e;s.isJsonRpcRequest(n)?yield this.sequence.history.set(t,n,r):yield this.sequence.history.resolve(n)}))}shouldIgnorePayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(!this.sequence.settled.sequences.has(t))return!0;let r=!1;try{if(s.isJsonRpcRequest(n))r=yield this.sequence.history.exists(t,n.id);else{let e;try{e=yield this.sequence.history.get(t,n.id)}catch(e){}r=void 0!==e&&void 0!==e.response}}catch(e){}return r}))}onPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,chainId:r}=e;if(!(yield this.shouldIgnorePayloadEvent(e))){if(s.isJsonRpcRequest(n)){const e={topic:t,request:n,chainId:r},i=this.sequence.config.events.request;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}else{const e={topic:t,response:n,chainId:r},i=this.sequence.config.events.response;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,sequence:e}),this.sequence.events.emit(i,e)}yield this.recordPayloadEvent(e)}}))}onPendingPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){if(s.isJsonRpcRequest(e.payload))switch(e.payload.method){case this.sequence.config.jsonrpc.approve:case this.sequence.config.jsonrpc.reject:this.onResponse(e)}else this.onAcknowledge(e)}))}onPendingStatusEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;if(o.isSignalTypePairing(t.proposal.signal)&&!(yield this.sequence.client.crypto.hasKeys(t.proposal.topic))){const e=yield this.sequence.client.pairing.settled.get(t.proposal.signal.params.topic);yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer,t.proposal.topic)}if(o.isSequenceResponded(t)){const n=this.sequence.config.events.responded;if(this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,sequence:t}),this.sequence.events.emit(n,t),!o.isStoreUpdatedEvent(e)){const{topic:e,outcome:n,relay:r}=t,i=o.isSequenceFailed(n)?this.sequence.config.jsonrpc.reject:this.sequence.config.jsonrpc.approve,a=o.isSequenceFailed(n)?{reason:n.reason}:{relay:n.relay,responder:n.responder,expiry:n.expiry,state:n.state},c=s.formatJsonRpcRequest(i,a);yield this.sequence.client.relayer.publish(e,c,{relay:r})}}else{const e=this.sequence.config.events.proposed;if(this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t}),this.sequence.events.emit(e,t),o.isSignalTypePairing(t.proposal.signal)){const e=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.propose,t.proposal);yield this.sequence.client.pairing.send(t.proposal.signal.params.topic,e)}}}))}subscribeNewPending(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:n}=e,r=o.calcExpiry(a.ONE_DAY);yield this.sequence.client.relayer.subscribe(t,{relay:n.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:r})}))}subscribeNewSettled(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,sequence:n}=e,{expiry:r}=n;yield this.sequence.client.relayer.subscribe(t,{relay:n.relay}),yield this.sequence.expirer.set(t,{topic:t,expiry:r})}))}registerEventListeners(){this.sequence.pending.on(a.STORE_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewPending(e),yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(a.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.onPendingStatusEvent(e)}))),this.sequence.pending.on(a.STORE_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t}=e;yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(a.STORE_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){yield this.subscribeNewSettled(e);const{sequence:t}=e,n=this.sequence.config.events.settled;this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,sequence:t}),this.sequence.events.emit(n,t)}))),this.sequence.settled.on(a.STORE_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,update:n}=e;if(void 0!==n.state){const e=this.sequence.config.events.updated;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,update:n}),this.sequence.events.emit(e,t,n)}else if(void 0!==n.permissions){const e=this.sequence.config.events.upgraded,r=n;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,upgrade:r}),this.sequence.events.emit(e,t,r)}else if(void 0!==n.expiry){const e=this.sequence.config.events.extended,r=n;this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,sequence:t,extension:r}),this.sequence.events.emit(e,t,r)}}))),this.sequence.settled.on(a.STORE_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const{sequence:t,reason:n}=e,r=this.sequence.config.events.deleted;this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,sequence:t,reason:n}),this.sequence.events.emit(r,t,n);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.delete,{reason:n});yield this.sequence.history.delete(t.topic),yield this.sequence.client.relayer.publish(t.topic,i,{relay:t.relay}),yield this.sequence.client.relayer.unsubscribe(t.topic,{relay:t.relay}),yield this.sequence.expirer.del(t.topic)}))),this.sequence.settled.on(a.STORE_EVENTS.sync,()=>this.sequence.events.emit(this.sequence.config.events.sync)),this.sequence.client.relayer.on(a.RELAYER_EVENTS.payload,e=>{this.sequence.pending.sequences.has(e.topic)?this.onPendingPayloadEvent(e):this.sequence.settled.sequences.has(e.topic)&&this.onMessage(e)}),this.sequence.expirer.on(a.EXPIRER_EVENTS.expired,e=>r.__awaiter(this,void 0,void 0,(function*(){if(this.sequence.pending.sequences.has(e.topic)){const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.pending.context)});this.sequence.pending.delete(e.topic,t)}else{const t=o.ERROR.EXPIRED.format({context:o.formatMessageContext(this.sequence.settled.context)});this.sequence.settled.delete(e.topic,t)}})))}}t.Engine=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Expirer=void 0;const r=n(5),i=n(10),o=n(17),s=n(11),a=n(12),c=n(9);class u extends o.IExpirer{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.expirations=new Map,this.events=new i.EventEmitter,this.name=c.EXPIRER_CONTEXT,this.cached=[],this.client,this.logger=s.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return s.getLoggerContext(this.logger)}get length(){return this.expirations.size}get topics(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}has(e){return r.__awaiter(this,void 0,void 0,(function*(){try{return void 0!==this.getExpiration(e)}catch(e){return!1}}))}set(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.expirations.set(e,t),this.checkExpiry(e,t),this.events.emit(c.EXPIRER_EVENTS.created,{topic:e,expiration:t})}))}get(e){return r.__awaiter(this,void 0,void 0,(function*(){return yield this.isInitialized(),this.getExpiration(e)}))}del(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.getExpiration(e);this.expirations.delete(e),this.events.emit(c.EXPIRER_EVENTS.deleted,{topic:e,expiration:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(c.EXPIRER_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.expirations.size){const e=a.ERROR.RESTORE_WILL_OVERRIDE.format({context:a.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored expirations for "+a.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug("Failed to Restore expirations for "+a.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.expirations.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(c.EXPIRER_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(c.EXPIRER_EVENTS.init,()=>e())})}))}getExpiration(e){const t=this.expirations.get(e);if(!t){const t=a.ERROR.NO_MATCHING_ID.format({context:a.formatMessageContext(this.context),topic:e});throw new Error(t.message)}return t}checkExpiry(e,t){const{expiry:n}=t;a.toMiliseconds(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(c.EXPIRER_EVENTS.expired,{topic:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.client.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(c.EXPIRER_EVENTS.created,e=>{const t=c.EXPIRER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.EXPIRER_EVENTS.expired,e=>{const t=c.EXPIRER_EVENTS.expired;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(c.EXPIRER_EVENTS.deleted,e=>{const t=c.EXPIRER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Expirer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),a=n(9),c=n(11);class u extends o.IStore{constructor(e,t,n){super(e,t,n),this.client=e,this.logger=t,this.name=n,this.sequences=new Map,this.events=new i.EventEmitter,this.cached=[],this.logger=c.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return c.getLoggerContext(this.logger)}get length(){return this.sequences.size}get topics(){return Array.from(this.sequences.keys())}get values(){return Array.from(this.sequences.values())}set(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.sequences.has(e)?this.update(e,t):(this.logger.debug("Setting sequence"),this.logger.trace({type:"method",method:"set",topic:e,sequence:t}),this.sequences.set(e,t),this.events.emit(a.STORE_EVENTS.created,{topic:e,sequence:t}))}))}get(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Getting sequence"),this.logger.trace({type:"method",method:"get",topic:e});return yield this.getSequence(e)}))}update(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized(),this.logger.debug("Updating sequence"),this.logger.trace({type:"method",method:"update",topic:e,update:t});const n=Object.assign(Object.assign({},yield this.getSequence(e)),t);this.sequences.set(e,n),this.events.emit(a.STORE_EVENTS.updated,{topic:e,sequence:n,update:t})}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isInitialized(),!this.sequences.has(e))return;this.logger.debug("Deleting sequence"),this.logger.trace({type:"method",method:"delete",topic:e,reason:t});const n=yield this.getSequence(e);this.sequences.delete(e),this.events.emit(a.STORE_EVENTS.deleted,{topic:e,sequence:n,reason:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getSequence(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isInitialized();const t=this.sequences.get(e);if(!t){const t=s.ERROR.NO_MATCHING_TOPIC.format({context:s.formatMessageContext(this.context),topic:e});throw this.logger.error(t.message),new Error(t.message)}return t}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setSequenceStore(this.context,this.values),this.events.emit(a.STORE_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getSequenceStore(this.context);if(void 0===e)return;if(!e.length)return;if(this.sequences.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored sequences for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",sequences:this.values})}catch(e){this.logger.debug("Failed to Restore sequences for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),this.reset(),this.onInit()}))}reset(){this.cached.forEach(e=>this.sequences.set(e.topic,e))}onInit(){this.cached=[],this.events.emit(a.STORE_EVENTS.init)}isInitialized(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(a.STORE_EVENTS.init,()=>e())})}))}registerEventListeners(){this.events.on(a.STORE_EVENTS.created,e=>{const t=a.STORE_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.STORE_EVENTS.updated,e=>{const t=a.STORE_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.STORE_EVENTS.deleted,e=>{const t=a.STORE_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Store=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(100),i=n(31);function o(e){var t=new Float64Array(16);if(e)for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;var s=new Uint8Array(32);s[0]=9;var a=o([56129,1]);function c(e){for(var t=1,n=0;n<16;n++){var r=e[n]+t+65535;t=Math.floor(r/65536),e[n]=r-65536*t}e[0]+=t-1+37*(t-1)}function u(e,t,n){for(var r=~(n-1),i=0;i<16;i++){var o=r&(e[i]^t[i]);e[i]^=o,t[i]^=o}}function d(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]+n[r]}function l(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]-n[r]}function f(e,t,n){var r,i,o=0,s=0,a=0,c=0,u=0,d=0,l=0,f=0,h=0,p=0,g=0,E=0,y=0,_=0,v=0,R=0,m=0,S=0,T=0,O=0,N=0,b=0,I=0,w=0,A=0,P=0,C=0,U=0,L=0,D=0,x=0,M=n[0],q=n[1],j=n[2],H=n[3],V=n[4],K=n[5],B=n[6],G=n[7],k=n[8],Y=n[9],J=n[10],F=n[11],z=n[12],X=n[13],W=n[14],Q=n[15];o+=(r=t[0])*M,s+=r*q,a+=r*j,c+=r*H,u+=r*V,d+=r*K,l+=r*B,f+=r*G,h+=r*k,p+=r*Y,g+=r*J,E+=r*F,y+=r*z,_+=r*X,v+=r*W,R+=r*Q,s+=(r=t[1])*M,a+=r*q,c+=r*j,u+=r*H,d+=r*V,l+=r*K,f+=r*B,h+=r*G,p+=r*k,g+=r*Y,E+=r*J,y+=r*F,_+=r*z,v+=r*X,R+=r*W,m+=r*Q,a+=(r=t[2])*M,c+=r*q,u+=r*j,d+=r*H,l+=r*V,f+=r*K,h+=r*B,p+=r*G,g+=r*k,E+=r*Y,y+=r*J,_+=r*F,v+=r*z,R+=r*X,m+=r*W,S+=r*Q,c+=(r=t[3])*M,u+=r*q,d+=r*j,l+=r*H,f+=r*V,h+=r*K,p+=r*B,g+=r*G,E+=r*k,y+=r*Y,_+=r*J,v+=r*F,R+=r*z,m+=r*X,S+=r*W,T+=r*Q,u+=(r=t[4])*M,d+=r*q,l+=r*j,f+=r*H,h+=r*V,p+=r*K,g+=r*B,E+=r*G,y+=r*k,_+=r*Y,v+=r*J,R+=r*F,m+=r*z,S+=r*X,T+=r*W,O+=r*Q,d+=(r=t[5])*M,l+=r*q,f+=r*j,h+=r*H,p+=r*V,g+=r*K,E+=r*B,y+=r*G,_+=r*k,v+=r*Y,R+=r*J,m+=r*F,S+=r*z,T+=r*X,O+=r*W,N+=r*Q,l+=(r=t[6])*M,f+=r*q,h+=r*j,p+=r*H,g+=r*V,E+=r*K,y+=r*B,_+=r*G,v+=r*k,R+=r*Y,m+=r*J,S+=r*F,T+=r*z,O+=r*X,N+=r*W,b+=r*Q,f+=(r=t[7])*M,h+=r*q,p+=r*j,g+=r*H,E+=r*V,y+=r*K,_+=r*B,v+=r*G,R+=r*k,m+=r*Y,S+=r*J,T+=r*F,O+=r*z,N+=r*X,b+=r*W,I+=r*Q,h+=(r=t[8])*M,p+=r*q,g+=r*j,E+=r*H,y+=r*V,_+=r*K,v+=r*B,R+=r*G,m+=r*k,S+=r*Y,T+=r*J,O+=r*F,N+=r*z,b+=r*X,I+=r*W,w+=r*Q,p+=(r=t[9])*M,g+=r*q,E+=r*j,y+=r*H,_+=r*V,v+=r*K,R+=r*B,m+=r*G,S+=r*k,T+=r*Y,O+=r*J,N+=r*F,b+=r*z,I+=r*X,w+=r*W,A+=r*Q,g+=(r=t[10])*M,E+=r*q,y+=r*j,_+=r*H,v+=r*V,R+=r*K,m+=r*B,S+=r*G,T+=r*k,O+=r*Y,N+=r*J,b+=r*F,I+=r*z,w+=r*X,A+=r*W,P+=r*Q,E+=(r=t[11])*M,y+=r*q,_+=r*j,v+=r*H,R+=r*V,m+=r*K,S+=r*B,T+=r*G,O+=r*k,N+=r*Y,b+=r*J,I+=r*F,w+=r*z,A+=r*X,P+=r*W,C+=r*Q,y+=(r=t[12])*M,_+=r*q,v+=r*j,R+=r*H,m+=r*V,S+=r*K,T+=r*B,O+=r*G,N+=r*k,b+=r*Y,I+=r*J,w+=r*F,A+=r*z,P+=r*X,C+=r*W,U+=r*Q,_+=(r=t[13])*M,v+=r*q,R+=r*j,m+=r*H,S+=r*V,T+=r*K,O+=r*B,N+=r*G,b+=r*k,I+=r*Y,w+=r*J,A+=r*F,P+=r*z,C+=r*X,U+=r*W,L+=r*Q,v+=(r=t[14])*M,R+=r*q,m+=r*j,S+=r*H,T+=r*V,O+=r*K,N+=r*B,b+=r*G,I+=r*k,w+=r*Y,A+=r*J,P+=r*F,C+=r*z,U+=r*X,L+=r*W,D+=r*Q,R+=(r=t[15])*M,s+=38*(S+=r*j),a+=38*(T+=r*H),c+=38*(O+=r*V),u+=38*(N+=r*K),d+=38*(b+=r*B),l+=38*(I+=r*G),f+=38*(w+=r*k),h+=38*(A+=r*Y),p+=38*(P+=r*J),g+=38*(C+=r*F),E+=38*(U+=r*z),y+=38*(L+=r*X),_+=38*(D+=r*W),v+=38*(x+=r*Q),o=(r=(o+=38*(m+=r*q))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),R=(r=R+i+65535)-65536*(i=Math.floor(r/65536)),o=(r=(o+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),R=(r=R+i+65535)-65536*(i=Math.floor(r/65536)),o+=i-1+37*(i-1),e[0]=o,e[1]=s,e[2]=a,e[3]=c,e[4]=u,e[5]=d,e[6]=l,e[7]=f,e[8]=h,e[9]=p,e[10]=g,e[11]=E,e[12]=y,e[13]=_,e[14]=v,e[15]=R}function h(e,t){f(e,t,t)}function p(e,t){for(var n=new Uint8Array(32),r=new Float64Array(80),i=o(),s=o(),p=o(),g=o(),E=o(),y=o(),_=0;_<31;_++)n[_]=e[_];n[31]=127&e[31]|64,n[0]&=248,function(e,t){for(var n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}(r,t);for(_=0;_<16;_++)s[_]=r[_];i[0]=g[0]=1;for(_=254;_>=0;--_){var v=n[_>>>3]>>>(7&_)&1;u(i,s,v),u(p,g,v),d(E,i,p),l(i,i,p),d(p,s,g),l(s,s,g),h(g,E),h(y,i),f(i,p,i),f(p,s,E),d(E,i,p),l(i,i,p),h(s,i),l(p,g,y),f(i,p,a),d(i,i,g),f(p,p,i),f(i,g,y),f(g,s,r),h(s,E),u(i,s,v),u(p,g,v)}for(_=0;_<16;_++)r[_+16]=i[_],r[_+32]=p[_],r[_+48]=s[_],r[_+64]=g[_];var R=r.subarray(32),m=r.subarray(16);!function(e,t){for(var n=o(),r=0;r<16;r++)n[r]=t[r];for(r=253;r>=0;r--)h(n,n),2!==r&&4!==r&&f(n,n,t);for(r=0;r<16;r++)e[r]=n[r]}(R,R),f(m,m,R);var S=new Uint8Array(32);return function(e,t){for(var n=o(),r=o(),i=0;i<16;i++)r[i]=t[i];c(r),c(r),c(r);for(var s=0;s<2;s++){n[0]=r[0]-65517;for(i=1;i<15;i++)n[i]=r[i]-65535-(n[i-1]>>16&1),n[i-1]&=65535;n[15]=r[15]-32767-(n[14]>>16&1);var a=n[15]>>16&1;n[14]&=65535,u(r,n,1-a)}for(i=0;i<16;i++)e[2*i]=255&r[i],e[2*i+1]=r[i]>>8}(S,m),S}function g(e){return p(e,s)}function E(e){if(e.length!==t.SECRET_KEY_LENGTH)throw new Error("x25519: seed must be "+t.SECRET_KEY_LENGTH+" bytes");var n=new Uint8Array(e);return{publicKey:g(n),secretKey:n}}t.scalarMult=p,t.scalarMultBase=g,t.generateKeyPairFromSeed=E,t.generateKeyPair=function(e){var t=r.randomBytes(32,e),n=E(t);return i.wipe(t),n},t.sharedKey=function(e,n,r){if(void 0===r&&(r=!1),e.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(n.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");var i=p(e,n);if(r){for(var o=0,s=0;s<i.length;s++)o|=i[s];if(0===o)throw new Error("X25519: invalid shared key")}return i}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(89)),s=n(37),a=n(90);class c{constructor(){this.localStorage=o.default}getKeys(){return r(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return r(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(a.parseEntry)}))}getItem(e){return r(this,void 0,void 0,(function*(){const t=this.localStorage.getItem(e);if(null!==t)return s.safeJsonParse(t)}))}setItem(e,t){return r(this,void 0,void 0,(function*(){this.localStorage.setItem(e,s.safeJsonStringify(t))}))}removeItem(e){return r(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}}t.KeyValueStorage=c,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=function(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}},t.safeJsonStringify=function(e){return"string"==typeof e?e:JSON.stringify(e,(e,t)=>void 0===t?null:t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e){super(),this.protocol="wc",this.version=2}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s}));var r=n(26);class i extends r.a{constructor(e){super()}}class o extends r.a{constructor(){super()}}class s extends o{constructor(e){super()}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));class r{constructor(e,t){this.client=e,this.logger=t}}class i{constructor(e,t,n){this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e,t){this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.sequence=e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e){super()}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.logger=e,this.storage=t,this.records=new Map}}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(2);class i{}class o extends r.IEvents{constructor(e){super()}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);class i extends r.IEvents{constructor(e,t,n){super(),this.client=e,this.logger=t,this.name=n}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}));class r{constructor(e,t,n){this.logger=e,this.keyValueStorage=t,this.config=n}}class i extends r{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}}class o extends i{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(2);class i{constructor(){this.map=new Map}}class o extends r.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(6);function i(e){return r.getBrowerCrypto().getRandomValues(new Uint8Array(e))}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],d=!1,l=-1;function f(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&h())}function h(){if(!d){var e=a(f);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||d||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(14);function i(e,t,n){return Object(r.b)(e,t,n)}function o(e,t,n){return Object(r.a)(e,t,n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(14),i=n(27);async function o(e,t){return await Object(r.c)(e,t)}async function s(e,t,n){const o=await Object(r.c)(e,t);return Object(i.isConstantTime)(o,n)}},function(e,t,n){"use strict";var r=n(6);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}))},function(e,t,n){"use strict"},function(e,t){},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(14);async function i(e){return await Object(r.e)(e)}async function o(e){return await Object(r.f)(e)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));var r=n(3),i=n(1),o=n(15);async function s(e){const t=await Object(r.sha512)(e);return{encryptionKey:Object(o.d)(t),macKey:Object(o.e)(t)}}async function a(e,t,n,a=Object(r.randomBytes)(r.IV_LENGTH)){const{encryptionKey:c,macKey:u}=await s(t),d=await Object(r.aesCbcEncrypt)(a,c,e),l=Object(i.concatArrays)(a,n,d),f=await Object(r.hmacSha256Sign)(u,l);return Object(o.h)({iv:a,publicKey:n,ciphertext:d,mac:f})}async function c(e,t){const{iv:n,publicKey:a,mac:c,ciphertext:u}=Object(o.b)(e),{encryptionKey:d,macKey:l}=await s(t),f=Object(i.concatArrays)(n,a,u),h=await Object(r.hmacSha256Verify)(l,f,c);Object(r.assert)(h,r.ERROR_BAD_MAC);return await Object(r.aesCbcDecrypt)(n,d,u)}},function(e,t,n){"use strict";(function(e){
=======
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("WalletConnect",[],e):"object"==typeof exports?exports.WalletConnect=e():t.WalletConnect=e()}(this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=41)}([function(t,e,r){"use strict";(function(t){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.removeHexLeadingZeros=e.sanitizeHex=e.addHexPrefix=e.removeHexPrefix=e.padRight=e.padLeft=e.sanitizeBytes=e.swapHex=e.swapBytes=e.splitBytes=e.calcByteLength=e.trimRight=e.trimLeft=e.concatArrays=e.concatBuffers=e.getEncoding=e.getType=e.isArrayBuffer=e.isTypedArray=e.isBuffer=e.isHexString=e.isBinaryString=e.binaryToNumber=e.binaryToUtf8=e.binaryToHex=e.binaryToArray=e.binaryToBuffer=e.numberToBinary=e.numberToUtf8=e.numberToHex=e.numberToArray=e.numberToBuffer=e.utf8ToBinary=e.utf8ToNumber=e.utf8ToHex=e.utf8ToArray=e.utf8ToBuffer=e.hexToBinary=e.hexToNumber=e.hexToUtf8=e.hexToArray=e.hexToBuffer=e.arrayToBinary=e.arrayToNumber=e.arrayToUtf8=e.arrayToHex=e.arrayToBuffer=e.bufferToBinary=e.bufferToNumber=e.bufferToUtf8=e.bufferToHex=e.bufferToArray=void 0;const i=n(r(16)),o=n(r(48));function s(t){return new Uint8Array(t)}function a(t,e=!1){const r=t.toString("hex");return e?P(r):r}function u(t){return t.toString("utf8")}function h(t){return t.readUIntBE(0,t.length)}function c(t){return o.default(t)}function f(t,e=!1){return a(c(t),e)}function l(t){return u(c(t))}function d(t){return h(c(t))}function p(t){return Array.from(t).map(b).join("")}function m(e){return t.from(C(e),"hex")}function g(t){return s(m(t))}function y(t){return p(g(t))}function v(e){return t.from(e,"utf8")}function w(t){return s(v(t))}function b(t){return B((t>>>0).toString(2))}function _(t){return c(M(t))}function M(t){return new Uint8Array(R(t).map(t=>parseInt(t,2)))}function S(t,e){return f(M(t),e)}function T(t){return!("string"!=typeof t||!new RegExp(/^[01]+$/).test(t))&&t.length%8==0}function O(t,e){return!("string"!=typeof t||!t.match(/^0x[0-9A-Fa-f]*$/))&&(!e||t.length===2+2*e)}function A(e){return t.isBuffer(e)}function k(t){return i.default.strict(t)&&!A(t)}function x(t){return!k(t)&&!A(t)&&void 0!==t.byteLength}function I(t,e=8){const r=t%e;return r?(t-r)/e*e+e:t}function R(t,e=8){const r=B(t).match(new RegExp(`.{${e}}`,"gi"));return Array.from(r||[])}function E(t){return R(t).map(U).join("")}function B(t,e=8,r="0"){return j(t,I(t.length,e),r)}function j(t,e,r="0"){return N(t,e,!0,r)}function C(t){return t.replace(/^0x/,"")}function P(t){return t.startsWith("0x")?t:"0x"+t}function U(t){return t.split("").reverse().join("")}function N(t,e,r,n="0"){const i=e-t.length;let o=t;if(i>0){const e=n.repeat(i);o=r?e+t:t+e}return o}e.bufferToArray=s,e.bufferToHex=a,e.bufferToUtf8=u,e.bufferToNumber=h,e.bufferToBinary=function(t){return p(s(t))},e.arrayToBuffer=c,e.arrayToHex=f,e.arrayToUtf8=l,e.arrayToNumber=d,e.arrayToBinary=p,e.hexToBuffer=m,e.hexToArray=g,e.hexToUtf8=function(t){return u(m(t))},e.hexToNumber=function(t){return d(g(t))},e.hexToBinary=y,e.utf8ToBuffer=v,e.utf8ToArray=w,e.utf8ToHex=function(t,e=!1){return a(v(t),e)},e.utf8ToNumber=function(t){const e=parseInt(t,10);return function(t,e){if(!t)throw new Error(e)}(!function(t){return void 0===t}(e),"Number can only safely store up to 53 bits"),e},e.utf8ToBinary=function(t){return p(w(t))},e.numberToBuffer=function(t){return _(b(t))},e.numberToArray=function(t){return M(b(t))},e.numberToHex=function(t,e){return S(b(t),e)},e.numberToUtf8=function(t){return""+t},e.numberToBinary=b,e.binaryToBuffer=_,e.binaryToArray=M,e.binaryToHex=S,e.binaryToUtf8=function(t){return l(M(t))},e.binaryToNumber=function(t){return d(M(t))},e.isBinaryString=T,e.isHexString=O,e.isBuffer=A,e.isTypedArray=k,e.isArrayBuffer=x,e.getType=function(t){return A(t)?"buffer":k(t)?"typed-array":x(t)?"array-buffer":Array.isArray(t)?"array":typeof t},e.getEncoding=function(t){return T(t)?"binary":O(t)?"hex":"utf8"},e.concatBuffers=function(...e){return t.concat(e)},e.concatArrays=function(...t){let e=[];return t.forEach(t=>e=e.concat(Array.from(t))),new Uint8Array([...e])},e.trimLeft=function(t,e){const r=t.length-e;return r>0&&(t=t.slice(r)),t},e.trimRight=function(t,e){return t.slice(0,e)},e.calcByteLength=I,e.splitBytes=R,e.swapBytes=E,e.swapHex=function(t){return S(E(y(t)))},e.sanitizeBytes=B,e.padLeft=j,e.padRight=function(t,e,r="0"){return N(t,e,!1,r)},e.removeHexPrefix=C,e.addHexPrefix=P,e.sanitizeHex=function(t){return(t=B(t=C(t),2))&&(t=P(t)),t},e.removeHexLeadingZeros=function(t){const e=t.startsWith("0x");return t=(t=C(t)).startsWith("0")?t.substring(1):t,e?P(t):t}}).call(this,r(15).Buffer)},function(t,e,r){"use strict";var n=r(35),i=r(5),o=r(36);function s(t){return Object(o.a)(t)}function a(){const t=s();return t&&t.os?t.os:void 0}function u(){return!!a()&&(function(){const t=a();return!!t&&t.toLowerCase().includes("android")}()||function(){const t=a();return!!t&&(t.toLowerCase().includes("ios")||t.toLowerCase().includes("mac")&&navigator.maxTouchPoints>1)}())}function h(){return!function(){const t=s();return!(!t||!t.name)&&"node"===t.name.toLowerCase()}()&&!!c()}i.getFromWindow,i.getFromWindowOrThrow,i.getDocumentOrThrow,i.getDocument,i.getNavigatorOrThrow;const c=i.getNavigator,f=(i.getLocationOrThrow,i.getLocation),l=(i.getCryptoOrThrow,i.getCrypto,i.getLocalStorageOrThrow,i.getLocalStorage);function d(){return n.getWindowMetadata()}const p=function(t){if("string"!=typeof t)throw new Error("Cannot safe json parse value of type "+typeof t);try{return JSON.parse(t)}catch(e){return t}},m=function(t){return"string"==typeof t?t:JSON.stringify(t)};function g(t,e){const r=m(e),n=l();n&&n.setItem(t,r)}function y(t){let e=null,r=null;const n=l();return n&&(r=n.getItem(t)),e=r?p(r):r,e}function v(t){const e=l();e&&e.removeItem(t)}const w=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],b=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var _=r(11),M=r.n(_),S=r(0);function T(t){return S.arrayToBuffer(new Uint8Array(t))}function O(t,e){return S.arrayToHex(new Uint8Array(t),!e)}function A(t){return S.bufferToArray(t).buffer}function k(t){return S.hexToArray(t).buffer}function x(t,e){const r=S.removeHexPrefix(S.sanitizeHex(new M.a(t).toString(16)));return e?r:S.addHexPrefix(r)}var I=r(37);function R(t){return S.sanitizeHex(t)}const E=r(38).payloadId;function B(){return((t,e)=>{for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e})()}function j(t,e){return S.isHexString(t,e)}function C(t){return void 0!==t.method}function P(t){return void 0!==t.result}function U(t){return void 0!==t.error}function N(t){return void 0!==t.event}function L(t){return w.includes(t)||t.startsWith("wc_")}function q(t){return!!t.method.startsWith("wc_")||!b.includes(t.method)}function D(t){t=Object(S.removeHexPrefix)(t.toLowerCase());const e=Object(S.removeHexPrefix)(Object(I.keccak_256)((r=t,S.utf8ToBuffer(r))));var r;let n="";for(let r=0;r<t.length;r++)parseInt(e[r],16)>7?n+=t[r].toUpperCase():n+=t[r];return Object(S.addHexPrefix)(n)}function W(t){var e,r,n;return(n=t)&&n.length&&!j(t[0])&&(t[0]=(e=t[0],S.utf8ToHex(e,!r))),t}function H(t){if(void 0!==t.type&&"0"!==t.type)return t;if(void 0===t.from||(!(e=t.from)||"0x"!==e.toLowerCase().substring(0,2)||!/^(0x)?[0-9a-f]{40}$/i.test(e)||!/^(0x)?[0-9a-f]{40}$/.test(e)&&!/^(0x)?[0-9A-F]{40}$/.test(e)&&e!==D(e)))throw new Error("Transaction object must include a valid 'from' value.");var e;function r(t){let e=t;var r;return("number"==typeof t||"string"==typeof t&&!function(t){return""===t||"string"==typeof t&&""===t.trim()}(t))&&(j(t)?"string"==typeof t&&(e=R(t)):e=x(t)),"string"==typeof e&&(r=e,e=S.removeHexLeadingZeros(S.addHexPrefix(r))),e}const n={from:R(t.from),to:void 0===t.to?"":R(t.to),gasPrice:void 0===t.gasPrice?"":r(t.gasPrice),gas:void 0===t.gas?void 0===t.gasLimit?"":r(t.gasLimit):r(t.gas),value:void 0===t.value?"":r(t.value),nonce:void 0===t.nonce?"":r(t.nonce),data:void 0===t.data?"":R(t.data)||"0x"},i=["gasPrice","gas","value","nonce"];return Object.keys(n).forEach(t=>{!n[t].trim().length&&i.includes(t)&&delete n[t]}),n}function F(t){const e=t.message||"Failed or Rejected Request";let r=-32e3;if(t&&!t.code)switch(e){case"Parse error":r=-32700;break;case"Invalid request":r=-32600;break;case"Method not found":r=-32601;break;case"Invalid params":r=-32602;break;case"Internal error":r=-32603;break;default:r=-32e3}return{code:r,message:e}}var Y=r(14);function z(t){const e=-1!==t.indexOf("?")?t.indexOf("?"):void 0;return void 0!==e?t.substr(e):""}function J(t,e){let r=Z(t);return r=Object.assign(Object.assign({},r),e),t=function(t){return Y.stringify(t)}(r)}function Z(t){return Y.parse(t)}function $(t){return void 0!==t.bridge}function K(t){const e=t.indexOf(":"),r=-1!==t.indexOf("?")?t.indexOf("?"):void 0,n=t.substring(0,e);const i=function(t){const e=t.split("@");return{handshakeTopic:e[0],version:parseInt(e[1],10)}}(t.substring(e+1,r));const o=function(t){const e=Z(t);return{key:e.key||"",bridge:e.bridge||""}}(void 0!==r?t.substr(r):"");return Object.assign(Object.assign({protocol:n},i),o)}r.d(e,"g",(function(){return s})),r.d(e,"r",(function(){return u})),r.d(e,"m",(function(){return h})),r.d(e,"k",(function(){return f})),r.d(e,"i",(function(){return d})),r.d(e,"B",(function(){return g})),r.d(e,"j",(function(){return y})),r.d(e,"A",(function(){return v})),r.d(e,"v",(function(){return"WALLETCONNECT_DEEPLINK_CHOICE"})),r.d(e,"C",(function(){return b})),r.d(e,"b",(function(){return T})),r.d(e,"c",(function(){return O})),r.d(e,"d",(function(){return A})),r.d(e,"e",(function(){return k})),r.d(e,"f",(function(){return x})),r.d(e,"w",(function(){return W})),r.d(e,"x",(function(){return H})),r.d(e,"z",(function(){return E})),r.d(e,"D",(function(){return B})),r.d(e,"h",(function(){return F})),r.d(e,"u",(function(){return $})),r.d(e,"y",(function(){return K})),r.d(e,"l",(function(){return z})),r.d(e,"a",(function(){return J})),r.d(e,"o",(function(){return C})),r.d(e,"q",(function(){return P})),r.d(e,"p",(function(){return U})),r.d(e,"n",(function(){return N})),r.d(e,"s",(function(){return L})),r.d(e,"t",(function(){return q}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return 256})),r.d(e,"g",(function(){return 256})),r.d(e,"a",(function(){return"AES-CBC"})),r.d(e,"f",(function(){return"SHA-256"})),r.d(e,"e",(function(){return"HMAC"})),r.d(e,"i",(function(){return"SHA-256"})),r.d(e,"j",(function(){return"SHA-512"})),r.d(e,"h",(function(){return 512})),r.d(e,"d",(function(){return"encrypt"})),r.d(e,"c",(function(){return"decrypt"})),r.d(e,"k",(function(){return"sign"})),r.d(e,"l",(function(){return"verify"}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"b",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"e",(function(){return a}));const n="INTERNAL_ERROR",i="SERVER_ERROR",o=[-32700,-32600,-32601,-32602,-32603],s=[-32e3,-32099],a={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[n]:{code:-32603,message:"Internal error"},[i]:{code:-32e3,message:"Server error"}}},function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(50),e),i(r(51),e)},function(t,e,r){"use strict";function n(t){let e=void 0;return"undefined"!=typeof window&&void 0!==window[t]&&(e=window[t]),e}function i(t){const e=n(t);if(!e)throw new Error(t+" is not defined in Window");return e}Object.defineProperty(e,"__esModule",{value:!0}),e.getLocalStorage=e.getLocalStorageOrThrow=e.getCrypto=e.getCryptoOrThrow=e.getLocation=e.getLocationOrThrow=e.getNavigator=e.getNavigatorOrThrow=e.getDocument=e.getDocumentOrThrow=e.getFromWindowOrThrow=e.getFromWindow=void 0,e.getFromWindow=n,e.getFromWindowOrThrow=i,e.getDocumentOrThrow=function(){return i("document")},e.getDocument=function(){return n("document")},e.getNavigatorOrThrow=function(){return i("navigator")},e.getNavigator=function(){return n("navigator")},e.getLocationOrThrow=function(){return i("location")},e.getLocation=function(){return n("location")},e.getCryptoOrThrow=function(){return i("crypto")},e.getCrypto=function(){return n("crypto")},e.getLocalStorageOrThrow=function(){return i("localStorage")},e.getLocalStorage=function(){return n("localStorage")}},function(t,e,r){"use strict";r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return a})),r.d(e,"c",(function(){return u})),r.d(e,"d",(function(){return h})),r.d(e,"e",(function(){return c})),r.d(e,"f",(function(){return f}));var n=r(4),i=r(2);async function o(t,e=i.a){return n.getSubtleCrypto().importKey("raw",t,function(t){return t===i.a?{length:i.b,name:i.a}:{hash:{name:i.f},name:i.e}}(e),!0,function(t){return t===i.a?[i.d,i.c]:[i.k,i.l]}(e))}async function s(t,e,r){const s=n.getSubtleCrypto(),a=await o(e,i.a),u=await s.encrypt({iv:t,name:i.a},a,r);return new Uint8Array(u)}async function a(t,e,r){const s=n.getSubtleCrypto(),a=await o(e,i.a),u=await s.decrypt({iv:t,name:i.a},a,r);return new Uint8Array(u)}async function u(t,e){const r=n.getSubtleCrypto(),s=await o(t,i.e),a=await r.sign({length:i.g,name:i.e},s,e);return new Uint8Array(a)}async function h(t,e){const r=n.getSubtleCrypto(),s=await o(t,i.e),a=await r.sign({length:i.h,name:i.e},s,e);return new Uint8Array(a)}async function c(t){const e=n.getSubtleCrypto(),r=await e.digest({name:i.i},t);return new Uint8Array(r)}async function f(t){const e=n.getSubtleCrypto(),r=await e.digest({name:i.j},t);return new Uint8Array(r)}},function(t,e,r){"use strict";r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return s}));var n=r(3);function i(t){return n.b.includes(t)}function o(t){return Object.keys(n.e).includes(t)?n.e[t]:n.e[n.a]}function s(t){const e=Object.values(n.e).find(e=>e.code===t);return e||n.e[n.a]}},function(t,e,r){"use strict";var n=r(27);r.d(e,"randomBytes",(function(){return n.a}));var i=r(28);r.d(e,"aesCbcDecrypt",(function(){return i.a})),r.d(e,"aesCbcEncrypt",(function(){return i.b}));var o=r(29);r.d(e,"hmacSha256Sign",(function(){return o.a}));r(34),r(10),r(2)},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));class n{}},function(t,e,r){"use strict";var n=r(30);r.o(n,"isConstantTime")&&r.d(e,"isConstantTime",(function(){return n.isConstantTime}));r(31);var i=r(32);r.o(i,"isConstantTime")&&r.d(e,"isConstantTime",(function(){return i.isConstantTime}));var o=r(33);r.d(e,"isConstantTime",(function(){return o.a}))},function(t,e,r){(function(t){!function(t,e){"use strict";function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function i(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function o(t,e,r){if(o.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var s;"object"==typeof t?t.exports=o:e.BN=o,o.BN=o,o.wordSize=26;try{s=r(44).Buffer}catch(t){}function a(t,e,r){for(var n=0,i=Math.min(t.length,r),o=e;o<i;o++){var s=t.charCodeAt(o)-48;n<<=4,n|=s>=49&&s<=54?s-49+10:s>=17&&s<=22?s-17+10:15&s}return n}function u(t,e,r,n){for(var i=0,o=Math.min(t.length,r),s=e;s<o;s++){var a=t.charCodeAt(s)-48;i*=n,i+=a>=49?a-49+10:a>=17?a-17+10:a}return i}o.isBN=function(t){return t instanceof o||null!==t&&"object"==typeof t&&t.constructor.wordSize===o.wordSize&&Array.isArray(t.words)},o.max=function(t,e){return t.cmp(e)>0?t:e},o.min=function(t,e){return t.cmp(e)<0?t:e},o.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var i=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&i++,16===e?this._parseHex(t,i):this._parseBase(t,e,i),"-"===t[0]&&(this.negative=1),this.strip(),"le"===r&&this._initArray(this.toArray(),e,r)},o.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},o.prototype._initArray=function(t,e,r){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,s,a=0;if("be"===r)for(i=t.length-1,o=0;i>=0;i-=3)s=t[i]|t[i-1]<<8|t[i-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===r)for(i=0,o=0;i<t.length;i+=3)s=t[i]|t[i+1]<<8|t[i+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(t,e){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var n,i,o=0;for(r=t.length-6,n=0;r>=e;r-=6)i=a(t,r,r+6),this.words[n]|=i<<o&67108863,this.words[n+1]|=i>>>26-o&4194303,(o+=24)>=26&&(o-=26,n++);r+6!==e&&(i=a(t,e,r+6),this.words[n]|=i<<o&67108863,this.words[n+1]|=i>>>26-o&4194303),this.strip()},o.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=e)n++;n--,i=i/e|0;for(var o=t.length-r,s=o%n,a=Math.min(o,o-s)+r,h=0,c=r;c<a;c+=n)h=u(t,c,c+n,e),this.imuln(i),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==s){var f=1;for(h=u(t,c,t.length,e),c=0;c<s;c++)f*=e;this.imuln(f),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}},o.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},o.prototype.clone=function(){var t=new o(null);return this.copy(t),t},o.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],c=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function l(t,e,r){r.negative=e.negative^t.negative;var n=t.length+e.length|0;r.length=n,n=n-1|0;var i=0|t.words[0],o=0|e.words[0],s=i*o,a=67108863&s,u=s/67108864|0;r.words[0]=a;for(var h=1;h<n;h++){for(var c=u>>>26,f=67108863&u,l=Math.min(h,e.length-1),d=Math.max(0,h-t.length+1);d<=l;d++){var p=h-d|0;c+=(s=(i=0|t.words[p])*(o=0|e.words[d])+f)/67108864|0,f=67108863&s}r.words[h]=0|f,u=0|c}return 0!==u?r.words[h]=0|u:r.length--,r.strip()}o.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var i=0,o=0,s=0;s<this.length;s++){var a=this.words[s],u=(16777215&(a<<i|o)).toString(16);r=0!==(o=a>>>24-i&16777215)||s!==this.length-1?h[6-u.length]+u+r:u+r,(i+=2)>=26&&(i-=26,s--)}for(0!==o&&(r=o.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var l=c[t],d=f[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(d).toString(t);r=(p=p.idivn(d)).isZero()?m+r:h[l-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(t,e){return n(void 0!==s),this.toArrayLike(s,t,e)},o.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},o.prototype.toArrayLike=function(t,e,r){var i=this.byteLength(),o=r||Math.max(1,i);n(i<=o,"byte array longer than desired length"),n(o>0,"Requested array length <= 0"),this.strip();var s,a,u="le"===e,h=new t(o),c=this.clone();if(u){for(a=0;!c.isZero();a++)s=c.andln(255),c.iushrn(8),h[a]=s;for(;a<o;a++)h[a]=0}else{for(a=0;a<o-i;a++)h[a]=0;for(a=0;!c.isZero();a++)s=c.andln(255),c.iushrn(8),h[o-a-1]=s}return h},Math.clz32?o.prototype._countBits=function(t){return 32-Math.clz32(t)}:o.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},o.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 0==(8191&e)&&(r+=13,e>>>=13),0==(127&e)&&(r+=7,e>>>=7),0==(15&e)&&(r+=4,e>>>=4),0==(3&e)&&(r+=2,e>>>=2),0==(1&e)&&r++,r},o.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},o.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},o.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},o.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},o.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},o.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},o.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},o.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},o.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},o.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var n=0;n<r.length;n++)this.words[n]=e.words[n]^r.words[n];if(this!==e)for(;n<e.length;n++)this.words[n]=e.words[n];return this.length=e.length,this.strip()},o.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},o.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},o.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},o.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var i=0;i<e;i++)this.words[i]=67108863&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&67108863>>26-r),this.strip()},o.prototype.notn=function(t){return this.clone().inotn(t)},o.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var r=t/26|0,i=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<i:this.words[r]&~(1<<i),this.strip()},o.prototype.iadd=function(t){var e,r,n;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,n=t):(r=t,n=this);for(var i=0,o=0;o<n.length;o++)e=(0|r.words[o])+(0|n.words[o])+i,this.words[o]=67108863&e,i=e>>>26;for(;0!==i&&o<r.length;o++)e=(0|r.words[o])+i,this.words[o]=67108863&e,i=e>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this},o.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},o.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,n,i=this.cmp(t);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=t):(r=t,n=this);for(var o=0,s=0;s<n.length;s++)o=(e=(0|r.words[s])-(0|n.words[s])+o)>>26,this.words[s]=67108863&e;for(;0!==o&&s<r.length;s++)o=(e=(0|r.words[s])+o)>>26,this.words[s]=67108863&e;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(t){return this.clone().isub(t)};var d=function(t,e,r){var n,i,o,s=t.words,a=e.words,u=r.words,h=0,c=0|s[0],f=8191&c,l=c>>>13,d=0|s[1],p=8191&d,m=d>>>13,g=0|s[2],y=8191&g,v=g>>>13,w=0|s[3],b=8191&w,_=w>>>13,M=0|s[4],S=8191&M,T=M>>>13,O=0|s[5],A=8191&O,k=O>>>13,x=0|s[6],I=8191&x,R=x>>>13,E=0|s[7],B=8191&E,j=E>>>13,C=0|s[8],P=8191&C,U=C>>>13,N=0|s[9],L=8191&N,q=N>>>13,D=0|a[0],W=8191&D,H=D>>>13,F=0|a[1],Y=8191&F,z=F>>>13,J=0|a[2],Z=8191&J,$=J>>>13,K=0|a[3],V=8191&K,Q=K>>>13,X=0|a[4],G=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,nt=et>>>13,it=0|a[6],ot=8191&it,st=it>>>13,at=0|a[7],ut=8191&at,ht=at>>>13,ct=0|a[8],ft=8191&ct,lt=ct>>>13,dt=0|a[9],pt=8191&dt,mt=dt>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(h+(n=Math.imul(f,W))|0)+((8191&(i=(i=Math.imul(f,H))+Math.imul(l,W)|0))<<13)|0;h=((o=Math.imul(l,H))+(i>>>13)|0)+(gt>>>26)|0,gt&=67108863,n=Math.imul(p,W),i=(i=Math.imul(p,H))+Math.imul(m,W)|0,o=Math.imul(m,H);var yt=(h+(n=n+Math.imul(f,Y)|0)|0)+((8191&(i=(i=i+Math.imul(f,z)|0)+Math.imul(l,Y)|0))<<13)|0;h=((o=o+Math.imul(l,z)|0)+(i>>>13)|0)+(yt>>>26)|0,yt&=67108863,n=Math.imul(y,W),i=(i=Math.imul(y,H))+Math.imul(v,W)|0,o=Math.imul(v,H),n=n+Math.imul(p,Y)|0,i=(i=i+Math.imul(p,z)|0)+Math.imul(m,Y)|0,o=o+Math.imul(m,z)|0;var vt=(h+(n=n+Math.imul(f,Z)|0)|0)+((8191&(i=(i=i+Math.imul(f,$)|0)+Math.imul(l,Z)|0))<<13)|0;h=((o=o+Math.imul(l,$)|0)+(i>>>13)|0)+(vt>>>26)|0,vt&=67108863,n=Math.imul(b,W),i=(i=Math.imul(b,H))+Math.imul(_,W)|0,o=Math.imul(_,H),n=n+Math.imul(y,Y)|0,i=(i=i+Math.imul(y,z)|0)+Math.imul(v,Y)|0,o=o+Math.imul(v,z)|0,n=n+Math.imul(p,Z)|0,i=(i=i+Math.imul(p,$)|0)+Math.imul(m,Z)|0,o=o+Math.imul(m,$)|0;var wt=(h+(n=n+Math.imul(f,V)|0)|0)+((8191&(i=(i=i+Math.imul(f,Q)|0)+Math.imul(l,V)|0))<<13)|0;h=((o=o+Math.imul(l,Q)|0)+(i>>>13)|0)+(wt>>>26)|0,wt&=67108863,n=Math.imul(S,W),i=(i=Math.imul(S,H))+Math.imul(T,W)|0,o=Math.imul(T,H),n=n+Math.imul(b,Y)|0,i=(i=i+Math.imul(b,z)|0)+Math.imul(_,Y)|0,o=o+Math.imul(_,z)|0,n=n+Math.imul(y,Z)|0,i=(i=i+Math.imul(y,$)|0)+Math.imul(v,Z)|0,o=o+Math.imul(v,$)|0,n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,Q)|0)+Math.imul(m,V)|0,o=o+Math.imul(m,Q)|0;var bt=(h+(n=n+Math.imul(f,G)|0)|0)+((8191&(i=(i=i+Math.imul(f,tt)|0)+Math.imul(l,G)|0))<<13)|0;h=((o=o+Math.imul(l,tt)|0)+(i>>>13)|0)+(bt>>>26)|0,bt&=67108863,n=Math.imul(A,W),i=(i=Math.imul(A,H))+Math.imul(k,W)|0,o=Math.imul(k,H),n=n+Math.imul(S,Y)|0,i=(i=i+Math.imul(S,z)|0)+Math.imul(T,Y)|0,o=o+Math.imul(T,z)|0,n=n+Math.imul(b,Z)|0,i=(i=i+Math.imul(b,$)|0)+Math.imul(_,Z)|0,o=o+Math.imul(_,$)|0,n=n+Math.imul(y,V)|0,i=(i=i+Math.imul(y,Q)|0)+Math.imul(v,V)|0,o=o+Math.imul(v,Q)|0,n=n+Math.imul(p,G)|0,i=(i=i+Math.imul(p,tt)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,tt)|0;var _t=(h+(n=n+Math.imul(f,rt)|0)|0)+((8191&(i=(i=i+Math.imul(f,nt)|0)+Math.imul(l,rt)|0))<<13)|0;h=((o=o+Math.imul(l,nt)|0)+(i>>>13)|0)+(_t>>>26)|0,_t&=67108863,n=Math.imul(I,W),i=(i=Math.imul(I,H))+Math.imul(R,W)|0,o=Math.imul(R,H),n=n+Math.imul(A,Y)|0,i=(i=i+Math.imul(A,z)|0)+Math.imul(k,Y)|0,o=o+Math.imul(k,z)|0,n=n+Math.imul(S,Z)|0,i=(i=i+Math.imul(S,$)|0)+Math.imul(T,Z)|0,o=o+Math.imul(T,$)|0,n=n+Math.imul(b,V)|0,i=(i=i+Math.imul(b,Q)|0)+Math.imul(_,V)|0,o=o+Math.imul(_,Q)|0,n=n+Math.imul(y,G)|0,i=(i=i+Math.imul(y,tt)|0)+Math.imul(v,G)|0,o=o+Math.imul(v,tt)|0,n=n+Math.imul(p,rt)|0,i=(i=i+Math.imul(p,nt)|0)+Math.imul(m,rt)|0,o=o+Math.imul(m,nt)|0;var Mt=(h+(n=n+Math.imul(f,ot)|0)|0)+((8191&(i=(i=i+Math.imul(f,st)|0)+Math.imul(l,ot)|0))<<13)|0;h=((o=o+Math.imul(l,st)|0)+(i>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,n=Math.imul(B,W),i=(i=Math.imul(B,H))+Math.imul(j,W)|0,o=Math.imul(j,H),n=n+Math.imul(I,Y)|0,i=(i=i+Math.imul(I,z)|0)+Math.imul(R,Y)|0,o=o+Math.imul(R,z)|0,n=n+Math.imul(A,Z)|0,i=(i=i+Math.imul(A,$)|0)+Math.imul(k,Z)|0,o=o+Math.imul(k,$)|0,n=n+Math.imul(S,V)|0,i=(i=i+Math.imul(S,Q)|0)+Math.imul(T,V)|0,o=o+Math.imul(T,Q)|0,n=n+Math.imul(b,G)|0,i=(i=i+Math.imul(b,tt)|0)+Math.imul(_,G)|0,o=o+Math.imul(_,tt)|0,n=n+Math.imul(y,rt)|0,i=(i=i+Math.imul(y,nt)|0)+Math.imul(v,rt)|0,o=o+Math.imul(v,nt)|0,n=n+Math.imul(p,ot)|0,i=(i=i+Math.imul(p,st)|0)+Math.imul(m,ot)|0,o=o+Math.imul(m,st)|0;var St=(h+(n=n+Math.imul(f,ut)|0)|0)+((8191&(i=(i=i+Math.imul(f,ht)|0)+Math.imul(l,ut)|0))<<13)|0;h=((o=o+Math.imul(l,ht)|0)+(i>>>13)|0)+(St>>>26)|0,St&=67108863,n=Math.imul(P,W),i=(i=Math.imul(P,H))+Math.imul(U,W)|0,o=Math.imul(U,H),n=n+Math.imul(B,Y)|0,i=(i=i+Math.imul(B,z)|0)+Math.imul(j,Y)|0,o=o+Math.imul(j,z)|0,n=n+Math.imul(I,Z)|0,i=(i=i+Math.imul(I,$)|0)+Math.imul(R,Z)|0,o=o+Math.imul(R,$)|0,n=n+Math.imul(A,V)|0,i=(i=i+Math.imul(A,Q)|0)+Math.imul(k,V)|0,o=o+Math.imul(k,Q)|0,n=n+Math.imul(S,G)|0,i=(i=i+Math.imul(S,tt)|0)+Math.imul(T,G)|0,o=o+Math.imul(T,tt)|0,n=n+Math.imul(b,rt)|0,i=(i=i+Math.imul(b,nt)|0)+Math.imul(_,rt)|0,o=o+Math.imul(_,nt)|0,n=n+Math.imul(y,ot)|0,i=(i=i+Math.imul(y,st)|0)+Math.imul(v,ot)|0,o=o+Math.imul(v,st)|0,n=n+Math.imul(p,ut)|0,i=(i=i+Math.imul(p,ht)|0)+Math.imul(m,ut)|0,o=o+Math.imul(m,ht)|0;var Tt=(h+(n=n+Math.imul(f,ft)|0)|0)+((8191&(i=(i=i+Math.imul(f,lt)|0)+Math.imul(l,ft)|0))<<13)|0;h=((o=o+Math.imul(l,lt)|0)+(i>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,n=Math.imul(L,W),i=(i=Math.imul(L,H))+Math.imul(q,W)|0,o=Math.imul(q,H),n=n+Math.imul(P,Y)|0,i=(i=i+Math.imul(P,z)|0)+Math.imul(U,Y)|0,o=o+Math.imul(U,z)|0,n=n+Math.imul(B,Z)|0,i=(i=i+Math.imul(B,$)|0)+Math.imul(j,Z)|0,o=o+Math.imul(j,$)|0,n=n+Math.imul(I,V)|0,i=(i=i+Math.imul(I,Q)|0)+Math.imul(R,V)|0,o=o+Math.imul(R,Q)|0,n=n+Math.imul(A,G)|0,i=(i=i+Math.imul(A,tt)|0)+Math.imul(k,G)|0,o=o+Math.imul(k,tt)|0,n=n+Math.imul(S,rt)|0,i=(i=i+Math.imul(S,nt)|0)+Math.imul(T,rt)|0,o=o+Math.imul(T,nt)|0,n=n+Math.imul(b,ot)|0,i=(i=i+Math.imul(b,st)|0)+Math.imul(_,ot)|0,o=o+Math.imul(_,st)|0,n=n+Math.imul(y,ut)|0,i=(i=i+Math.imul(y,ht)|0)+Math.imul(v,ut)|0,o=o+Math.imul(v,ht)|0,n=n+Math.imul(p,ft)|0,i=(i=i+Math.imul(p,lt)|0)+Math.imul(m,ft)|0,o=o+Math.imul(m,lt)|0;var Ot=(h+(n=n+Math.imul(f,pt)|0)|0)+((8191&(i=(i=i+Math.imul(f,mt)|0)+Math.imul(l,pt)|0))<<13)|0;h=((o=o+Math.imul(l,mt)|0)+(i>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,n=Math.imul(L,Y),i=(i=Math.imul(L,z))+Math.imul(q,Y)|0,o=Math.imul(q,z),n=n+Math.imul(P,Z)|0,i=(i=i+Math.imul(P,$)|0)+Math.imul(U,Z)|0,o=o+Math.imul(U,$)|0,n=n+Math.imul(B,V)|0,i=(i=i+Math.imul(B,Q)|0)+Math.imul(j,V)|0,o=o+Math.imul(j,Q)|0,n=n+Math.imul(I,G)|0,i=(i=i+Math.imul(I,tt)|0)+Math.imul(R,G)|0,o=o+Math.imul(R,tt)|0,n=n+Math.imul(A,rt)|0,i=(i=i+Math.imul(A,nt)|0)+Math.imul(k,rt)|0,o=o+Math.imul(k,nt)|0,n=n+Math.imul(S,ot)|0,i=(i=i+Math.imul(S,st)|0)+Math.imul(T,ot)|0,o=o+Math.imul(T,st)|0,n=n+Math.imul(b,ut)|0,i=(i=i+Math.imul(b,ht)|0)+Math.imul(_,ut)|0,o=o+Math.imul(_,ht)|0,n=n+Math.imul(y,ft)|0,i=(i=i+Math.imul(y,lt)|0)+Math.imul(v,ft)|0,o=o+Math.imul(v,lt)|0;var At=(h+(n=n+Math.imul(p,pt)|0)|0)+((8191&(i=(i=i+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;h=((o=o+Math.imul(m,mt)|0)+(i>>>13)|0)+(At>>>26)|0,At&=67108863,n=Math.imul(L,Z),i=(i=Math.imul(L,$))+Math.imul(q,Z)|0,o=Math.imul(q,$),n=n+Math.imul(P,V)|0,i=(i=i+Math.imul(P,Q)|0)+Math.imul(U,V)|0,o=o+Math.imul(U,Q)|0,n=n+Math.imul(B,G)|0,i=(i=i+Math.imul(B,tt)|0)+Math.imul(j,G)|0,o=o+Math.imul(j,tt)|0,n=n+Math.imul(I,rt)|0,i=(i=i+Math.imul(I,nt)|0)+Math.imul(R,rt)|0,o=o+Math.imul(R,nt)|0,n=n+Math.imul(A,ot)|0,i=(i=i+Math.imul(A,st)|0)+Math.imul(k,ot)|0,o=o+Math.imul(k,st)|0,n=n+Math.imul(S,ut)|0,i=(i=i+Math.imul(S,ht)|0)+Math.imul(T,ut)|0,o=o+Math.imul(T,ht)|0,n=n+Math.imul(b,ft)|0,i=(i=i+Math.imul(b,lt)|0)+Math.imul(_,ft)|0,o=o+Math.imul(_,lt)|0;var kt=(h+(n=n+Math.imul(y,pt)|0)|0)+((8191&(i=(i=i+Math.imul(y,mt)|0)+Math.imul(v,pt)|0))<<13)|0;h=((o=o+Math.imul(v,mt)|0)+(i>>>13)|0)+(kt>>>26)|0,kt&=67108863,n=Math.imul(L,V),i=(i=Math.imul(L,Q))+Math.imul(q,V)|0,o=Math.imul(q,Q),n=n+Math.imul(P,G)|0,i=(i=i+Math.imul(P,tt)|0)+Math.imul(U,G)|0,o=o+Math.imul(U,tt)|0,n=n+Math.imul(B,rt)|0,i=(i=i+Math.imul(B,nt)|0)+Math.imul(j,rt)|0,o=o+Math.imul(j,nt)|0,n=n+Math.imul(I,ot)|0,i=(i=i+Math.imul(I,st)|0)+Math.imul(R,ot)|0,o=o+Math.imul(R,st)|0,n=n+Math.imul(A,ut)|0,i=(i=i+Math.imul(A,ht)|0)+Math.imul(k,ut)|0,o=o+Math.imul(k,ht)|0,n=n+Math.imul(S,ft)|0,i=(i=i+Math.imul(S,lt)|0)+Math.imul(T,ft)|0,o=o+Math.imul(T,lt)|0;var xt=(h+(n=n+Math.imul(b,pt)|0)|0)+((8191&(i=(i=i+Math.imul(b,mt)|0)+Math.imul(_,pt)|0))<<13)|0;h=((o=o+Math.imul(_,mt)|0)+(i>>>13)|0)+(xt>>>26)|0,xt&=67108863,n=Math.imul(L,G),i=(i=Math.imul(L,tt))+Math.imul(q,G)|0,o=Math.imul(q,tt),n=n+Math.imul(P,rt)|0,i=(i=i+Math.imul(P,nt)|0)+Math.imul(U,rt)|0,o=o+Math.imul(U,nt)|0,n=n+Math.imul(B,ot)|0,i=(i=i+Math.imul(B,st)|0)+Math.imul(j,ot)|0,o=o+Math.imul(j,st)|0,n=n+Math.imul(I,ut)|0,i=(i=i+Math.imul(I,ht)|0)+Math.imul(R,ut)|0,o=o+Math.imul(R,ht)|0,n=n+Math.imul(A,ft)|0,i=(i=i+Math.imul(A,lt)|0)+Math.imul(k,ft)|0,o=o+Math.imul(k,lt)|0;var It=(h+(n=n+Math.imul(S,pt)|0)|0)+((8191&(i=(i=i+Math.imul(S,mt)|0)+Math.imul(T,pt)|0))<<13)|0;h=((o=o+Math.imul(T,mt)|0)+(i>>>13)|0)+(It>>>26)|0,It&=67108863,n=Math.imul(L,rt),i=(i=Math.imul(L,nt))+Math.imul(q,rt)|0,o=Math.imul(q,nt),n=n+Math.imul(P,ot)|0,i=(i=i+Math.imul(P,st)|0)+Math.imul(U,ot)|0,o=o+Math.imul(U,st)|0,n=n+Math.imul(B,ut)|0,i=(i=i+Math.imul(B,ht)|0)+Math.imul(j,ut)|0,o=o+Math.imul(j,ht)|0,n=n+Math.imul(I,ft)|0,i=(i=i+Math.imul(I,lt)|0)+Math.imul(R,ft)|0,o=o+Math.imul(R,lt)|0;var Rt=(h+(n=n+Math.imul(A,pt)|0)|0)+((8191&(i=(i=i+Math.imul(A,mt)|0)+Math.imul(k,pt)|0))<<13)|0;h=((o=o+Math.imul(k,mt)|0)+(i>>>13)|0)+(Rt>>>26)|0,Rt&=67108863,n=Math.imul(L,ot),i=(i=Math.imul(L,st))+Math.imul(q,ot)|0,o=Math.imul(q,st),n=n+Math.imul(P,ut)|0,i=(i=i+Math.imul(P,ht)|0)+Math.imul(U,ut)|0,o=o+Math.imul(U,ht)|0,n=n+Math.imul(B,ft)|0,i=(i=i+Math.imul(B,lt)|0)+Math.imul(j,ft)|0,o=o+Math.imul(j,lt)|0;var Et=(h+(n=n+Math.imul(I,pt)|0)|0)+((8191&(i=(i=i+Math.imul(I,mt)|0)+Math.imul(R,pt)|0))<<13)|0;h=((o=o+Math.imul(R,mt)|0)+(i>>>13)|0)+(Et>>>26)|0,Et&=67108863,n=Math.imul(L,ut),i=(i=Math.imul(L,ht))+Math.imul(q,ut)|0,o=Math.imul(q,ht),n=n+Math.imul(P,ft)|0,i=(i=i+Math.imul(P,lt)|0)+Math.imul(U,ft)|0,o=o+Math.imul(U,lt)|0;var Bt=(h+(n=n+Math.imul(B,pt)|0)|0)+((8191&(i=(i=i+Math.imul(B,mt)|0)+Math.imul(j,pt)|0))<<13)|0;h=((o=o+Math.imul(j,mt)|0)+(i>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,n=Math.imul(L,ft),i=(i=Math.imul(L,lt))+Math.imul(q,ft)|0,o=Math.imul(q,lt);var jt=(h+(n=n+Math.imul(P,pt)|0)|0)+((8191&(i=(i=i+Math.imul(P,mt)|0)+Math.imul(U,pt)|0))<<13)|0;h=((o=o+Math.imul(U,mt)|0)+(i>>>13)|0)+(jt>>>26)|0,jt&=67108863;var Ct=(h+(n=Math.imul(L,pt))|0)+((8191&(i=(i=Math.imul(L,mt))+Math.imul(q,pt)|0))<<13)|0;return h=((o=Math.imul(q,mt))+(i>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,u[0]=gt,u[1]=yt,u[2]=vt,u[3]=wt,u[4]=bt,u[5]=_t,u[6]=Mt,u[7]=St,u[8]=Tt,u[9]=Ot,u[10]=At,u[11]=kt,u[12]=xt,u[13]=It,u[14]=Rt,u[15]=Et,u[16]=Bt,u[17]=jt,u[18]=Ct,0!==h&&(u[19]=h,r.length++),r};function p(t,e,r){return(new m).mulp(t,e,r)}function m(t,e){this.x=t,this.y=e}Math.imul||(d=l),o.prototype.mulTo=function(t,e){var r=this.length+t.length;return 10===this.length&&10===t.length?d(this,t,e):r<63?l(this,t,e):r<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var n=0,i=0,o=0;o<r.length-1;o++){var s=i;i=0;for(var a=67108863&n,u=Math.min(o,e.length-1),h=Math.max(0,o-t.length+1);h<=u;h++){var c=o-h,f=(0|t.words[c])*(0|e.words[h]),l=67108863&f;a=67108863&(l=l+a|0),i+=(s=(s=s+(f/67108864|0)|0)+(l>>>26)|0)>>>26,s&=67108863}r.words[o]=a,n=s,s=i}return 0!==n?r.words[o]=n:r.length--,r.strip()}(this,t,e):p(this,t,e)},m.prototype.makeRBT=function(t){for(var e=new Array(t),r=o.prototype._countBits(t)-1,n=0;n<t;n++)e[n]=this.revBin(n,r,t);return e},m.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var n=0,i=0;i<e;i++)n|=(1&t)<<e-i-1,t>>=1;return n},m.prototype.permute=function(t,e,r,n,i,o){for(var s=0;s<o;s++)n[s]=e[t[s]],i[s]=r[t[s]]},m.prototype.transform=function(t,e,r,n,i,o){this.permute(o,t,e,r,n,i);for(var s=1;s<i;s<<=1)for(var a=s<<1,u=Math.cos(2*Math.PI/a),h=Math.sin(2*Math.PI/a),c=0;c<i;c+=a)for(var f=u,l=h,d=0;d<s;d++){var p=r[c+d],m=n[c+d],g=r[c+d+s],y=n[c+d+s],v=f*g-l*y;y=f*y+l*g,g=v,r[c+d]=p+g,n[c+d]=m+y,r[c+d+s]=p-g,n[c+d+s]=m-y,d!==a&&(v=u*f-h*l,l=u*l+h*f,f=v)}},m.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},m.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=t[n];t[n]=t[r-n-1],t[r-n-1]=i,i=e[n],e[n]=-e[r-n-1],e[r-n-1]=-i}},m.prototype.normalize13b=function(t,e){for(var r=0,n=0;n<e/2;n++){var i=8192*Math.round(t[2*n+1]/e)+Math.round(t[2*n]/e)+r;t[n]=67108863&i,r=i<67108864?0:i/67108864|0}return t},m.prototype.convert13b=function(t,e,r,i){for(var o=0,s=0;s<e;s++)o+=0|t[s],r[2*s]=8191&o,o>>>=13,r[2*s+1]=8191&o,o>>>=13;for(s=2*e;s<i;++s)r[s]=0;n(0===o),n(0==(-8192&o))},m.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},m.prototype.mulp=function(t,e,r){var n=2*this.guessLen13b(t.length,e.length),i=this.makeRBT(n),o=this.stub(n),s=new Array(n),a=new Array(n),u=new Array(n),h=new Array(n),c=new Array(n),f=new Array(n),l=r.words;l.length=n,this.convert13b(t.words,t.length,s,n),this.convert13b(e.words,e.length,h,n),this.transform(s,o,a,u,n,i),this.transform(h,o,c,f,n,i);for(var d=0;d<n;d++){var p=a[d]*c[d]-u[d]*f[d];u[d]=a[d]*f[d]+u[d]*c[d],a[d]=p}return this.conjugate(a,u,n),this.transform(a,u,l,o,n,i),this.conjugate(l,o,n),this.normalize13b(l,n),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},o.prototype.mul=function(t){var e=new o(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},o.prototype.mulf=function(t){var e=new o(null);return e.words=new Array(this.length+t.length),p(this,t,e)},o.prototype.imul=function(t){return this.clone().mulTo(t,this)},o.prototype.imuln=function(t){n("number"==typeof t),n(t<67108864);for(var e=0,r=0;r<this.length;r++){var i=(0|this.words[r])*t,o=(67108863&i)+(67108863&e);e>>=26,e+=i/67108864|0,e+=o>>>26,this.words[r]=67108863&o}return 0!==e&&(this.words[r]=e,this.length++),this},o.prototype.muln=function(t){return this.clone().imuln(t)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var n=r/26|0,i=r%26;e[r]=(t.words[n]&1<<i)>>>i}return e}(t);if(0===e.length)return new o(1);for(var r=this,n=0;n<e.length&&0===e[n];n++,r=r.sqr());if(++n<e.length)for(var i=r.sqr();n<e.length;n++,i=i.sqr())0!==e[n]&&(r=r.mul(i));return r},o.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,r=t%26,i=(t-r)/26,o=67108863>>>26-r<<26-r;if(0!==r){var s=0;for(e=0;e<this.length;e++){var a=this.words[e]&o,u=(0|this.words[e])-a<<r;this.words[e]=u|s,s=a>>>26-r}s&&(this.words[e]=s,this.length++)}if(0!==i){for(e=this.length-1;e>=0;e--)this.words[e+i]=this.words[e];for(e=0;e<i;e++)this.words[e]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},o.prototype.iushrn=function(t,e,r){var i;n("number"==typeof t&&t>=0),i=e?(e-e%26)/26:0;var o=t%26,s=Math.min((t-o)/26,this.length),a=67108863^67108863>>>o<<o,u=r;if(i-=s,i=Math.max(0,i),u){for(var h=0;h<s;h++)u.words[h]=this.words[h];u.length=s}if(0===s);else if(this.length>s)for(this.length-=s,h=0;h<this.length;h++)this.words[h]=this.words[h+s];else this.words[0]=0,this.length=1;var c=0;for(h=this.length-1;h>=0&&(0!==c||h>=i);h--){var f=0|this.words[h];this.words[h]=c<<26-o|f>>>o,c=f&a}return u&&0!==c&&(u.words[u.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(t,e,r){return n(0===this.negative),this.iushrn(t,e,r)},o.prototype.shln=function(t){return this.clone().ishln(t)},o.prototype.ushln=function(t){return this.clone().iushln(t)},o.prototype.shrn=function(t){return this.clone().ishrn(t)},o.prototype.ushrn=function(t){return this.clone().iushrn(t)},o.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,i=1<<e;return!(this.length<=r)&&!!(this.words[r]&i)},o.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var i=67108863^67108863>>>e<<e;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(t){return this.clone().imaskn(t)},o.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},o.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},o.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},o.prototype.addn=function(t){return this.clone().iaddn(t)},o.prototype.subn=function(t){return this.clone().isubn(t)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(t,e,r){var i,o,s=t.length+r;this._expand(s);var a=0;for(i=0;i<t.length;i++){o=(0|this.words[i+r])+a;var u=(0|t.words[i])*e;a=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+r]=67108863&o}for(;i<this.length-r;i++)a=(o=(0|this.words[i+r])+a)>>26,this.words[i+r]=67108863&o;if(0===a)return this.strip();for(n(-1===a),a=0,i=0;i<this.length;i++)a=(o=-(0|this.words[i])+a)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(t,e){var r=(this.length,t.length),n=this.clone(),i=t,s=0|i.words[i.length-1];0!==(r=26-this._countBits(s))&&(i=i.ushln(r),n.iushln(r),s=0|i.words[i.length-1]);var a,u=n.length-i.length;if("mod"!==e){(a=new o(null)).length=u+1,a.words=new Array(a.length);for(var h=0;h<a.length;h++)a.words[h]=0}var c=n.clone()._ishlnsubmul(i,1,u);0===c.negative&&(n=c,a&&(a.words[u]=1));for(var f=u-1;f>=0;f--){var l=67108864*(0|n.words[i.length+f])+(0|n.words[i.length+f-1]);for(l=Math.min(l/s|0,67108863),n._ishlnsubmul(i,l,f);0!==n.negative;)l--,n.negative=0,n._ishlnsubmul(i,1,f),n.isZero()||(n.negative^=1);a&&(a.words[f]=l)}return a&&a.strip(),n.strip(),"div"!==e&&0!==r&&n.iushrn(r),{div:a||null,mod:n}},o.prototype.divmod=function(t,e,r){return n(!t.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(i=a.div.neg()),"div"!==e&&(s=a.mod.neg(),r&&0!==s.negative&&s.iadd(t)),{div:i,mod:s}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(i=a.div.neg()),{div:i,mod:a.mod}):0!=(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(s=a.mod.neg(),r&&0!==s.negative&&s.isub(t)),{div:a.div,mod:s}):t.length>this.length||this.cmp(t)<0?{div:new o(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new o(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new o(this.modn(t.words[0]))}:this._wordDiv(t,e);var i,s,a},o.prototype.div=function(t){return this.divmod(t,"div",!1).div},o.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},o.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},o.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,n=t.ushrn(1),i=t.andln(1),o=r.cmp(n);return o<0||1===i&&0===o?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},o.prototype.modn=function(t){n(t<=67108863);for(var e=(1<<26)%t,r=0,i=this.length-1;i>=0;i--)r=(e*r+(0|this.words[i]))%t;return r},o.prototype.idivn=function(t){n(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var i=(0|this.words[r])+67108864*e;this.words[r]=i/t|0,e=i%t}return this.strip()},o.prototype.divn=function(t){return this.clone().idivn(t)},o.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i=new o(1),s=new o(0),a=new o(0),u=new o(1),h=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++h;for(var c=r.clone(),f=e.clone();!e.isZero();){for(var l=0,d=1;0==(e.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(e.iushrn(l);l-- >0;)(i.isOdd()||s.isOdd())&&(i.iadd(c),s.isub(f)),i.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||u.isOdd())&&(a.iadd(c),u.isub(f)),a.iushrn(1),u.iushrn(1);e.cmp(r)>=0?(e.isub(r),i.isub(a),s.isub(u)):(r.isub(e),a.isub(i),u.isub(s))}return{a:a,b:u,gcd:r.iushln(h)}},o.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i,s=new o(1),a=new o(0),u=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var h=0,c=1;0==(e.words[0]&c)&&h<26;++h,c<<=1);if(h>0)for(e.iushrn(h);h-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);for(var f=0,l=1;0==(r.words[0]&l)&&f<26;++f,l<<=1);if(f>0)for(r.iushrn(f);f-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),s.isub(a)):(r.isub(e),a.isub(s))}return(i=0===e.cmpn(1)?s:a).cmpn(0)<0&&i.iadd(t),i},o.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var n=0;e.isEven()&&r.isEven();n++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=e.cmp(r);if(i<0){var o=e;e=r,r=o}else if(0===i||0===r.cmpn(1))break;e.isub(r)}return r.iushln(n)},o.prototype.invm=function(t){return this.egcd(t).a.umod(t)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(t){return this.words[0]&t},o.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,r=(t-e)/26,i=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var o=i,s=r;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),n(t<=67108863,"Number is too big");var i=0|this.words[0];e=i===t?0:i<t?-1:1}return 0!==this.negative?0|-e:e},o.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},o.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|t.words[r];if(n!==i){n<i?e=-1:n>i&&(e=1);break}}return e},o.prototype.gtn=function(t){return 1===this.cmpn(t)},o.prototype.gt=function(t){return 1===this.cmp(t)},o.prototype.gten=function(t){return this.cmpn(t)>=0},o.prototype.gte=function(t){return this.cmp(t)>=0},o.prototype.ltn=function(t){return-1===this.cmpn(t)},o.prototype.lt=function(t){return-1===this.cmp(t)},o.prototype.lten=function(t){return this.cmpn(t)<=0},o.prototype.lte=function(t){return this.cmp(t)<=0},o.prototype.eqn=function(t){return 0===this.cmpn(t)},o.prototype.eq=function(t){return 0===this.cmp(t)},o.red=function(t){return new M(t)},o.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(t){return this.red=t,this},o.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},o.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},o.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},o.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},o.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},o.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},o.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},o.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var g={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new o(e,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function b(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function M(t){if("string"==typeof t){var e=o._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function S(t){M.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new o(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var n=e<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):r.strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},i(v,y),v.prototype.split=function(t,e){for(var r=Math.min(t.length,9),n=0;n<r;n++)e.words[n]=t.words[n];if(e.length=r,t.length<=9)return t.words[0]=0,void(t.length=1);var i=t.words[9];for(e.words[e.length++]=4194303&i,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(4194303&o)<<4|i>>>22,i=o}i>>>=22,t.words[n-10]=i,0===i&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var n=0|t.words[r];e+=977*n,t.words[r]=67108863&e,e=64*n+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},i(w,y),i(b,y),i(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var n=19*(0|t.words[r])+e,i=67108863&n;n>>>=26,t.words[r]=i,e=n}return 0!==e&&(t.words[t.length++]=e),t},o._prime=function(t){if(g[t])return g[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new b;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return g[t]=e,e},M.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},M.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},M.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},M.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},M.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},M.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},M.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},M.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},M.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},M.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},M.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},M.prototype.isqr=function(t){return this.imul(t,t.clone())},M.prototype.sqr=function(t){return this.mul(t,t)},M.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var r=this.m.add(new o(1)).iushrn(2);return this.pow(t,r)}for(var i=this.m.subn(1),s=0;!i.isZero()&&0===i.andln(1);)s++,i.iushrn(1);n(!i.isZero());var a=new o(1).toRed(this),u=a.redNeg(),h=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,h).cmp(u);)c.redIAdd(u);for(var f=this.pow(c,i),l=this.pow(t,i.addn(1).iushrn(1)),d=this.pow(t,i),p=s;0!==d.cmp(a);){for(var m=d,g=0;0!==m.cmp(a);g++)m=m.redSqr();n(g<p);var y=this.pow(f,new o(1).iushln(p-g-1));l=l.redMul(y),f=y.redSqr(),d=d.redMul(f),p=g}return l},M.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},M.prototype.pow=function(t,e){if(e.isZero())return new o(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new o(1).toRed(this),r[1]=t;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],t);var i=r[0],s=0,a=0,u=e.bitLength()%26;for(0===u&&(u=26),n=e.length-1;n>=0;n--){for(var h=e.words[n],c=u-1;c>=0;c--){var f=h>>c&1;i!==r[0]&&(i=this.sqr(i)),0!==f||0!==s?(s<<=1,s|=f,(4===++a||0===n&&0===c)&&(i=this.mul(i,r[s]),a=0,s=0)):a=0}u=26}return i},M.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},M.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},o.mont=function(t){return new S(t)},i(S,M),S.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},S.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},S.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},S.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new o(0)._forceRed(this);var r=t.mul(e),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},S.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t,this)}).call(this,r(43)(t))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var u,h=[],c=!1,f=-1;function l(){c&&u&&(c=!1,u.length?h=u.concat(h):f=-1,h.length&&d())}function d(){if(!c){var t=a(l);c=!0;for(var e=h.length;e;){for(u=h,h=[];++f<e;)u&&u[f].run();f=-1,e=h.length}u=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new p(t,e)),1!==h.length||c||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){"use strict";const n=r(52),i=r(53),o=r(54);function s(t){if("string"!=typeof t||1!==t.length)throw new TypeError("arrayFormatSeparator must be single character string")}function a(t,e){return e.encode?e.strict?n(t):encodeURIComponent(t):t}function u(t,e){return e.decode?i(t):t}function h(t){const e=t.indexOf("#");return-1!==e&&(t=t.slice(0,e)),t}function c(t){const e=(t=h(t)).indexOf("?");return-1===e?"":t.slice(e+1)}function f(t,e){return e.parseNumbers&&!Number.isNaN(Number(t))&&"string"==typeof t&&""!==t.trim()?t=Number(t):!e.parseBooleans||null===t||"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(t="true"===t.toLowerCase()),t}function l(t,e){s((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const r=function(t){let e;switch(t.arrayFormat){case"index":return(t,r,n)=>{e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),e?(void 0===n[t]&&(n[t]={}),n[t][e[1]]=r):n[t]=r};case"bracket":return(t,r,n)=>{e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),e?void 0!==n[t]?n[t]=[].concat(n[t],r):n[t]=[r]:n[t]=r};case"comma":case"separator":return(e,r,n)=>{const i="string"==typeof r&&r.split("").indexOf(t.arrayFormatSeparator)>-1?r.split(t.arrayFormatSeparator).map(e=>u(e,t)):null===r?r:u(r,t);n[e]=i};default:return(t,e,r)=>{void 0!==r[t]?r[t]=[].concat(r[t],e):r[t]=e}}}(e),n=Object.create(null);if("string"!=typeof t)return n;if(!(t=t.trim().replace(/^[?#&]/,"")))return n;for(const i of t.split("&")){let[t,s]=o(e.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(e.arrayFormat)?s:u(s,e),r(u(t,e),s,n)}for(const t of Object.keys(n)){const r=n[t];if("object"==typeof r&&null!==r)for(const t of Object.keys(r))r[t]=f(r[t],e);else n[t]=f(r,e)}return!1===e.sort?n:(!0===e.sort?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((t,e)=>{const r=n[e];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?t[e]=function t(e){return Array.isArray(e)?e.sort():"object"==typeof e?t(Object.keys(e)).sort((t,e)=>Number(t)-Number(e)).map(t=>e[t]):e}(r):t[e]=r,t},Object.create(null))}e.extract=c,e.parse=l,e.stringify=(t,e)=>{if(!t)return"";s((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const r=r=>e.skipNull&&null==t[r]||e.skipEmptyString&&""===t[r],n=function(t){switch(t.arrayFormat){case"index":return e=>(r,n)=>{const i=r.length;return void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,[a(e,t),"[",i,"]"].join("")]:[...r,[a(e,t),"[",a(i,t),"]=",a(n,t)].join("")]};case"bracket":return e=>(r,n)=>void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,[a(e,t),"[]"].join("")]:[...r,[a(e,t),"[]=",a(n,t)].join("")];case"comma":case"separator":return e=>(r,n)=>null==n||0===n.length?r:0===r.length?[[a(e,t),"=",a(n,t)].join("")]:[[r,a(n,t)].join(t.arrayFormatSeparator)];default:return e=>(r,n)=>void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,a(e,t)]:[...r,[a(e,t),"=",a(n,t)].join("")]}}(e),i={};for(const e of Object.keys(t))r(e)||(i[e]=t[e]);const o=Object.keys(i);return!1!==e.sort&&o.sort(e.sort),o.map(r=>{const i=t[r];return void 0===i?"":null===i?a(r,e):Array.isArray(i)?i.reduce(n(r),[]).join("&"):a(r,e)+"="+a(i,e)}).filter(t=>t.length>0).join("&")},e.parseUrl=(t,e)=>{e=Object.assign({decode:!0},e);const[r,n]=o(t,"#");return Object.assign({url:r.split("?")[0]||"",query:l(c(t),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:u(n,e)}:{})},e.stringifyUrl=(t,r)=>{r=Object.assign({encode:!0,strict:!0},r);const n=h(t.url).split("?")[0]||"",i=e.extract(t.url),o=e.parse(i,{sort:!1}),s=Object.assign(o,t.query);let u=e.stringify(s,r);u&&(u="?"+u);let c=function(t){let e="";const r=t.indexOf("#");return-1!==r&&(e=t.slice(r)),e}(t.url);return t.fragmentIdentifier&&(c="#"+a(t.fragmentIdentifier,r)),`${n}${u}${c}`}},function(t,e,r){"use strict";(function(t){
>>>>>>> web3-setup
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
<<<<<<< HEAD
var r=n(96),i=n(97),o=n(98);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(d(t),e=a(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return b(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function E(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var d=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===d?0:o-d)){if(-1===d&&(d=o),o-d+1===c)return d*s}else-1!==d&&(o-=o-d),d=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var l=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function R(e,t,n,r){return B(V(t,e.length-n),e,n,r)}function m(e,t,n,r){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return m(e,t,n,r)}function T(e,t,n,r){return B(K(t),e,n,r)}function O(e,t,n,r){return B(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function b(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],d=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(d=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(d=c)}null===d?(d=65533,l=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),i+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return d(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)E(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?b(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),d=e.slice(t,n),l=0;l<a;++l)if(u[l]!==d[l]){o=u[l],s=d[l];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return R(this,e,t,n);case"ascii":return m(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function w(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=H(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function x(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,o){return o||x(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,o){return o||x(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:V(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function K(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(25))},function(e,t){e.exports=i,i.strict=o,i.loose=s;var n=Object.prototype.toString,r={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return o(e)||s(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return r[n.call(e)]}},function(e,t){},function(e,t,n){"use strict";n(7),n(16)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const r={waku:{info:"waku_info",connect:"waku_connect",disconnect:"waku_disconnect",publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"}}},function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeJs",(function(){return o}));var r=n(6);for(var i in r)["default","isNodeJs"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);const o=r.isNode},function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u}));var r=n(20),i=n(4);function o(){return Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3))}function s(e,t,n){return{id:n||o(),jsonrpc:"2.0",method:e,params:t}}function a(e,t){return{id:e,jsonrpc:"2.0",result:t}}function c(e,t){return{id:e,jsonrpc:"2.0",error:u(t)}}function u(e){return void 0===e?Object(r.a)(i.a):("string"==typeof e&&(e=Object.assign(Object.assign({},Object(r.a)(i.g)),{message:e})),Object(r.c)(e.code)&&(e=Object(r.b)(e.code)),e)}},function(e,t,n){"use strict";function r(e){return e.includes("*")?o(e):!/\W/g.test(e)}function i(e){return"*"===e}function o(e){return!!i(e)||!!e.includes("*")&&(2===e.split("*").length&&1===e.split("*").filter(e=>""===e.trim()).length)}function s(e){return!i(e)&&o(e)&&!e.split("*")[0].trim()}function a(e){return!i(e)&&o(e)&&!e.split("*")[1].trim()}n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return a}))},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));function r(e,t){const n=function(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==n&&new RegExp(t).test(n)}function i(e){return r(e,"^https?:")}function o(e){return r(e,"^wss?:")}function s(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}},function(e,t,n){"use strict";function r(e){return"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function i(e){return r(e)&&"method"in e}function o(e){return r(e)&&(s(e)||a(e))}function s(e){return"result"in e}function a(e){return"error"in e}function c(e){return"error"in e&&!1===e.valid}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return c}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PINO_CUSTOM_CONTEXT_KEY=t.PINO_LOGGER_DEFAULTS=void 0,t.PINO_LOGGER_DEFAULTS={level:"info",prettyPrint:{colorize:!0,translateTime:"SYS:standard",ignore:"pid,hostname"}},t.PINO_CUSTOM_CONTEXT_KEY="custom_context"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelayerEncoder=t.Encoder=void 0;const r=n(5),i=r.__importStar(n(1)),o=n(11),s=n(19),a=n(9);t.Encoder=class{constructor(e,t){this.client=e,this.logger=t,this.name=a.ENCODER_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=s.safeJsonStringify(t);return(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.encrypt(e,n):i.utf8ToHex(n)}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(n)}))}};t.RelayerEncoder=class{encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return i.utf8ToHex(s.safeJsonStringify(t))}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return s.safeJsonParse(i.hexToUtf8(t))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeat=void 0;const r=n(5),i=r.__importDefault(n(30)),o=n(10),s=n(17),a=n(9),c=n(11),u=n(12);class d extends s.IHeartBeat{constructor(e){super(e),this.events=new o.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.name=a.HEARTBEAT_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?c.generateChildLogger(e.logger,this.name):i.default(c.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||a.HEARTBEAT_DEFAULT_LOGGER})),this.interval=(null==e?void 0:e.interval)||a.HEARTBEAT_INTERVAL}static init(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new d(e);return yield t.init(),t}))}get context(){return c.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){setInterval(()=>this.pulse(),u.toMiliseconds(this.interval)),this.logger.trace("Initialized")}))}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}t.HeartBeat=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=t.SubscriberTopicMap=void 0;const r=n(5),i=n(10),o=n(17),s=n(12),a=n(11),c=n(9);class u{constructor(){this.map=new Map}get topics(){return Array.from(this.map.keys())}set(e,t){const n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}get(e){return this.map.get(e)||[]}exists(e,t){return this.get(e).includes(t)}delete(e,t){if(void 0===t)return void this.map.delete(e);if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,t))return;const r=n.filter(e=>e!==t);r.length?this.map.set(e,r):this.map.delete(e)}clear(){this.map.clear()}}t.SubscriberTopicMap=u;class d extends o.ISubscriber{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new u,this.events=new i.EventEmitter,this.name=c.SUBSCRIBER_CONTEXT,this.pending=new Map,this.cached=[],this.relayer=e,this.logger=a.generateChildLogger(t,this.name),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}get context(){return a.getLoggerContext(this.logger)}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}subscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const n=s.getRelayProtocolName(t),r={topic:e,relay:n};this.pending.set(e,r);const i=yield this.rpcSubscribe(e,n);return yield this.onSubscribe(i,r),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}}),i}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}))}unsubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){void 0!==(null==t?void 0:t.id)?yield this.unsubscribeById(e,t.id,t):yield this.unsubscribeByTopic(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}enable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&this.onEnable()}))}disable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length||this.onDisable()}))}hasSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled();let n=!1;try{n=(yield this.getSubscription(e)).topic===t}catch(e){}return n}))}onEnable(){this.cached=[],this.events.emit(c.SUBSCRIBER_EVENTS.enabled)}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.events.emit(c.SUBSCRIBER_EVENTS.disabled)}unsubscribeByTopic(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.topicMap.get(e);yield Promise.all(n.map(n=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.unsubscribeById(e,n,t)}))))}))}unsubscribeById(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}});try{const r=s.getRelayProtocolName(n);yield this.rpcUnsubscribe(e,t,r);const i=s.ERROR.DELETED.format({context:s.formatMessageContext(this.context)});yield this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}))}rpcSubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n={method:s.getRelayProtocolApi(t.protocol).subscribe,params:{topic:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}))}rpcUnsubscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r={method:s.getRelayProtocolApi(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}))}onSubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.setSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onResubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.addSubscription(e,Object.assign(Object.assign({},t),{id:e})),this.pending.delete(t.topic)}))}onUnsubscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.events.removeAllListeners(t),(yield this.hasSubscription(t,e))&&(yield this.deleteSubscription(t,n)),yield this.relayer.history.delete(e)}))}setSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),yield this.addSubscription(e,t))}))}addSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.subscriptions.set(e,Object.assign({},t)),this.topicMap.set(t.topic,e),this.events.emit(c.SUBSCRIBER_EVENTS.created,t)}))}getSubscription(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:s.formatMessageContext(this.context),id:e});throw new Error(t.message)}return t}))}deleteSubscription(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const n=yield this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(c.SUBSCRIBER_EVENTS.deleted,Object.assign(Object.assign({},n),{reason:t}))}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.relayer.storage.setRelayerSubscriptions(this.context,this.values),this.events.emit(c.SUBSCRIBER_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.relayer.storage.getRelayerSubscriptions(this.context);if(void 0===e)return;if(!e.length)return;if(this.subscriptions.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:s.formatMessageContext(this.context)});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,this.logger.debug("Successfully Restored subscriptions for "+s.formatMessageContext(this.context)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for "+s.formatMessageContext(this.context)),this.logger.error(e)}}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore(),yield this.reset(),yield this.enable()}))}isEnabled(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(c.SUBSCRIBER_EVENTS.enabled,()=>e())})}))}reset(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length&&(yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){return this.resubscribe(e)})))))}))}resubscribe(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,relay:n}=e,r={topic:t,relay:n};this.pending.set(r.topic,r);const i=yield this.rpcSubscribe(r.topic,r.relay);if(yield this.onResubscribe(i,r),this.ids.includes(e.id)){const t=s.ERROR.RESUBSCRIBED.format({topic:e.topic});yield this.deleteSubscription(e.id,t)}}))}onConnect(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.reset(),yield this.enable()}))}onDisconnect(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.disable()}))}checkPending(){this.pending.forEach(e=>r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.rpcSubscribe(e.topic,e.relay);yield this.onSubscribe(t,e)})))}registerEventListeners(){this.relayer.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.provider.on(c.RELAYER_PROVIDER_EVENTS.connect,()=>r.__awaiter(this,void 0,void 0,(function*(){yield this.onConnect()}))),this.relayer.provider.on(c.RELAYER_PROVIDER_EVENTS.disconnect,()=>r.__awaiter(this,void 0,void 0,(function*(){yield this.onDisconnect()}))),this.events.on(c.SUBSCRIBER_EVENTS.created,e=>r.__awaiter(this,void 0,void 0,(function*(){const t=c.SUBSCRIBER_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()}))),this.events.on(c.SUBSCRIBER_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const t=c.SUBSCRIBER_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),yield this.persist()})))}}t.Subscriber=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.RelayerStorage=t.BaseStorage=void 0;const r=n(5),i=n(11),o=n(12),s=n(9);class a{constructor(e,t,n){this.logger=e,this.keyValueStorage=t,this.config=n,this.name=s.STORAGE_CONTEXT,this.version=s.STORAGE_VERSION,this.keyMap=s.STORAGE_KEYS,this.logger=i.generateChildLogger(e,this.name),this.keyValueStorage=t,this.config=n}get context(){return i.getLoggerContext(this.logger)}get prefix(){return`${this.config.protocol}@${this.config.version}:${this.config.context}:${this.version}`}getStorageKey(e){const t=this.getStorageKeyName(e);if(!this.isValidStorageKeyName(t)){const e=o.ERROR.INVALID_STORAGE_KEY_NAME.format({name:t});throw new Error(e.message)}return this.prefix+"//"+t}getStorageKeyName(e){return o.formatStorageKeyName(e)}isValidStorageKeyName(e){return Object.keys(this.keyMap).map(e=>Object.values(this.keyMap[e])).flat().includes(e.toLowerCase())}}t.BaseStorage=a;class c extends a{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}setJsonRpcRecords(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getJsonRpcRecords(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setRelayerSubscriptions(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getRelayerSubscriptions(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}t.RelayerStorage=c;t.Storage=class extends c{constructor(e,t,n){super(e,t,n),this.logger=e,this.keyValueStorage=t,this.config=n}setKeyChain(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,o.mapToObj(t))}))}getKeyChain(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e),n=yield this.keyValueStorage.getItem(t);return void 0!==n?o.objToMap(n):void 0}))}setSequenceStore(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getSequenceStore(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}setExpirations(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=this.getStorageKey(e);yield this.keyValueStorage.setItem(n,t)}))}getExpirations(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.getStorageKey(e);return yield this.keyValueStorage.getItem(t)}))}}},function(e,t,n){(function(t){var n=/^\[object .+?Constructor\]$/,r="object"==typeof t&&t&&t.Object===Object&&t,i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function a(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){var i=e.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,d,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function c(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function u(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function d(e){return e!=e}function l(e,t){return e.has(t)}function f(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var h,p=Array.prototype,g=Function.prototype,E=Object.prototype,y=o["__core-js_shared__"],_=(h=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",v=g.toString,R=E.hasOwnProperty,m=E.toString,S=RegExp("^"+v.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=o.Symbol,O=E.propertyIsEnumerable,N=p.splice,b=T?T.isConcatSpreadable:void 0,I=Math.max,w=H(o,"Map"),A=H(o,"Set"),P=H(Object,"create");function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function U(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function D(e){var t=-1,n=e?e.length:0;for(this.__data__=new L;++t<n;)this.add(e[t])}function x(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!=n&&r!=r)return i;return-1}function M(e){return!(!z(e)||(t=e,_&&_ in t))&&(F(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?S:n).test(function(e){if(null!=e){try{return v.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}C.prototype.clear=function(){this.__data__=P?P(null):{}},C.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},C.prototype.get=function(e){var t=this.__data__;if(P){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return R.call(t,e)?t[e]:void 0},C.prototype.has=function(e){var t=this.__data__;return P?void 0!==t[e]:R.call(t,e)},C.prototype.set=function(e,t){return this.__data__[e]=P&&void 0===t?"__lodash_hash_undefined__":t,this},U.prototype.clear=function(){this.__data__=[]},U.prototype.delete=function(e){var t=this.__data__,n=x(t,e);return!(n<0)&&(n==t.length-1?t.pop():N.call(t,n,1),!0)},U.prototype.get=function(e){var t=this.__data__,n=x(t,e);return n<0?void 0:t[n][1]},U.prototype.has=function(e){return x(this.__data__,e)>-1},U.prototype.set=function(e,t){var n=this.__data__,r=x(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},L.prototype.clear=function(){this.__data__={hash:new C,map:new(w||U),string:new C}},L.prototype.delete=function(e){return j(this,e).delete(e)},L.prototype.get=function(e){return j(this,e).get(e)},L.prototype.has=function(e){return j(this,e).has(e)},L.prototype.set=function(e,t){return j(this,e).set(e,t),this},D.prototype.add=D.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},D.prototype.has=function(e){return this.__data__.has(e)};var q=A&&1/f(new A([,-0]))[1]==1/0?function(e){return new A(e)}:function(){};function j(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function H(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return M(n)?n:void 0}function V(e){return k(e)||function(e){return J(e)&&R.call(e,"callee")&&(!O.call(e,"callee")||"[object Arguments]"==m.call(e))}(e)||!!(b&&e&&e[b])}var K,B,G=(K=function(e){return function(e,t,n){var r=-1,i=a,o=e.length,s=!0,u=[],d=u;if(n)s=!1,i=c;else if(o>=200){var h=t?null:q(e);if(h)return f(h);s=!1,i=l,d=new D}else d=t?[]:u;e:for(;++r<o;){var p=e[r],g=t?t(p):p;if(p=n||0!==p?p:0,s&&g==g){for(var E=d.length;E--;)if(d[E]===g)continue e;t&&d.push(g),u.push(p)}else i(d,g,n)||(d!==u&&d.push(g),u.push(p))}return u}(function e(t,n,r,i,o){var s=-1,a=t.length;for(r||(r=V),o||(o=[]);++s<a;){var c=t[s];n>0&&r(c)?n>1?e(c,n-1,r,i,o):u(o,c):i||(o[o.length]=c)}return o}(e,1,J,!0))},B=I(void 0===B?K.length-1:B,0),function(){for(var e=arguments,t=-1,n=I(e.length-B,0),r=Array(n);++t<n;)r[t]=e[B+t];t=-1;for(var i=Array(B+1);++t<B;)i[t]=e[t];return i[B]=r,s(K,this,i)});var k=Array.isArray;function Y(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!F(e)}function J(e){return function(e){return!!e&&"object"==typeof e}(e)&&Y(e)}function F(e){var t=z(e)?m.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function z(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=G}).call(this,n(25))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWindowMetadata=void 0;const r=n(24);t.getWindowMetadata=function(){let e,t;try{e=r.getDocumentOrThrow(),t=r.getLocationOrThrow()}catch(e){return null}function n(...t){const n=e.getElementsByTagName("meta");for(let e=0;e<n.length;e++){const r=n[e],i=["itemprop","property","name"].map(e=>r.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(i.length&&i){const e=r.getAttribute("content");if(e)return e}}return""}const i=function(){let t=n("name","og:site_name","og:title","twitter:title");return t||(t=e.title),t}();return{description:n("description","og:description","twitter:description","keywords"),url:t.origin,icons:function(){const n=e.getElementsByTagName("link"),r=[];for(let e=0;e<n.length;e++){const i=n[e],o=i.getAttribute("rel");if(o&&o.toLowerCase().indexOf("icon")>-1){const e=i.getAttribute("href");if(e)if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let n=t.protocol+"//"+t.host;if(0===e.indexOf("/"))n+=e;else{const r=t.pathname.split("/");r.pop();n+=r.join("/")+"/"+e}r.push(n)}else if(0===e.indexOf("//")){const n=t.protocol+e;r.push(n)}else r.push(e)}}return r}(),name:i}}},function(e,t,n){"use strict";var r=n(69);n.o(r,"RELAY_JSONRPC")&&n.d(t,"RELAY_JSONRPC",(function(){return r.RELAY_JSONRPC}));n(70);var i=n(71);n.d(t,"RELAY_JSONRPC",(function(){return i.a}));n(16)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(5),i=n(87);r.__exportStar(n(9),t),t.Client=i.Client,t.default=i.Client},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(5),i=n(10),o=r.__importDefault(n(30)),s=r.__importDefault(n(36)),a=n(17),c=n(12),u=n(8),d=n(11),l=n(112),f=n(9);class h extends a.IClient{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new i.EventEmitter,this.name=f.CLIENT_DEFAULT.name;const t=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:o.default(d.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||f.CLIENT_DEFAULT.logger}));this.name=(null==e?void 0:e.name)||f.CLIENT_DEFAULT.name,this.controller=(null==e?void 0:e.controller)||f.CLIENT_DEFAULT.controller,this.metadata=(null==e?void 0:e.metadata)||c.getAppMetadata(),this.projectId=null==e?void 0:e.projectId,this.logger=d.generateChildLogger(t,this.name),this.heartbeat=new l.HeartBeat({logger:this.logger}),this.crypto=new l.Crypto(this,this.logger,null==e?void 0:e.keychain),this.encoder=new l.Encoder(this,this.logger);const n=Object.assign(Object.assign({},f.CLIENT_STORAGE_OPTIONS),null==e?void 0:e.storageOptions);this.storage=new l.Storage(this.logger,(null==e?void 0:e.storage)||new s.default(n),{protocol:this.protocol,version:this.version,context:this.context}),this.relayUrl=c.formatRelayRpcUrl(this.protocol,this.version,(null==e?void 0:e.relayUrl)||f.CLIENT_DEFAULT.relayUrl,this.projectId),this.relayer=new l.Relayer({rpcUrl:this.relayUrl,heartbeat:this.heartbeat,encoder:this.encoder,logger:this.logger,storage:this.storage,projectId:this.projectId,keyValueStorageOptions:n}),this.pairing=new l.Pairing(this,this.logger),this.session=new l.Session(this,this.logger)}static init(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new h(e);return yield t.initialize(),t}))}get context(){return d.getLoggerContext(this.logger)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}connect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Connecting Application"),this.logger.trace({type:"method",method:"connect",params:e});try{void 0===typeof e.pairing&&this.logger.info("Connecing with existing pairing");const t=void 0===e.pairing?yield this.pairing.create():yield this.pairing.get(e.pairing.topic);this.logger.trace({type:"method",method:"connect",pairing:t});const n=e.metadata||this.metadata;if(void 0===n){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=yield this.session.create({signal:{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}},relay:e.relay||{protocol:f.RELAYER_DEFAULT_PROTOCOL},metadata:n,permissions:Object.assign(Object.assign({},e.permissions),{notifications:f.SESSION_EMPTY_PERMISSIONS.notifications})});return this.logger.debug("Application Connection Successful"),this.logger.trace({type:"method",method:"connect",session:r}),r}catch(e){throw this.logger.debug("Application Connection Failure"),this.logger.error(e),e}}))}pair(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Pairing"),this.logger.trace({type:"method",method:"pair",params:e});const t=function(e){const t=c.parseUri(e);return{topic:t.topic,relay:t.relay,proposer:{publicKey:t.publicKey,controller:t.controller},signal:{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:e}},permissions:{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}},ttl:f.PAIRING_DEFAULT_TTL}}(e.uri),n=t.proposer.controller!==this.controller,r=n?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),i=yield this.pairing.respond({approved:n,proposal:t,reason:r});if(!c.isPairingResponded(i)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"pairing"});throw this.logger.error(e.message),new Error(e.message)}if(c.isPairingFailed(i.outcome))throw this.logger.debug("Pairing Failure"),this.logger.trace({type:"method",method:"pair",outcome:i.outcome}),new Error(i.outcome.reason.message);this.logger.debug("Pairing Success"),this.logger.trace({type:"method",method:"pair",pending:i});return yield this.pairing.get(i.outcome.topic)}))}approve(e){return r.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Approving Session Proposal"),this.logger.trace({type:"method",method:"approve",params:e}),void 0===e.response){const e=c.ERROR.MISSING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}const t=e.response.state||f.SESSION_EMPTY_STATE,n=e.response.metadata||this.metadata;if(void 0===n){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=e.proposal.proposer.controller!==this.controller,i=r?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),o=yield this.session.respond({approved:r,proposal:e.proposal,response:{state:t,metadata:n},reason:i});if(!c.isSessionResponded(o)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}if(c.isSessionFailed(o.outcome))throw this.logger.debug("Session Proposal Approval Failure"),this.logger.trace({type:"method",method:"approve",outcome:o.outcome}),new Error(o.outcome.reason.message);return this.logger.debug("Session Proposal Approval Success"),this.logger.trace({type:"method",method:"approve",pending:o}),this.session.get(o.outcome.topic)}))}reject(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Rejecting Session Proposal"),this.logger.trace({type:"method",method:"reject",params:e});const t=yield this.session.respond({approved:!1,proposal:e.proposal,response:f.SESSION_EMPTY_RESPONSE,reason:e.reason});this.logger.debug("Session Proposal Response Success"),this.logger.trace({type:"method",method:"reject",pending:t})}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.update(e)}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.upgrade(e)}))}extend(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.extend(e)}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.session.request(e)}))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.send(e.topic,e.response)}))}ping(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.ping(e.topic,e.timeout)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.notify(e)}))}disconnect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Disconnecting Application"),this.logger.trace({type:"method",method:"disconnect",params:e}),yield this.session.delete(e)}))}onPairingRequest(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(e.method===f.SESSION_JSONRPC.propose){const n=e.params;if(n.proposer.controller===this.controller){const e=c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller});return void(yield this.session.respond({approved:!1,proposal:n,response:f.SESSION_EMPTY_RESPONSE,reason:e}))}const r=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+r),this.logger.debug({type:"event",event:r,data:n}),this.events.emit(r,n);const i=u.formatJsonRpcResult(e.id,!0);yield this.pairing.send(t,i)}}))}onPairingSettled(e){return r.__awaiter(this,void 0,void 0,(function*(){e.permissions.controller.publicKey===e.self.publicKey&&void 0===e.state.metadata&&setTimeout(()=>r.__awaiter(this,void 0,void 0,(function*(){return yield this.pairing.update({topic:e.topic,state:{metadata:this.metadata}})})),f.CLIENT_SHORT_TIMEOUT)}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized");try{yield this.pairing.init(),yield this.session.init(),yield this.crypto.init(),yield this.relayer.init(),yield this.heartbeat.init(),this.registerEventListeners(),this.logger.info("Client Initilization Success")}catch(e){throw this.logger.info("Client Initilization Failure"),this.logger.error(e),e}}))}registerEventListeners(){this.pairing.on(f.PAIRING_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.pairing.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.pairing.on(f.PAIRING_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.pairing.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e),this.onPairingSettled(e)}),this.pairing.on(f.PAIRING_EVENTS.updated,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.upgraded,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.upgraded;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,upgrade:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.deleted,(e,t)=>{const n=f.CLIENT_EVENTS.pairing.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.pairing.on(f.PAIRING_EVENTS.request,e=>{this.onPairingRequest(e.request,e.topic)}),this.session.on(f.PAIRING_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.pairing.sync)),this.session.on(f.SESSION_EVENTS.proposed,e=>{const t=f.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.session.on(f.SESSION_EVENTS.settled,e=>{const t=f.CLIENT_EVENTS.session.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.updated,(e,t)=>{const n=f.CLIENT_EVENTS.session.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.upgraded,(e,t)=>{const n=f.CLIENT_EVENTS.session.upgraded;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,upgrade:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.extended,(e,t)=>{const n=f.CLIENT_EVENTS.session.extended;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,extension:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.deleted,(e,t)=>{const n=f.CLIENT_EVENTS.session.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.session.on(f.SESSION_EVENTS.request,e=>{const t=f.CLIENT_EVENTS.session.request;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.response,e=>{const t=f.CLIENT_EVENTS.session.response;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.notification,e=>{const t=f.CLIENT_EVENTS.session.notification;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(f.SESSION_EVENTS.sync,()=>this.events.emit(f.CLIENT_EVENTS.session.sync))}}t.Client=h},function(e,t,n){"use strict";function r(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,t,n){var i=n&&n.stringify||r;if("object"==typeof e&&null!==e){var o=t.length+1;if(1===o)return e;var s=new Array(o);s[0]=i(e);for(var a=1;a<o;a++)s[a]=i(t[a]);return s.join(" ")}if("string"!=typeof e)return e;var c=t.length;if(0===c)return e;for(var u="",d=0,l=-1,f=e&&e.length||0,h=0;h<f;){if(37===e.charCodeAt(h)&&h+1<f){switch(l=l>-1?l:0,e.charCodeAt(h+1)){case 100:case 102:if(d>=c)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Number(t[d]),l=h+2,h++;break;case 105:if(d>=c)break;if(null==t[d])break;l<h&&(u+=e.slice(l,h)),u+=Math.floor(Number(t[d])),l=h+2,h++;break;case 79:case 111:case 106:if(d>=c)break;if(void 0===t[d])break;l<h&&(u+=e.slice(l,h));var p=typeof t[d];if("string"===p){u+="'"+t[d]+"'",l=h+2,h++;break}if("function"===p){u+=t[d].name||"<anonymous>",l=h+2,h++;break}u+=i(t[d]),l=h+2,h++;break;case 115:if(d>=c)break;l<h&&(u+=e.slice(l,h)),u+=String(t[d]),l=h+2,h++;break;case 37:l<h&&(u+=e.slice(l,h)),u+="%",l=h+2,h++,d--}++d}++h}if(-1===l)return e;l<f&&(u+=e.slice(l));return u}},function(e,t,n){(function(t){!function(){"use strict";var n;function r(){}(n=r).prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},n.prototype.setItem=function(e,t){this[e]=String(t)},n.prototype.removeItem=function(e){delete this[e]},n.prototype.clear=function(){var e=this;Object.keys(e).forEach((function(t){e[t]=void 0,delete e[t]}))},n.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},n.prototype.__defineGetter__("length",(function(){return Object.keys(this).length})),t.localStorage?e.exports=localStorage:e.exports=new r}()}).call(this,n(25))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(91)),r(n(93))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(92);t.IKeyValueStorage=r.IKeyValueStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IKeyValueStorage=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(37);function i(e){return t.REACT_NATIVE_REQUIRED_OPTION in e}function o(e){return t.NODE_JS_REQUIRED_OPTION in e}t.REACT_NATIVE_REQUIRED_OPTION="asyncStorage",t.isReactNativeOptions=i,t.getReactNativeOptions=function(e){if(void 0===e||!i(e))throw new Error(`Missing ${t.REACT_NATIVE_REQUIRED_OPTION} option required for React-Native`);return e},t.NODE_JS_REQUIRED_OPTION="database",t.isNodeJSOptions=o,t.getNodeJSOptions=function(e){if(void 0===e||!o(e))throw new Error(`Missing ${t.NODE_JS_REQUIRED_OPTION} option required for NodeJS`);return e},t.parseEntry=function(e){return[e[0],r.safeJsonParse(e[1])]}},function(e,t,n){"use strict";(function(e){function n(){return(null==e?void 0:e.crypto)||(null==e?void 0:e.msCrypto)||{}}function r(){const e=n();return e.subtle||e.webkitSubtle}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserCryptoAvailable=t.getSubtleCrypto=t.getBrowerCrypto=void 0,t.getBrowerCrypto=n,t.getSubtleCrypto=r,t.isBrowserCryptoAvailable=function(){return!!n()&&!!r()}}).call(this,n(25))},function(e,t,n){"use strict";(function(e){function n(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function r(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isNode=t.isReactNative=void 0,t.isReactNative=n,t.isNode=r,t.isBrowser=function(){return!n()&&!r()}}).call(this,n(58))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),d=0,l=a>0?s-4:s;for(n=0;n<l;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[d++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,d=-7,l=n?i-1:0,f=n?-1:1,h=e[t+l];for(l+=f,o=h&(1<<-d)-1,h>>=-d,d+=a;d>0;o=256*o+e[t+l],l+=f,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=256*s+e[t+l],l+=f,d-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=u}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,d=(1<<u)-1,l=d>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=d?(a=0,s=d):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+h]=255&s,h+=p,s/=256,u-=8);e[n+h-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){var r=n(68).strict;e.exports=function(e){if(r(e)){var n=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(n=n.slice(e.byteOffset,e.byteOffset+e.byteLength)),n}return t.from(e)}}).call(this,n(67).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(101),i=n(105),o=n(31);function s(e,n){return void 0===n&&(n=t.defaultRandomSource),n.randomBytes(e)}t.defaultRandomSource=new r.SystemRandomSource,t.randomBytes=s,t.randomUint32=function(e){void 0===e&&(e=t.defaultRandomSource);var n=s(4,e),r=i.readUint32LE(n);return o.wipe(n),r};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e,n,r){if(void 0===n&&(n=a),void 0===r&&(r=t.defaultRandomSource),n.length<2)throw new Error("randomString charset is too short");if(n.length>256)throw new Error("randomString charset is too long");for(var i="",c=n.length,u=256-256%c;e>0;){for(var d=s(Math.ceil(256*e/u),r),l=0;l<d.length&&e>0;l++){var f=d[l];f<u&&(i+=n.charAt(f%c),e--)}o.wipe(d)}return i}t.randomString=c,t.randomStringForEntropy=function(e,n,r){return void 0===n&&(n=a),void 0===r&&(r=t.defaultRandomSource),c(Math.ceil(e/(Math.log(n.length)/Math.LN2)),n,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(102),i=n(103),o=function(){function e(){return this.isAvailable=!1,this.name="",this._source=new r.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)},e}();t.SystemRandomSource=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");for(var t=new Uint8Array(e),n=0;n<t.length;n+=65536)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,65536)));return t},e}();t.BrowserRandomSource=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(31),i=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e=n(104);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");var t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");for(var n=new Uint8Array(e),i=0;i<n.length;i++)n[i]=t[i];return r.wipe(t),n},e}();t.NodeRandomSource=i},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(106);function i(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>8,t[n+1]=e>>>0,t}function o(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t}function s(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function c(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function u(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function d(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>24,t[n+1]=e>>>16,t[n+2]=e>>>8,t[n+3]=e>>>0,t}function l(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24,t}function f(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),d(e/4294967296>>>0,t,n),d(e>>>0,t,n+4),t}function h(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),l(e>>>0,t,n),l(e/4294967296>>>0,t,n+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=i,t.writeInt16BE=i,t.writeUint16LE=o,t.writeInt16LE=o,t.readInt32BE=s,t.readUint32BE=a,t.readInt32LE=c,t.readUint32LE=u,t.writeUint32BE=d,t.writeInt32BE=d,t.writeUint32LE=l,t.writeInt32LE=l,t.readInt64BE=function(e,t){void 0===t&&(t=0);var n=s(e,t),r=s(e,t+4);return 4294967296*n+r-4294967296*(r>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*a(e,t)+a(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var n=c(e,t);return 4294967296*c(e,t+4)+n-4294967296*(n>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var n=u(e,t);return 4294967296*u(e,t+4)+n},t.writeUint64BE=f,t.writeInt64BE=f,t.writeUint64LE=h,t.writeInt64LE=h,t.readUintBE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,i=1,o=e/8+n-1;o>=n;o--)r+=t[o]*i,i*=256;return r},t.readUintLE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,i=1,o=n;o<n+e/8;o++)r+=t[o]*i,i*=256;return r},t.writeUintBE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var o=1,s=e/8+i-1;s>=i;s--)n[s]=t/o&255,o*=256;return n},t.writeUintLE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var o=1,s=i;s<i+e/8;s++)n[s]=t/o&255,o*=256;return n},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e),t},t.writeFloat32LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),t},t.writeFloat64BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e),t},t.writeFloat64LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},function(e,t,n){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())},function(e,t,n){"use strict";var r=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function o(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],o(n),o(r))}function s(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(r),n=1;n<t.length;n++)t=(e=o(t,n).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},n=i.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=s(n[0]);r!==n[0]&&(t[n[0]]=r)}n=i.exec(e)}t["%C2"]="";for(var o=Object.keys(t),a=0;a<o.length;a++){var c=o[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,n){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n={},r=Object.keys(e),i=Array.isArray(t),o=0;o<r.length;o++){var s=r[o],a=e[s];(i?-1!==t.indexOf(s):t(s,a,e))&&(n[s]=a)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateChildLogger=t.formatChildLoggerContext=t.getLoggerContext=t.setBrowserLoggerContext=t.getBrowserLoggerContext=t.getDefaultLoggerOptions=void 0;const r=n(78);function i(e,t=r.PINO_CUSTOM_CONTEXT_KEY){return e[t]||""}function o(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){return e[n]=t,e}function s(e,t=r.PINO_CUSTOM_CONTEXT_KEY){let n="";return n=void 0===e.bindings?i(e,t):e.bindings().context||"",n}function a(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=s(e,n);return i.trim()?`${i}/${t}`:t}t.getDefaultLoggerOptions=function(e){return Object.assign(Object.assign({},e),{level:(null==e?void 0:e.level)||r.PINO_LOGGER_DEFAULTS.level,prettyPrint:(null==e?void 0:e.prettyPrint)||r.PINO_LOGGER_DEFAULTS.prettyPrint})},t.getBrowserLoggerContext=i,t.setBrowserLoggerContext=o,t.getLoggerContext=s,t.formatChildLoggerContext=a,t.generateChildLogger=function(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=a(e,t,n);return o(e.child({context:i}),i,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);r.__exportStar(n(113),t),r.__exportStar(n(79),t),r.__exportStar(n(32),t),r.__exportStar(n(33),t),r.__exportStar(n(80),t),r.__exportStar(n(28),t),r.__exportStar(n(127),t),r.__exportStar(n(128),t),r.__exportStar(n(132),t),r.__exportStar(n(82),t),r.__exportStar(n(34),t),r.__exportStar(n(81),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Crypto=t.KeyChain=void 0;const r=n(5),i=r.__importStar(n(1)),o=n(11),s=n(19),a=n(12),c=n(9);class u{constructor(e,t){this.client=e,this.logger=t,this.keychain=new Map,this.name=c.KEYCHAIN_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name)}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore()}))}has(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.set(e,t),yield this.persist()}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.keychain.get(e);if(void 0===t)throw new Error(a.ERROR.NO_MATCHING_KEY.format({tag:e}).message);return t}))}del(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.delete(e),yield this.persist()}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){const e=yield this.client.storage.getKeyChain(this.context);void 0!==e&&(this.keychain=e)}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setKeyChain(this.context,this.keychain)}))}}t.KeyChain=u;t.Crypto=class{constructor(e,t,n){this.client=e,this.logger=t,this.name=c.CRYPTO_CONTEXT,this.client=e,this.logger=o.generateChildLogger(t,this.name),this.keychain=n||new u(this.client,this.logger)}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.keychain.init()}))}hasKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}generateKeyPair(){return r.__awaiter(this,void 0,void 0,(function*(){const e=a.generateKeyPair();return this.setKeyPair(e)}))}generateSharedKey(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.getKeyPair(e.publicKey),i=a.deriveSharedKey(r.privateKey,t.publicKey);return this.setEncryptionKeys({sharedKey:i,publicKey:r.publicKey},n)}))}encrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n,publicKey:r}=yield this.getEncryptionKeys(e);return yield a.encrypt({message:t,sharedKey:n,publicKey:r})}))}decrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n}=yield this.getEncryptionKeys(e);return yield a.decrypt({encrypted:t,sharedKey:n})}))}encode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=s.safeJsonStringify(t);return(yield this.hasKeys(e))?yield this.encrypt(e,n):i.utf8ToHex(n)}))}decode(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=(yield this.hasKeys(e))?yield this.decrypt(e,t):i.hexToUtf8(t);return s.safeJsonParse(n)}))}concatKeys(e,t){return i.arrayToHex(i.concatArrays(i.hexToArray(e),i.hexToArray(t)))}splitKeys(e){const t=i.hexToArray(e);return[i.arrayToHex(t.slice(0,32)),i.arrayToHex(t.slice(32,64))]}setKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.concatKeys(e.publicKey,e.privateKey);return yield this.keychain.set(e.publicKey,t),e.publicKey}))}getKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{publicKey:e,privateKey:n}}))}setEncryptionKeys(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=t||(yield a.sha256(e.sharedKey)),r=this.concatKeys(e.sharedKey,e.publicKey);return yield this.keychain.set(n,r),n}))}getEncryptionKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{sharedKey:t,publicKey:n}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_STORAGE_OPTIONS=t.CLIENT_EVENTS=t.CLIENT_SHORT_TIMEOUT=t.CLIENT_DEFAULT=t.CLIENT_CONTEXT=void 0,t.CLIENT_CONTEXT="client",t.CLIENT_DEFAULT={name:t.CLIENT_CONTEXT,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},t.CLIENT_SHORT_TIMEOUT=50,t.CLIENT_EVENTS={pairing:{proposal:"pairing_proposal",updated:"pairing_updated",upgraded:"pairing_upgraded",extended:"pairing_extended",created:"pairing_created",deleted:"pairing_deleted",sync:"pairing_sync"},session:{proposal:"session_proposal",updated:"session_updated",upgraded:"session_upgraded",extended:"session_extended",created:"session_created",deleted:"session_deleted",notification:"session_notification",request:"session_request",response:"session_response",sync:"session_sync"}},t.CLIENT_STORAGE_OPTIONS={database:":memory:"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYCHAIN_CONTEXT=t.CRYPTO_CONTEXT=void 0,t.CRYPTO_CONTEXT="crypto",t.KEYCHAIN_CONTEXT="keychain"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCODER_CONTEXT=void 0,t.ENCODER_CONTEXT="encoder"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPIRER_DEFAULT_TTL=t.EXPIRER_EVENTS=t.EXPIRER_CONTEXT=void 0;const r=n(18);t.EXPIRER_CONTEXT="expirer",t.EXPIRER_EVENTS={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",init:"expirer_init",sync:"expirer_sync"},t.EXPIRER_DEFAULT_TTL=r.ONE_DAY},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEARTBEAT_EVENTS=t.HEARTBEAT_DEFAULT_LOGGER=t.HEARTBEAT_INTERVAL=t.HEARTBEAT_CONTEXT=void 0;const r=n(18);t.HEARTBEAT_CONTEXT="heartbeat",t.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,t.HEARTBEAT_DEFAULT_LOGGER="error",t.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HISTORY_CONTEXT=t.HISTORY_EVENTS=void 0,t.HISTORY_EVENTS={created:"history_created",updated:"history_updated",deleted:"history_deleted",init:"history_init",sync:"history_sync"},t.HISTORY_CONTEXT="history"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAIRING_EVENTS=t.PAIRING_STATUS=t.PAIRING_SIGNAL_METHOD_URI=t.PAIRING_DEFAULT_TTL=t.PAIRING_CONTEXT=t.PAIRING_JSONRPC=void 0;const r=n(18);t.PAIRING_JSONRPC={propose:"wc_pairingPropose",approve:"wc_pairingApprove",reject:"wc_pairingReject",update:"wc_pairingUpdate",upgrade:"wc_pairingUpgrade",extend:"wc_pairingExtend",delete:"wc_pairingDelete",payload:"wc_pairingPayload",ping:"wc_pairingPing",notification:"wc_pairingNotification"},t.PAIRING_CONTEXT="pairing",t.PAIRING_DEFAULT_TTL=r.THIRTY_DAYS,t.PAIRING_SIGNAL_METHOD_URI="uri",t.PAIRING_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.PAIRING_EVENTS={proposed:"pairing_proposed",responded:"pairing_responded",settled:"pairing_settled",updated:"pairing_updated",upgraded:"pairing_upgraded",extended:"pairing_extended",deleted:"pairing_deleted",request:"pairing_request",response:"pairing_response",sync:"pairing_sync",notification:"pairing_notification"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLISHER_CONTEXT=t.PUBLISHER_DEFAULT_TTL=void 0;const r=n(18);t.PUBLISHER_DEFAULT_TTL=r.SIX_HOURS,t.PUBLISHER_CONTEXT="publisher"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RELAYER_STORAGE_OPTIONS=t.RELAYER_RECONNECT_TIMEOUT=t.RELAYER_PROVIDER_EVENTS=t.RELAYER_SUBSCRIBER_SUFFIX=t.RELAYER_EVENTS=t.RELAYER_CONTEXT=t.RELAYER_DEFAULT_RELAY_URL=t.RELAYER_DEFAULT_LOGGER=t.RELAYER_DEFAULT_PROTOCOL=void 0;const r=n(18);t.RELAYER_DEFAULT_PROTOCOL="waku",t.RELAYER_DEFAULT_LOGGER="error",t.RELAYER_DEFAULT_RELAY_URL="wss://relay.walletconnect.com",t.RELAYER_CONTEXT="relayer",t.RELAYER_EVENTS={payload:"relayer_payload",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error"},t.RELAYER_SUBSCRIBER_SUFFIX="_subscription",t.RELAYER_PROVIDER_EVENTS={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},t.RELAYER_RECONNECT_TIMEOUT=r.ONE_SECOND,t.RELAYER_STORAGE_OPTIONS={database:":memory:"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SESSION_EMPTY_RESPONSE=t.SESSION_EMPTY_METADATA=t.SESSION_EMPTY_STATE=t.SESSION_EMPTY_PERMISSIONS=t.SESSION_EVENTS=t.SESSION_STATUS=t.SESSION_SIGNAL_METHOD_PAIRING=t.SESSION_DEFAULT_TTL=t.SESSION_CONTEXT=t.SESSION_JSONRPC=void 0;const r=n(18);t.SESSION_JSONRPC={propose:"wc_sessionPropose",approve:"wc_sessionApprove",reject:"wc_sessionReject",update:"wc_sessionUpdate",upgrade:"wc_sessionUpgrade",extend:"wc_sessionExtend",delete:"wc_sessionDelete",payload:"wc_sessionPayload",ping:"wc_sessionPing",notification:"wc_sessionNotification"},t.SESSION_CONTEXT="session",t.SESSION_DEFAULT_TTL=r.SEVEN_DAYS,t.SESSION_SIGNAL_METHOD_PAIRING="pairing",t.SESSION_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.SESSION_EVENTS={proposed:"session_proposed",responded:"session_responded",settled:"session_settled",updated:"session_updated",upgraded:"session_upgraded",extended:"session_extended",deleted:"session_deleted",request:"session_request",response:"session_response",sync:"session_sync",notification:"session_notification"},t.SESSION_EMPTY_PERMISSIONS={jsonrpc:{methods:[]},blockchain:{chains:[]},notifications:{types:[]}},t.SESSION_EMPTY_STATE={accounts:[]},t.SESSION_EMPTY_METADATA={name:"",description:"",url:"",icons:[]},t.SESSION_EMPTY_RESPONSE={metadata:t.SESSION_EMPTY_METADATA,state:t.SESSION_EMPTY_STATE}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_EVENTS=void 0,t.STORE_EVENTS={created:"store_created",updated:"store_updated",deleted:"store_deleted",init:"store_init",sync:"store_sync"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_KEYS=t.STORAGE_VERSION=t.STORAGE_CONTEXT=void 0,t.STORAGE_CONTEXT="storage",t.STORAGE_VERSION="0.2",t.STORAGE_KEYS={crypto:{keychain:"crypto:keychain"},session:{pending:"session:pending",settled:"session:settled",history:"session:history",expirer:"session:expirer"},pairing:{pending:"pairing:pending",settled:"pairing:settled",history:"pairing:history",expirer:"pairing:expirer"},relayer:{history:"relayer:history",subscription:"relayer:subscription"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUBSCRIBER_CONTEXT=t.SUBSCRIBER_DEFAULT_TTL=t.SUBSCRIBER_EVENTS=void 0;const r=n(18);t.SUBSCRIBER_EVENTS={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",enabled:"subscription_enabled",disabled:"subscription_disabled",sync:"subscription_sync"},t.SUBSCRIBER_DEFAULT_TTL=r.THIRTY_DAYS,t.SUBSCRIBER_CONTEXT="subscription"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pairing=void 0;const r=n(5),i=n(10),o=n(11),s=n(17),a=n(12),c=n(34),u=n(32),d=n(28),l=n(33),f=n(9);class h extends s.IPairing{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.PAIRING_CONTEXT,this.config={status:f.PAIRING_STATUS,events:f.PAIRING_EVENTS,jsonrpc:f.PAIRING_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new c.Store(e,this.logger,this.config.status.pending),this.settled=new c.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t){return this.engine.send(e,t)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}update(e){return this.engine.update(e)}upgrade(e){return this.engine.upgrade(e)}extend(e){return this.engine.extend(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{metadata:t.state.metadata||n.state.metadata}}))}mergeUpgrade(e,t){var n,i,o;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:a.mergeArrays(r.permissions.jsonrpc.methods,(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[])},notifications:{types:a.mergeArrays((null===(i=r.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},controller:r.permissions.controller}}))}mergeExtension(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);if(t.expiry<=n.expiry){const e=a.ERROR.INVALID_EXTEND_REQUEST.format({context:this.name});throw this.logger.error(e.message),new Error(e.message)}return t}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}getDefaultSignal({topic:e,relay:t,proposer:n}){return r.__awaiter(this,void 0,void 0,(function*(){const r=a.formatUri({protocol:this.client.protocol,version:this.client.version,topic:e,publicKey:n.publicKey,controller:n.controller,relay:t});return{method:f.PAIRING_SIGNAL_METHOD_URI,params:{uri:r}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return f.PAIRING_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[f.SESSION_JSONRPC.propose]},notifications:{types:[]}}}))}}t.Pairing=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Relayer=void 0;const r=n(5),i=n(10),o=r.__importDefault(n(30)),s=r.__importDefault(n(36)),a=n(11),c=n(17),u=n(12),d=n(133),l=r.__importDefault(n(129)),f=n(8),h=n(81),p=n(9),g=n(28),E=n(82),y=n(79),_=n(80),v=n(131);class R extends c.IRelayer{constructor(e){super(e),this.protocol="irn",this.version=1,this.events=new i.EventEmitter,this.name=p.RELAYER_CONTEXT,this.logger=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?a.generateChildLogger(e.logger,this.name):o.default(a.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||p.RELAYER_DEFAULT_LOGGER}));const t=Object.assign(Object.assign({},p.RELAYER_STORAGE_OPTIONS),null==e?void 0:e.keyValueStorageOptions);this.storage=void 0!==(null==e?void 0:e.storage)?e.storage:new E.RelayerStorage(this.logger,(null==e?void 0:e.keyValueStorage)||new s.default(t),{protocol:this.protocol,version:this.version,context:this.context}),this.heartbeat=(null==e?void 0:e.heartbeat)||new _.HeartBeat({logger:this.logger}),this.encoder=(null==e?void 0:e.encoder)||new y.RelayerEncoder;const n=(null==e?void 0:e.rpcUrl)||u.formatRelayRpcUrl(this.protocol,this.version,p.RELAYER_DEFAULT_RELAY_URL,null==e?void 0:e.projectId);this.provider="string"!=typeof(null==e?void 0:e.relayProvider)&&void 0!==(null==e?void 0:e.relayProvider)?null==e?void 0:e.relayProvider:new d.JsonRpcProvider(new l.default(n)),this.history=new g.JsonRpcHistory(this.logger,this.storage),this.subscriber=new h.Subscriber(this,this.logger),this.publisher=new v.Publisher(this,this.logger),this.registerEventListeners()}get context(){return a.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.history.init(),yield this.provider.connect(),yield this.subscriber.init(),yield this.publisher.init()}))}publish(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){yield this.publisher.publish(e,t,n),yield this.recordPayloadEvent({topic:e,payload:t})}))}subscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return yield this.subscriber.subscribe(e,t)}))}unsubscribe(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.subscriber.unsubscribe(e,t)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}recordPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;f.isJsonRpcRequest(n)?yield this.history.set(t,n):yield this.history.resolve(n)}))}shouldIgnorePayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(!this.subscriber.topics.includes(t))return!0;let r=!1;try{if(f.isJsonRpcRequest(n))r=yield this.history.exists(t,n.id);else{let e;try{e=yield this.history.get(t,n.id)}catch(e){}r=void 0!==e&&void 0!==e.response}}catch(e){}return r}))}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),f.isJsonRpcRequest(e)){if(!e.method.endsWith(p.RELAYER_SUBSCRIBER_SUFFIX))return;const t=e.params,{topic:n,message:r}=t.data,i={topic:n,payload:yield this.encoder.decode(n,r)};if(yield this.shouldIgnorePayloadEvent(i))return;this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Object.assign({type:"event",event:t.id},i)),this.events.emit(t.id,i),this.events.emit(p.RELAYER_EVENTS.payload,i),yield this.acknowledgePayload(e),yield this.recordPayloadEvent(i)}}))}acknowledgePayload(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=f.formatJsonRpcResult(e.id,!0);yield this.provider.connection.send(t)}))}registerEventListeners(){this.provider.on(p.RELAYER_PROVIDER_EVENTS.payload,e=>this.onPayload(e)),this.provider.on(p.RELAYER_PROVIDER_EVENTS.connect,()=>r.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.connect)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.disconnect,()=>r.__awaiter(this,void 0,void 0,(function*(){this.events.emit(p.RELAYER_EVENTS.disconnect),setTimeout(()=>{this.provider.connect()},p.RELAYER_RECONNECT_TIMEOUT)}))),this.provider.on(p.RELAYER_PROVIDER_EVENTS.error,e=>this.events.emit(p.RELAYER_EVENTS.error,e))}}t.Relayer=R},function(e,t,n){"use strict";n.r(t);var r=n(29);n.d(t,"WsConnection",(function(){return r.a})),t.default=r.b},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Publisher=t.IPublisher=void 0;const r=n(5),i=n(10),o=n(11),s=n(12),a=n(2),c=n(9);class u extends a.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}t.IPublisher=u;t.Publisher=class extends u{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new i.EventEmitter,this.name=c.PUBLISHER_CONTEXT,this.queue=new Map,this.relayer=e,this.logger=o.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return o.getLoggerContext(this.logger)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.initialize()}))}publish(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:n}});try{const r=(null==n?void 0:n.ttl)||c.PUBLISHER_DEFAULT_TTL,i=s.getRelayProtocolName(n),o=(null==n?void 0:n.prompt)||!1,a={topic:e,payload:t,opts:{ttl:r,relay:i,prompt:o}};this.queue.set(t.id,a);const u=yield this.relayer.encoder.encode(e,t);yield this.rpcPublish(e,u,r,i,o),yield this.onPublish(t.id,a),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:n}})}catch(e){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(e),e}}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){}))}rpcPublish(e,t,n,i,o){var a,c;return r.__awaiter(this,void 0,void 0,(function*(){const r={method:s.getRelayProtocolApi(i.protocol).publish,params:{topic:e,message:t,ttl:n,prompt:o}};return void 0===(null===(a=r.params)||void 0===a?void 0:a.prompt)&&(null===(c=r.params)||void 0===c||delete c.prompt),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}))}onPublish(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.queue.delete(e)}))}checkQueue(){this.queue.forEach(e=>r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,opts:{ttl:r,relay:i}}=e,o=yield this.relayer.encoder.encode(t,n);yield this.rpcPublish(t,o,r,i),yield this.onPublish(n.id,e)})))}registerEventListeners(){this.relayer.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const r=n(5),i=n(10),o=n(11),s=n(17),a=n(12),c=n(34),u=n(32),d=n(28),l=n(33),f=n(9);class h extends s.ISession{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.name=f.SESSION_CONTEXT,this.config={status:f.SESSION_STATUS,events:f.SESSION_EVENTS,jsonrpc:f.SESSION_JSONRPC},this.logger=o.generateChildLogger(t,this.name),this.pending=new c.Store(e,this.logger,this.config.status.pending),this.settled=new c.Store(e,this.logger,this.config.status.settled),this.history=new d.JsonRpcHistory(this.logger,this.client.storage),this.expirer=new l.Expirer(e,this.logger),this.engine=new u.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init(),yield this.expirer.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t,n){return this.engine.send(e,t,n)}get context(){return o.getLoggerContext(this.logger)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}update(e){return this.engine.update(e)}upgrade(e){return this.engine.upgrade(e)}extend(e){return this.engine.extend(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{accounts:(null===(n=t.state)||void 0===n?void 0:n.accounts)||r.state.accounts}}))}mergeUpgrade(e,t){var n,i,o,s,c;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:a.mergeArrays(r.permissions.jsonrpc.methods,(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[])},notifications:{types:a.mergeArrays((null===(i=r.permissions.notifications)||void 0===i?void 0:i.types)||[],(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[])},blockchain:{chains:a.mergeArrays((null===(s=r.permissions.blockchain)||void 0===s?void 0:s.chains)||[],(null===(c=t.permissions.blockchain)||void 0===c?void 0:c.chains)||[])},controller:r.permissions.controller}}))}mergeExtension(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);if(t.expiry<=n.expiry){const e=a.ERROR.INVALID_EXTEND_REQUEST.format({context:this.name});throw this.logger.error(e.message),new Error(e.message)}return t}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"respond params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionRespondParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message)}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"request params"});throw this.logger.error(e.message),new Error(e.message)}const{topic:t,chainId:n}=e,r=yield this.settled.get(t);if(n&&!r.permissions.blockchain.chains.includes(n)){const e=a.ERROR.UNAUTHORIZED_TARGET_CHAIN.format({chainId:n});throw this.logger.error(e.message),new Error(e.message)}}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"propose params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionProposeParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message);if(e.signal.method!==f.SESSION_SIGNAL_METHOD_PAIRING){const e=a.ERROR.UNSUPPORTED_SIGNAL.format({context:this.context});throw this.logger.error(e.message),new Error(e.message)}}))}getDefaultSignal(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.client.pairing.settled.get(e.topic);return{method:f.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return f.SESSION_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[]},notifications:{types:[]},blockchain:{chains:[]}}}))}}t.Session=h},function(e,t,n){"use strict";n.r(t),n.d(t,"JsonRpcProvider",(function(){return o}));var r=n(10),i=n(8);class o extends i.IJsonRpcProvider{constructor(e){super(e),this.events=new r.EventEmitter,this.connection=this.setConnection(e)}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Object(i.formatJsonRpcRequest)(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(n,r)=>{if(!this.connection.connected)try{await this.open()}catch(e){r(e)}this.events.on(""+e.id,e=>{Object(i.isJsonRpcError)(e)?r(e.error.message):n(e.result)});try{await this.connection.send(e,t)}catch(e){r(e)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Object(i.isJsonRpcResponse)(e)?this.events.emit(""+e.id,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.events.emit("connect"))}async close(){await this.connection.close(),this.events.emit("disconnect")}}var s=o;t.default=s}])}));
=======
var n=r(45),i=r(46),o=r(47);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return h(this,t,e,r)}function h(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=l(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,r),i=(t=a(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=a(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?a(t,0):l(t,e);if("Buffer"===e.type&&o(e.data))return l(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(c(e),t=a(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function l(t,e){var r=e.length<0?0:0|d(e.length);t=a(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return D(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(t).length;default:if(n)return D(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,r);case"utf8":case"utf-8":return A(this,e,r);case"ascii":return k(this,e,r);case"latin1":case"binary":return x(this,e,r);case"base64":return O(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:v(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,n,i){var o,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,r/=2}function h(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=r;o<a;o++)if(h(t,o)===h(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var f=!0,l=0;l<u;l++)if(h(t,o+l)!==h(e,l)){f=!1;break}if(f)return o}return-1}function w(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[r+s]=a}return s}function b(t,e,r,n){return H(D(e,t.length-r),t,r,n)}function _(t,e,r,n){return H(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function M(t,e,r,n){return _(t,e,r,n)}function S(t,e,r,n){return H(W(e),t,r,n)}function T(t,e,r,n){return H(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function O(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function A(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,u,h=t[i],c=null,f=h>239?4:h>223?3:h>191?2:1;if(i+f<=r)switch(f){case 1:h<128&&(c=h);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&h)<<6|63&o)>127&&(c=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&h)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(c=u)}null===c?(c=65533,f=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return h(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return c(e),e<=0?a(t,e):void 0!==r?"string"==typeof n?a(t,e).fill(r,n):a(t,e).fill(r):a(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return f(null,t)},u.allocUnsafeSlow=function(t){return f(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?A(this,0,t):m.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(o,s),h=this.slice(n,i),c=t.slice(e,r),f=0;f<a;++f)if(h[f]!==c[f]){o=h[f],s=c[f];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":return _(this,t,e,r);case"latin1":case"binary":return M(this,t,e,r);case"base64":return S(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function x(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function I(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=q(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function E(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function j(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function C(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function P(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,o){return o||P(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function N(t,e,r,n,o){return o||P(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||E(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||E(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||E(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||E(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||E(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||E(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||E(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||E(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||E(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||E(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||B(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):C(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);B(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);B(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):C(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return N(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return N(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=u.isBuffer(t)?t:D(new u(t,n).toString()),a=s.length;for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function q(t){return t<16?"0"+t.toString(16):t.toString(16)}function D(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function W(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(12))},function(t,e){t.exports=i,i.strict=o,i.loose=s;var r=Object.prototype.toString,n={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(t){return o(t)||s(t)}function o(t){return t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array}function s(t){return n[r.call(t)]}},function(t,e,r){"use strict";var n=r(4);r.o(n,"payloadId")&&r.d(e,"payloadId",(function(){return n.payloadId}));n.isNode},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));r(7),r(3);function n(){return Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3))}},function(t,e,r){"use strict"},function(t,e,r){"use strict";r(21)},function(t,e,r){"use strict";r(22),r(9),r(23),r(24)},function(t,e){},function(t,e,r){"use strict";var n=r(9);n.a;n.a},function(t,e){},function(t,e,r){"use strict"},function(t,e,r){"use strict"},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(4);function i(t){return n.getBrowerCrypto().getRandomValues(new Uint8Array(t))}},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return o}));var n=r(6);function i(t,e,r){return Object(n.b)(t,e,r)}function o(t,e,r){return Object(n.a)(t,e,r)}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(6);r(10);async function i(t,e){return await Object(n.c)(t,e)}},function(t,e,r){"use strict";var n=r(4);r.o(n,"isConstantTime")&&r.d(e,"isConstantTime",(function(){return n.isConstantTime}))},function(t,e,r){"use strict"},function(t,e){},function(t,e,r){"use strict";function n(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return 0===r}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";r(6)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getWindowMetadata=void 0;const n=r(5);e.getWindowMetadata=function(){let t,e;try{t=n.getDocumentOrThrow(),e=n.getLocationOrThrow()}catch(t){return null}function r(...e){const r=t.getElementsByTagName("meta");for(let t=0;t<r.length;t++){const n=r[t],i=["itemprop","property","name"].map(t=>n.getAttribute(t)).filter(t=>!!t&&e.includes(t));if(i.length&&i){const t=n.getAttribute("content");if(t)return t}}return""}const i=function(){let e=r("name","og:site_name","og:title","twitter:title");return e||(e=t.title),e}();return{description:r("description","og:description","twitter:description","keywords"),url:e.origin,icons:function(){const r=t.getElementsByTagName("link"),n=[];for(let t=0;t<r.length;t++){const i=r[t],o=i.getAttribute("rel");if(o&&o.toLowerCase().indexOf("icon")>-1){const t=i.getAttribute("href");if(t)if(-1===t.toLowerCase().indexOf("https:")&&-1===t.toLowerCase().indexOf("http:")&&0!==t.indexOf("//")){let r=e.protocol+"//"+e.host;if(0===t.indexOf("/"))r+=t;else{const n=e.pathname.split("/");n.pop();r+=n.join("/")+"/"+t}n.push(r)}else if(0===t.indexOf("//")){const r=e.protocol+t;n.push(r)}else n.push(t)}}return n}(),name:i}}},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return l}));var n=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},i=function(t,e,r){this.name=t,this.version=e,this.os=r,this.type="browser"},o=function(e){this.version=e,this.type="node",this.name="node",this.os=t.platform},s=function(t,e,r,n){this.name=t,this.version=e,this.os=r,this.bot=n,this.type="bot-device"},a=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},u=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},h=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,c=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],f=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function l(e){return e?p(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new u:"undefined"!=typeof navigator?p(navigator.userAgent):void 0!==t&&t.version?new o(t.version.slice(1)):null}function d(t){return""!==t&&c.reduce((function(e,r){var n=r[0],i=r[1];if(e)return e;var o=i.exec(t);return!!o&&[n,o]}),!1)}function p(t){var e=d(t);if(!e)return null;var r=e[0],o=e[1];if("searchbot"===r)return new a;var u=o[1]&&o[1].split(/[._]/).slice(0,3);u?u.length<3&&(u=n(u,function(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}(3-u.length))):u=[];var c=u.join("."),l=function(t){for(var e=0,r=f.length;e<r;e++){var n=f[e],i=n[0];if(n[1].exec(t))return i}return null}(t),p=h.exec(t);return p&&p[1]?new s(r,c,l,p[1]):new i(r,c,l)}}).call(this,r(13))},function(t,e,r){(function(n,i){var o;
/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */!function(){"use strict";var s="input is invalid type",a="object"==typeof window,u=a?window:{};u.JS_SHA3_NO_WINDOW&&(a=!1);var h=!a&&"object"==typeof self;!u.JS_SHA3_NO_NODE_JS&&"object"==typeof n&&n.versions&&n.versions.node?u=i:h&&(u=self);var c=!u.JS_SHA3_NO_COMMON_JS&&"object"==typeof t&&t.exports,f=r(49),l=!u.JS_SHA3_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,d="0123456789abcdef".split(""),p=[4,1024,262144,67108864],m=[0,8,16,24],g=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],y=[224,256,384,512],v=[128,256],w=["hex","buffer","arrayBuffer","array","digest"],b={128:168,256:136};!u.JS_SHA3_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!l||!u.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});for(var _=function(t,e,r){return function(n){return new U(t,e,t).update(n)[r]()}},M=function(t,e,r){return function(n,i){return new U(t,e,i).update(n)[r]()}},S=function(t,e,r){return function(e,n,i,o){return x["cshake"+t].update(e,n,i,o)[r]()}},T=function(t,e,r){return function(e,n,i,o){return x["kmac"+t].update(e,n,i,o)[r]()}},O=function(t,e,r,n){for(var i=0;i<w.length;++i){var o=w[i];t[o]=e(r,n,o)}return t},A=function(t,e){var r=_(t,e,"hex");return r.create=function(){return new U(t,e,t)},r.update=function(t){return r.create().update(t)},O(r,_,t,e)},k=[{name:"keccak",padding:[1,256,65536,16777216],bits:y,createMethod:A},{name:"sha3",padding:[6,1536,393216,100663296],bits:y,createMethod:A},{name:"shake",padding:[31,7936,2031616,520093696],bits:v,createMethod:function(t,e){var r=M(t,e,"hex");return r.create=function(r){return new U(t,e,r)},r.update=function(t,e){return r.create(e).update(t)},O(r,M,t,e)}},{name:"cshake",padding:p,bits:v,createMethod:function(t,e){var r=b[t],n=S(t,0,"hex");return n.create=function(n,i,o){return i||o?new U(t,e,n).bytepad([i,o],r):x["shake"+t].create(n)},n.update=function(t,e,r,i){return n.create(e,r,i).update(t)},O(n,S,t,e)}},{name:"kmac",padding:p,bits:v,createMethod:function(t,e){var r=b[t],n=T(t,0,"hex");return n.create=function(n,i,o){return new N(t,e,i).bytepad(["KMAC",o],r).bytepad([n],r)},n.update=function(t,e,r,i){return n.create(t,r,i).update(e)},O(n,T,t,e)}}],x={},I=[],R=0;R<k.length;++R)for(var E=k[R],B=E.bits,j=0;j<B.length;++j){var C=E.name+"_"+B[j];if(I.push(C),x[C]=E.createMethod(B[j],E.padding),"sha3"!==E.name){var P=E.name+B[j];I.push(P),x[P]=x[C]}}function U(t,e,r){this.blocks=[],this.s=[],this.padding=e,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(t<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var n=0;n<50;++n)this.s[n]=0}function N(t,e,r){U.call(this,t,e,r)}U.prototype.update=function(t){if(this.finalized)throw new Error("finalize already called");var e,r=typeof t;if("string"!==r){if("object"!==r)throw new Error(s);if(null===t)throw new Error(s);if(l&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||l&&ArrayBuffer.isView(t)))throw new Error(s);e=!0}for(var n,i,o=this.blocks,a=this.byteCount,u=t.length,h=this.blockCount,c=0,f=this.s;c<u;){if(this.reset)for(this.reset=!1,o[0]=this.block,n=1;n<h+1;++n)o[n]=0;if(e)for(n=this.start;c<u&&n<a;++c)o[n>>2]|=t[c]<<m[3&n++];else for(n=this.start;c<u&&n<a;++c)(i=t.charCodeAt(c))<128?o[n>>2]|=i<<m[3&n++]:i<2048?(o[n>>2]|=(192|i>>6)<<m[3&n++],o[n>>2]|=(128|63&i)<<m[3&n++]):i<55296||i>=57344?(o[n>>2]|=(224|i>>12)<<m[3&n++],o[n>>2]|=(128|i>>6&63)<<m[3&n++],o[n>>2]|=(128|63&i)<<m[3&n++]):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++c)),o[n>>2]|=(240|i>>18)<<m[3&n++],o[n>>2]|=(128|i>>12&63)<<m[3&n++],o[n>>2]|=(128|i>>6&63)<<m[3&n++],o[n>>2]|=(128|63&i)<<m[3&n++]);if(this.lastByteIndex=n,n>=a){for(this.start=n-a,this.block=o[h],n=0;n<h;++n)f[n]^=o[n];L(f),this.reset=!0}else this.start=n}return this},U.prototype.encode=function(t,e){var r=255&t,n=1,i=[r];for(r=255&(t>>=8);r>0;)i.unshift(r),r=255&(t>>=8),++n;return e?i.push(n):i.unshift(n),this.update(i),i.length},U.prototype.encodeString=function(t){var e,r=typeof t;if("string"!==r){if("object"!==r)throw new Error(s);if(null===t)throw new Error(s);if(l&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||l&&ArrayBuffer.isView(t)))throw new Error(s);e=!0}var n=0,i=t.length;if(e)n=i;else for(var o=0;o<t.length;++o){var a=t.charCodeAt(o);a<128?n+=1:a<2048?n+=2:a<55296||a>=57344?n+=3:(a=65536+((1023&a)<<10|1023&t.charCodeAt(++o)),n+=4)}return n+=this.encode(8*n),this.update(t),n},U.prototype.bytepad=function(t,e){for(var r=this.encode(e),n=0;n<t.length;++n)r+=this.encodeString(t[n]);var i=e-r%e,o=[];return o.length=i,this.update(o),this},U.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex,r=this.blockCount,n=this.s;if(t[e>>2]|=this.padding[3&e],this.lastByteIndex===this.byteCount)for(t[0]=t[r],e=1;e<r+1;++e)t[e]=0;for(t[r-1]|=2147483648,e=0;e<r;++e)n[e]^=t[e];L(n)}},U.prototype.toString=U.prototype.hex=function(){this.finalize();for(var t,e=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,o=0,s=0,a="";s<n;){for(o=0;o<e&&s<n;++o,++s)t=r[o],a+=d[t>>4&15]+d[15&t]+d[t>>12&15]+d[t>>8&15]+d[t>>20&15]+d[t>>16&15]+d[t>>28&15]+d[t>>24&15];s%e==0&&(L(r),o=0)}return i&&(t=r[o],a+=d[t>>4&15]+d[15&t],i>1&&(a+=d[t>>12&15]+d[t>>8&15]),i>2&&(a+=d[t>>20&15]+d[t>>16&15])),a},U.prototype.arrayBuffer=function(){this.finalize();var t,e=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,o=0,s=0,a=this.outputBits>>3;t=i?new ArrayBuffer(n+1<<2):new ArrayBuffer(a);for(var u=new Uint32Array(t);s<n;){for(o=0;o<e&&s<n;++o,++s)u[s]=r[o];s%e==0&&L(r)}return i&&(u[o]=r[o],t=t.slice(0,a)),t},U.prototype.buffer=U.prototype.arrayBuffer,U.prototype.digest=U.prototype.array=function(){this.finalize();for(var t,e,r=this.blockCount,n=this.s,i=this.outputBlocks,o=this.extraBytes,s=0,a=0,u=[];a<i;){for(s=0;s<r&&a<i;++s,++a)t=a<<2,e=n[s],u[t]=255&e,u[t+1]=e>>8&255,u[t+2]=e>>16&255,u[t+3]=e>>24&255;a%r==0&&L(n)}return o&&(t=a<<2,e=n[s],u[t]=255&e,o>1&&(u[t+1]=e>>8&255),o>2&&(u[t+2]=e>>16&255)),u},N.prototype=new U,N.prototype.finalize=function(){return this.encode(this.outputBits,!0),U.prototype.finalize.call(this)};var L=function(t){var e,r,n,i,o,s,a,u,h,c,f,l,d,p,m,y,v,w,b,_,M,S,T,O,A,k,x,I,R,E,B,j,C,P,U,N,L,q,D,W,H,F,Y,z,J,Z,$,K,V,Q,X,G,tt,et,rt,nt,it,ot,st,at,ut,ht,ct;for(n=0;n<48;n+=2)i=t[0]^t[10]^t[20]^t[30]^t[40],o=t[1]^t[11]^t[21]^t[31]^t[41],s=t[2]^t[12]^t[22]^t[32]^t[42],a=t[3]^t[13]^t[23]^t[33]^t[43],u=t[4]^t[14]^t[24]^t[34]^t[44],h=t[5]^t[15]^t[25]^t[35]^t[45],c=t[6]^t[16]^t[26]^t[36]^t[46],f=t[7]^t[17]^t[27]^t[37]^t[47],e=(l=t[8]^t[18]^t[28]^t[38]^t[48])^(s<<1|a>>>31),r=(d=t[9]^t[19]^t[29]^t[39]^t[49])^(a<<1|s>>>31),t[0]^=e,t[1]^=r,t[10]^=e,t[11]^=r,t[20]^=e,t[21]^=r,t[30]^=e,t[31]^=r,t[40]^=e,t[41]^=r,e=i^(u<<1|h>>>31),r=o^(h<<1|u>>>31),t[2]^=e,t[3]^=r,t[12]^=e,t[13]^=r,t[22]^=e,t[23]^=r,t[32]^=e,t[33]^=r,t[42]^=e,t[43]^=r,e=s^(c<<1|f>>>31),r=a^(f<<1|c>>>31),t[4]^=e,t[5]^=r,t[14]^=e,t[15]^=r,t[24]^=e,t[25]^=r,t[34]^=e,t[35]^=r,t[44]^=e,t[45]^=r,e=u^(l<<1|d>>>31),r=h^(d<<1|l>>>31),t[6]^=e,t[7]^=r,t[16]^=e,t[17]^=r,t[26]^=e,t[27]^=r,t[36]^=e,t[37]^=r,t[46]^=e,t[47]^=r,e=c^(i<<1|o>>>31),r=f^(o<<1|i>>>31),t[8]^=e,t[9]^=r,t[18]^=e,t[19]^=r,t[28]^=e,t[29]^=r,t[38]^=e,t[39]^=r,t[48]^=e,t[49]^=r,p=t[0],m=t[1],Z=t[11]<<4|t[10]>>>28,$=t[10]<<4|t[11]>>>28,I=t[20]<<3|t[21]>>>29,R=t[21]<<3|t[20]>>>29,at=t[31]<<9|t[30]>>>23,ut=t[30]<<9|t[31]>>>23,F=t[40]<<18|t[41]>>>14,Y=t[41]<<18|t[40]>>>14,P=t[2]<<1|t[3]>>>31,U=t[3]<<1|t[2]>>>31,y=t[13]<<12|t[12]>>>20,v=t[12]<<12|t[13]>>>20,K=t[22]<<10|t[23]>>>22,V=t[23]<<10|t[22]>>>22,E=t[33]<<13|t[32]>>>19,B=t[32]<<13|t[33]>>>19,ht=t[42]<<2|t[43]>>>30,ct=t[43]<<2|t[42]>>>30,et=t[5]<<30|t[4]>>>2,rt=t[4]<<30|t[5]>>>2,N=t[14]<<6|t[15]>>>26,L=t[15]<<6|t[14]>>>26,w=t[25]<<11|t[24]>>>21,b=t[24]<<11|t[25]>>>21,Q=t[34]<<15|t[35]>>>17,X=t[35]<<15|t[34]>>>17,j=t[45]<<29|t[44]>>>3,C=t[44]<<29|t[45]>>>3,O=t[6]<<28|t[7]>>>4,A=t[7]<<28|t[6]>>>4,nt=t[17]<<23|t[16]>>>9,it=t[16]<<23|t[17]>>>9,q=t[26]<<25|t[27]>>>7,D=t[27]<<25|t[26]>>>7,_=t[36]<<21|t[37]>>>11,M=t[37]<<21|t[36]>>>11,G=t[47]<<24|t[46]>>>8,tt=t[46]<<24|t[47]>>>8,z=t[8]<<27|t[9]>>>5,J=t[9]<<27|t[8]>>>5,k=t[18]<<20|t[19]>>>12,x=t[19]<<20|t[18]>>>12,ot=t[29]<<7|t[28]>>>25,st=t[28]<<7|t[29]>>>25,W=t[38]<<8|t[39]>>>24,H=t[39]<<8|t[38]>>>24,S=t[48]<<14|t[49]>>>18,T=t[49]<<14|t[48]>>>18,t[0]=p^~y&w,t[1]=m^~v&b,t[10]=O^~k&I,t[11]=A^~x&R,t[20]=P^~N&q,t[21]=U^~L&D,t[30]=z^~Z&K,t[31]=J^~$&V,t[40]=et^~nt&ot,t[41]=rt^~it&st,t[2]=y^~w&_,t[3]=v^~b&M,t[12]=k^~I&E,t[13]=x^~R&B,t[22]=N^~q&W,t[23]=L^~D&H,t[32]=Z^~K&Q,t[33]=$^~V&X,t[42]=nt^~ot&at,t[43]=it^~st&ut,t[4]=w^~_&S,t[5]=b^~M&T,t[14]=I^~E&j,t[15]=R^~B&C,t[24]=q^~W&F,t[25]=D^~H&Y,t[34]=K^~Q&G,t[35]=V^~X&tt,t[44]=ot^~at&ht,t[45]=st^~ut&ct,t[6]=_^~S&p,t[7]=M^~T&m,t[16]=E^~j&O,t[17]=B^~C&A,t[26]=W^~F&P,t[27]=H^~Y&U,t[36]=Q^~G&z,t[37]=X^~tt&J,t[46]=at^~ht&et,t[47]=ut^~ct&rt,t[8]=S^~p&y,t[9]=T^~m&v,t[18]=j^~O&k,t[19]=C^~A&x,t[28]=F^~P&N,t[29]=Y^~U&L,t[38]=G^~z&Z,t[39]=tt^~J&$,t[48]=ht^~et&nt,t[49]=ct^~rt&it,t[0]^=g[n],t[1]^=g[n+1]};if(c)t.exports=x;else{for(R=0;R<I.length;++R)u[I[R]]=x[I[R]];f&&(void 0===(o=function(){return x}.call(e,r,e,t))||(t.exports=o))}}()}).call(this,r(13),r(12))},function(t,e,r){"use strict";r(3),r(7);var n=r(17);r.o(n,"payloadId")&&r.d(e,"payloadId",(function(){return n.payloadId}));var i=r(18);r.d(e,"payloadId",(function(){return i.a}));r(19),r(20),r(25),r(26)},function(t,e,r){"use strict";(function(t){var n=r(1),i=r(40);const o=void 0!==t.WebSocket?t.WebSocket:r(55);e.a=class{constructor(t){if(this.opts=t,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=t.protocol,this._version=t.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=t.subscriptions||[],this._netMonitor=t.netMonitor||new i.a,!t.url||"string"!=typeof t.url)throw new Error("Missing or invalid WebSocket url");this._url=t.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(t){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(t){}get connecting(){return 0===this.readyState}set connected(t){}get connected(){return 1===this.readyState}set closing(t){}get closing(){return 2===this.readyState}set closed(t){}get closed(){return 3===this.readyState}open(){this._socketCreate()}close(){this._socketClose()}send(t,e,r){if(!e||"string"!=typeof e)throw new Error("Missing or invalid topic field");this._socketSend({topic:e,type:"pub",payload:t,silent:!!r})}subscribe(t){this._socketSend({topic:t,type:"sub",payload:"",silent:!0})}on(t,e){this._events.push({event:t,callback:e})}_socketCreate(){if(this._nextSocket)return;const t=function(t,e,r){var i,o;const s=(t.startsWith("https")?t.replace("https","wss"):t.startsWith("http")?t.replace("http","ws"):t).split("?"),a=Object(n.m)()?{protocol:e,version:r,env:"browser",host:(null===(i=Object(n.k)())||void 0===i?void 0:i.host)||""}:{protocol:e,version:r,env:(null===(o=Object(n.g)())||void 0===o?void 0:o.name)||""},u=Object(n.a)(Object(n.l)(s[1]||""),a);return s[0]+"?"+u}(this._url,this._protocol,this._version);if(this._nextSocket=new o(t),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=t=>this._socketReceive(t),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=t=>this._socketError(t),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(t){const e=JSON.stringify(t);this._socket&&1===this._socket.readyState?this._socket.send(e):(this._setToQueue(t),this._socketCreate())}async _socketReceive(t){let e;try{e=JSON.parse(t.data)}catch(t){return}if(this._socketSend({topic:e.topic,type:"ack",payload:"",silent:!0}),this._socket&&1===this._socket.readyState){const t=this._events.filter(t=>"message"===t.event);t&&t.length&&t.forEach(t=>t.callback(e))}}_socketError(t){const e=this._events.filter(t=>"error"===t.event);e&&e.length&&e.forEach(e=>e.callback(t))}_queueSubscriptions(){this._subscriptions.forEach(t=>this._queue.push({topic:t,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(t){this._queue.push(t)}_pushQueue(){this._queue.forEach(t=>this._socketSend(t)),this._queue=[]}}}).call(this,r(12))},function(t,e,r){"use strict";e.a=class{constructor(){this._eventEmitters=[],"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(t,e){this._eventEmitters.push({event:t,callback:e})}trigger(t){let e=[];t&&(e=this._eventEmitters.filter(e=>e.event===t)),e.forEach(t=>{t.callback()})}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(42),i=(0,n.__importDefault)(r(57)),o=(0,n.__importStar)(r(56));class s extends i.default{constructor(t,e){super({cryptoLib:o,connectorOpts:t,pushServerOpts:e})}}e.default=s},function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",(function(){return i})),r.d(e,"__assign",(function(){return o})),r.d(e,"__rest",(function(){return s})),r.d(e,"__decorate",(function(){return a})),r.d(e,"__param",(function(){return u})),r.d(e,"__metadata",(function(){return h})),r.d(e,"__awaiter",(function(){return c})),r.d(e,"__generator",(function(){return f})),r.d(e,"__exportStar",(function(){return l})),r.d(e,"__values",(function(){return d})),r.d(e,"__read",(function(){return p})),r.d(e,"__spread",(function(){return m})),r.d(e,"__await",(function(){return g})),r.d(e,"__asyncGenerator",(function(){return y})),r.d(e,"__asyncDelegator",(function(){return v})),r.d(e,"__asyncValues",(function(){return w})),r.d(e,"__makeTemplateObject",(function(){return b})),r.d(e,"__importStar",(function(){return _})),r.d(e,"__importDefault",(function(){return M}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function a(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function u(t,e){return function(r,n){e(r,n,t)}}function h(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r((function(e){e(t.value)})).then(s,a)}u((n=n.apply(t,e||[])).next())}))}function f(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function l(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function g(t){return this instanceof g?(this.v=t,this):new g(t)}function y(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(t){i[t]&&(n[t]=function(e){return new Promise((function(r,n){o.push([t,e,r,n])>1||a(t,e)}))})}function a(t,e){try{(r=i[t](e)).value instanceof g?Promise.resolve(r.value.v).then(u,h):c(o[0][2],r)}catch(t){c(o[0][3],t)}var r}function u(t){a("next",t)}function h(t){a("throw",t)}function c(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function v(t){var e,r;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:g(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function w(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,i){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,i,(e=t[r](e)).done,e.value)}))}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function _(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function M(t){return t&&t.__esModule?t:{default:t}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){},function(t,e,r){"use strict";e.byteLength=function(t){var e=h(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,n=h(t),s=n[0],a=n[1],u=new o(function(t,e,r){return 3*(e+r)/4-r}(0,s,a)),c=0,f=a>0?s-4:s;for(r=0;r<f;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],u[c++]=e>>16&255,u[c++]=e>>8&255,u[c++]=255&e;2===a&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,u[c++]=255&e);1===a&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,u[c++]=e>>8&255,u[c++]=255&e);return u},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(c(t,s,s+16383>a?a:s+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,r){for(var i,o,s=[],a=e;a<r;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,h=u>>1,c=-7,f=r?i-1:0,l=r?-1:1,d=t[e+f];for(f+=l,o=d&(1<<-c)-1,d>>=-c,c+=a;c>0;o=256*o+t[e+f],f+=l,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+t[e+f],f+=l,c-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=h}return(d?-1:1)*s*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var s,a,u,h=8*o-i-1,c=(1<<h)-1,f=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+f>=1?l/u:l*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=c?(a=0,s=c):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;t[r+d]=255&s,d+=p,s/=256,h-=8);t[r+d-p]|=128*m}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){(function(e){var n=r(16).strict;t.exports=function(t){if(n(t)){var r=e.from(t.buffer);return t.byteLength!==t.buffer.byteLength&&(r=r.slice(t.byteOffset,t.byteOffset+t.byteLength)),r}return e.from(t)}}).call(this,r(15).Buffer)},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,r){"use strict";(function(t){function r(){return(null==t?void 0:t.crypto)||(null==t?void 0:t.msCrypto)||{}}function n(){const t=r();return t.subtle||t.webkitSubtle}Object.defineProperty(e,"__esModule",{value:!0}),e.isBrowserCryptoAvailable=e.getSubtleCrypto=e.getBrowerCrypto=void 0,e.getBrowerCrypto=r,e.getSubtleCrypto=n,e.isBrowserCryptoAvailable=function(){return!!r()&&!!n()}}).call(this,r(12))},function(t,e,r){"use strict";(function(t){function r(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function n(){return void 0!==t&&void 0!==t.versions&&void 0!==t.versions.node}Object.defineProperty(e,"__esModule",{value:!0}),e.isBrowser=e.isNode=e.isReactNative=void 0,e.isReactNative=r,e.isNode=n,e.isBrowser=function(){return!r()&&!n()}}).call(this,r(13))},function(t,e,r){"use strict";t.exports=t=>encodeURIComponent(t).replace(/[!'()*]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())},function(t,e,r){"use strict";var n=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function o(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(1===t.length)return t;e=e||1;var r=t.slice(0,e),n=t.slice(e);return Array.prototype.concat.call([],o(r),o(n))}function s(t){try{return decodeURIComponent(t)}catch(i){for(var e=t.match(n),r=1;r<e.length;r++)e=(t=o(e,r).join("")).match(n);return t}}t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"","%FF%FE":""},r=i.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch(t){var n=s(r[0]);n!==r[0]&&(e[r[0]]=n)}r=i.exec(t)}e["%C2"]="";for(var o=Object.keys(e),a=0;a<o.length;a++){var u=o[a];t=t.replace(new RegExp(u,"g"),e[u])}return t}(t)}}},function(t,e,r){"use strict";t.exports=(t,e)=>{if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===e)return[t];const r=t.indexOf(e);return-1===r?[t]:[t.slice(0,r),t.slice(r+e.length)]}},function(t,e,r){"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(t,e,r){"use strict";r.r(e),r.d(e,"generateKey",(function(){return s})),r.d(e,"verifyHmac",(function(){return a})),r.d(e,"encrypt",(function(){return u})),r.d(e,"decrypt",(function(){return h}));var n=r(8),i=r(0),o=r(1);async function s(t){const e=(t||256)/8,r=n.randomBytes(e);return Object(o.d)(i.arrayToBuffer(r))}async function a(t,e){const r=i.hexToArray(t.data),o=i.hexToArray(t.iv),s=i.hexToArray(t.hmac),a=i.arrayToHex(s,!1),u=i.concatArrays(r,o),h=await n.hmacSha256Sign(e,u),c=i.arrayToHex(h,!1);return i.removeHexPrefix(a)===i.removeHexPrefix(c)}async function u(t,e,r){const a=i.bufferToArray(Object(o.b)(e)),u=r||await s(128),h=i.bufferToArray(Object(o.b)(u)),c=i.arrayToHex(h,!1),f=JSON.stringify(t),l=i.utf8ToArray(f),d=await n.aesCbcEncrypt(h,a,l),p=i.arrayToHex(d,!1),m=i.concatArrays(d,h),g=await n.hmacSha256Sign(a,m);return{data:p,hmac:i.arrayToHex(g,!1),iv:c}}async function h(t,e){const r=i.bufferToArray(Object(o.b)(e));if(!r)throw new Error("Missing key: required for decryption");if(!await a(t,r))return null;const s=i.hexToArray(t.data),u=i.hexToArray(t.iv),h=await n.aesCbcDecrypt(u,r,s),c=i.arrayToUtf8(h);let f;try{f=JSON.parse(c)}catch(t){return null}return f}},function(t,e,r){"use strict";r.r(e);var n=r(1),i=r(39);var o=class{constructor(){this._eventEmitters=[]}subscribe(t){this._eventEmitters.push(t)}unsubscribe(t){this._eventEmitters=this._eventEmitters.filter(e=>e.event!==t)}trigger(t){let e,r=[];e=Object(n.o)(t)?t.method:Object(n.q)(t)||Object(n.p)(t)?"response:"+t.id:Object(n.n)(t)?t.event:"",e&&(r=this._eventEmitters.filter(t=>t.event===e)),r&&r.length||Object(n.s)(e)||Object(n.n)(e)||(r=this._eventEmitters.filter(t=>"call_request"===t.event)),r.forEach(e=>{if(Object(n.p)(t)){const r=new Error(t.error.message);e.callback(r,null)}else e.callback(null,t)})}};var s=class{constructor(t="walletconnect"){this.storageId=t}getSession(){let t=null;const e=Object(n.j)(this.storageId);return e&&Object(n.u)(e)&&(t=e),t}setSession(t){return Object(n.B)(this.storageId,t),t}removeSession(){Object(n.A)(this.storageId)}};const a="abcdefghijklmnopqrstuvwxyz0123456789".split("").map(t=>`https://${t}.bridge.walletconnect.org`);function u(){return a[Math.floor(Math.random()*a.length)]}e.default=class{constructor(t){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new o,this._clientMeta=Object(n.i)()||t.connectorOpts.clientMeta||null,this._cryptoLib=t.cryptoLib,this._sessionStorage=t.sessionStorage||new s(t.connectorOpts.storageId),this._qrcodeModal=t.connectorOpts.qrcodeModal,this._qrcodeModalOptions=t.connectorOpts.qrcodeModalOptions,this._signingMethods=[...n.C,...t.connectorOpts.signingMethods||[]],!t.connectorOpts.bridge&&!t.connectorOpts.uri&&!t.connectorOpts.session)throw new Error("Missing one of the required parameters: bridge / uri / session");var e;t.connectorOpts.bridge&&(this.bridge=function(t){return"walletconnect.org"===function(t){return function(t){let e=t.indexOf("//")>-1?t.split("/")[2]:t.split("/")[0];return e=e.split(":")[0],e=e.split("?")[0],e}(t).split(".").slice(-2).join(".")}(t)}(e=t.connectorOpts.bridge)?u():e),t.connectorOpts.uri&&(this.uri=t.connectorOpts.uri);const r=t.connectorOpts.session||this._getStorageSession();r&&(this.session=r),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=t.transport||new i.a({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),t.connectorOpts.uri&&this._subscribeToSessionRequest(),t.pushServerOpts&&this._registerPushServer(t.pushServerOpts)}set bridge(t){t&&(this._bridge=t)}get bridge(){return this._bridge}set key(t){if(!t)return;const e=Object(n.e)(t);this._key=e}get key(){if(this._key){return Object(n.c)(this._key,!0)}return""}set clientId(t){t&&(this._clientId=t)}get clientId(){let t=this._clientId;return t||(t=this._clientId=Object(n.D)()),this._clientId}set peerId(t){t&&(this._peerId=t)}get peerId(){return this._peerId}set clientMeta(t){}get clientMeta(){let t=this._clientMeta;return t||(t=this._clientMeta=Object(n.i)()),t}set peerMeta(t){this._peerMeta=t}get peerMeta(){return this._peerMeta}set handshakeTopic(t){t&&(this._handshakeTopic=t)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(t){t&&(this._handshakeId=t)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(t){if(!t)return;const{handshakeTopic:e,bridge:r,key:n}=this._parseUri(t);this.handshakeTopic=e,this.bridge=r,this.key=n}set chainId(t){this._chainId=t}get chainId(){return this._chainId}set networkId(t){this._networkId=t}get networkId(){return this._networkId}set accounts(t){this._accounts=t}get accounts(){return this._accounts}set rpcUrl(t){this._rpcUrl=t}get rpcUrl(){return this._rpcUrl}set connected(t){}get connected(){return this._connected}set pending(t){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(t){t&&(this._connected=t.connected,this.accounts=t.accounts,this.chainId=t.chainId,this.bridge=t.bridge,this.key=t.key,this.clientId=t.clientId,this.clientMeta=t.clientMeta,this.peerId=t.peerId,this.peerMeta=t.peerMeta,this.handshakeId=t.handshakeId,this.handshakeTopic=t.handshakeTopic)}on(t,e){const r={event:t,callback:e};this._eventManager.subscribe(r)}off(t){this._eventManager.unsubscribe(t)}async createInstantRequest(t){this._key=await this._generateKey();const e=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(t)}]});this.handshakeId=e.id,this.handshakeTopic=Object(n.D)(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error("User close QRCode Modal")});const r=()=>{this.killSession()};try{const t=await this._sendCallRequest(e);return t&&r(),t}catch(t){throw r(),t}}async connect(t){if(!this._qrcodeModal)throw new Error("QRCode Modal not provided");return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(t),new Promise(async(t,e)=>{this.on("modal_closed",()=>e(new Error("User close QRCode Modal"))),this.on("connect",(r,n)=>{if(r)return e(r);t(n.params[0])})}))}async createSession(t){if(this._connected)throw new Error("Session currently connected");if(this.pending)return;this._key=await this._generateKey();const e=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:t&&t.chainId?t.chainId:null}]});this.handshakeId=e.id,this.handshakeTopic=Object(n.D)(),this._sendSessionRequest(e,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(t){if(this._connected)throw new Error("Session currently connected");this.chainId=t.chainId,this.accounts=t.accounts,this.networkId=t.networkId||0,this.rpcUrl=t.rpcUrl||"";const e={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},r={id:this.handshakeId,jsonrpc:"2.0",result:e};this._sendResponse(r),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(t){if(this._connected)throw new Error("Session currently connected");const e=t&&t.message?t.message:"Session Rejected",r=this._formatResponse({id:this.handshakeId,error:{message:e}});this._sendResponse(r),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:e}]}),this._removeStorageSession()}updateSession(t){if(!this._connected)throw new Error("Session currently disconnected");this.chainId=t.chainId,this.accounts=t.accounts,this.networkId=t.networkId||0,this.rpcUrl=t.rpcUrl||"";const e={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},r=this._formatRequest({method:"wc_sessionUpdate",params:[e]});this._sendSessionRequest(r,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(t){const e=t?t.message:"Session Disconnected",r=this._formatRequest({method:"wc_sessionUpdate",params:[{approved:!1,chainId:null,networkId:null,accounts:null}]});await this._sendRequest(r),this._handleSessionDisconnect(e)}async sendTransaction(t){if(!this._connected)throw new Error("Session currently disconnected");const e=Object(n.x)(t),r=this._formatRequest({method:"eth_sendTransaction",params:[e]});return await this._sendCallRequest(r)}async signTransaction(t){if(!this._connected)throw new Error("Session currently disconnected");const e=Object(n.x)(t),r=this._formatRequest({method:"eth_signTransaction",params:[e]});return await this._sendCallRequest(r)}async signMessage(t){if(!this._connected)throw new Error("Session currently disconnected");const e=this._formatRequest({method:"eth_sign",params:t});return await this._sendCallRequest(e)}async signPersonalMessage(t){if(!this._connected)throw new Error("Session currently disconnected");t=Object(n.w)(t);const e=this._formatRequest({method:"personal_sign",params:t});return await this._sendCallRequest(e)}async signTypedData(t){if(!this._connected)throw new Error("Session currently disconnected");const e=this._formatRequest({method:"eth_signTypedData",params:t});return await this._sendCallRequest(e)}async updateChain(t){if(!this._connected)throw new Error("Session currently disconnected");const e=this._formatRequest({method:"wallet_updateChain",params:[t]});return await this._sendCallRequest(e)}unsafeSend(t,e){return this._sendRequest(t,e),this._eventManager.trigger({event:"call_request_sent",params:[{request:t,options:e}]}),new Promise((e,r)=>{this._subscribeToResponse(t.id,(t,n)=>{if(t)r(t);else{if(!n)throw new Error("Missing JSON RPC response");e(n)}})})}async sendCustomRequest(t,e){if(!this._connected)throw new Error("Session currently disconnected");switch(t.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Object(n.f)(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":t.params&&(t.params[0]=Object(n.x)(t.params[0]));break;case"personal_sign":t.params&&(t.params=Object(n.w)(t.params))}const r=this._formatRequest(t);return await this._sendCallRequest(r,e)}approveRequest(t){if(!Object(n.q)(t))throw new Error('JSON-RPC success response must include "result" field');{const e=this._formatResponse(t);this._sendResponse(e)}}rejectRequest(t){if(!Object(n.p)(t))throw new Error('JSON-RPC error response must include "error" field');{const e=this._formatResponse(t);this._sendResponse(e)}}transportClose(){this._transport.close()}async _sendRequest(t,e){const r=this._formatRequest(t),i=await this._encrypt(r),o=void 0!==(null==e?void 0:e.topic)?e.topic:this.peerId,s=JSON.stringify(i),a=void 0!==(null==e?void 0:e.forcePushNotification)?!e.forcePushNotification:Object(n.t)(r);this._transport.send(s,o,a)}async _sendResponse(t){const e=await this._encrypt(t),r=this.peerId,n=JSON.stringify(e);this._transport.send(n,r,!0)}async _sendSessionRequest(t,e,r){this._sendRequest(t,r),this._subscribeToSessionResponse(t.id,e)}_sendCallRequest(t,e){return this._sendRequest(t,e),this._eventManager.trigger({event:"call_request_sent",params:[{request:t,options:e}]}),this._subscribeToCallResponse(t.id)}_formatRequest(t){if(void 0===t.method)throw new Error('JSON RPC request must have valid "method" value');return{id:void 0===t.id?Object(n.z)():t.id,jsonrpc:"2.0",method:t.method,params:void 0===t.params?[]:t.params}}_formatResponse(t){if(void 0===t.id)throw new Error('JSON RPC request must have valid "id" value');const e={id:t.id,jsonrpc:"2.0"};if(Object(n.p)(t)){const r=Object(n.h)(t.error);return Object.assign(Object.assign(Object.assign({},e),t),{error:r})}if(Object(n.q)(t)){return Object.assign(Object.assign({},e),t)}throw new Error("JSON RPC response format is invalid")}_handleSessionDisconnect(t){const e=t||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),Object(n.A)(n.v)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:e}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(t,e){e&&e.approved?(this._connected?(e.chainId&&(this.chainId=e.chainId),e.accounts&&(this.accounts=e.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,e.chainId&&(this.chainId=e.chainId),e.accounts&&(this.accounts=e.accounts),e.peerId&&!this.peerId&&(this.peerId=e.peerId),e.peerMeta&&!this.peerMeta&&(this.peerMeta=e.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(t)}async _handleIncomingMessages(t){if(![this.clientId,this.handshakeTopic].includes(t.topic))return;let e;try{e=JSON.parse(t.payload)}catch(t){return}const r=await this._decrypt(e);r&&this._eventManager.trigger(r)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(t,e){this.on("response:"+t,e)}_subscribeToSessionResponse(t,e){this._subscribeToResponse(t,(t,r)=>{t?this._handleSessionResponse(t.message):r.result?this._handleSessionResponse(e,r.result):r.error&&r.error.message?this._handleSessionResponse(r.error.message):this._handleSessionResponse(e)})}_subscribeToCallResponse(t){return new Promise((e,r)=>{this._subscribeToResponse(t,(t,n)=>{t?r(t):n.result?e(n.result):n.error&&n.error.message?r(new Error(n.error.message)):r(new Error("JSON RPC response format is invalid"))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(t,e)=>{const{request:r}=e.params[0];if(Object(n.r)()&&this._signingMethods.includes(r.method)){const t=Object(n.j)(n.v);t&&(window.location.href=t.href)}}),this.on("wc_sessionRequest",(t,e)=>{t&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:t.toString()}]}),this.handshakeId=e.id,this.peerId=e.params[0].peerId,this.peerMeta=e.params[0].peerMeta;const r=Object.assign(Object.assign({},e),{method:"session_request"});this._eventManager.trigger(r)}),this.on("wc_sessionUpdate",(t,e)=>{t&&this._handleSessionResponse(t.message),this._handleSessionResponse("Session disconnected",e.params[0])})}_initTransport(){this._transport.on("message",t=>this._handleIncomingMessages(t)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){return`${this.protocol}:${this.handshakeTopic}@${this.version}?bridge=${encodeURIComponent(this.bridge)}&key=${this.key}`}_parseUri(t){const e=Object(n.y)(t);if(e.protocol===this.protocol){if(!e.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const t=e.handshakeTopic;if(!e.bridge)throw Error("Invalid or missing bridge url parameter value");const r=decodeURIComponent(e.bridge);if(!e.key)throw Error("Invalid or missing key parameter value");return{handshakeTopic:t,bridge:r,key:e.key}}throw new Error("URI format is invalid")}async _generateKey(){if(this._cryptoLib){return await this._cryptoLib.generateKey()}return null}async _encrypt(t){const e=this._key;if(this._cryptoLib&&e){return await this._cryptoLib.encrypt(t,e)}return null}async _decrypt(t){const e=this._key;if(this._cryptoLib&&e){return await this._cryptoLib.decrypt(t,e)}return null}_getStorageSession(){let t=null;return this._sessionStorage&&(t=this._sessionStorage.getSession()),t}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(t){if(!t.url||"string"!=typeof t.url)throw Error("Invalid or missing pushServerOpts.url parameter value");if(!t.type||"string"!=typeof t.type)throw Error("Invalid or missing pushServerOpts.type parameter value");if(!t.token||"string"!=typeof t.token)throw Error("Invalid or missing pushServerOpts.token parameter value");const e={bridge:this.bridge,topic:this.clientId,type:t.type,token:t.token,peerName:"",language:t.language||""};this.on("connect",async(r,n)=>{if(r)throw r;if(t.peerMeta){const t=n.params[0].peerMeta.name;e.peerName=t}try{const r=await fetch(t.url+"/new",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(!(await r.json()).success)throw Error("Failed to register in Push Server")}catch(r){throw Error("Failed to register in Push Server")}})}}}])}));
>>>>>>> web3-setup
